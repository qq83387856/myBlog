/*
* ---------------------------------------------------------
* Copyright(C) Microsoft Corporation. All rights reserved.
* ---------------------------------------------------------
*/

define("../Messaging/Messaging",["require","exports"],function(e,t){!function(e){e[e.CustomizedWorkItemCreated=0]="CustomizedWorkItemCreated",e[e.PageEventCaptured=1]="PageEventCaptured",e[e.StartTraceability=2]="StartTraceability",e[e.VerifyIfOfflineSessionRunning=3]="VerifyIfOfflineSessionRunning",e[e.AnnotationToolReady=4]="AnnotationToolReady",e[e.AnnotateScreenshot=5]="AnnotateScreenshot",e[e.AnnotationDone=6]="AnnotationDone",e[e.AnnotationCancelled=7]="AnnotationCancelled",e[e.SessionLoad=8]="SessionLoad",e[e.SessionUpdate=9]="SessionUpdate",e[e.SessionStart=10]="SessionStart",e[e.SessionStop=11]="SessionStop",e[e.ExportSession=12]="ExportSession",e[e.CaptureScreenshot=13]="CaptureScreenshot",e[e.ScreenshotCaptureCompleted=14]="ScreenshotCaptureCompleted",e[e.ScreenshotCaptureCancelled=15]="ScreenshotCaptureCancelled",e[e.SaveSettings=16]="SaveSettings",e[e.CreateWorkItem=17]="CreateWorkItem",e[e.NewAttachmentCreated=18]="NewAttachmentCreated",e[e.NewBugCreated=19]="NewBugCreated",e[e.CloseWorkItemDialog=20]="CloseWorkItemDialog",e[e.AttachmentsAvailable=21]="AttachmentsAvailable",e[e.SaveAnnotationSettings=22]="SaveAnnotationSettings",e[e.FetchAnnotationSettings=23]="FetchAnnotationSettings",e[e.AnnotationSettingsFetchResponse=24]="AnnotationSettingsFetchResponse",e[e.FetchObjectFromLocalStorage=25]="FetchObjectFromLocalStorage",e[e.FetchObjectFromLocalStorageResponse=26]="FetchObjectFromLocalStorageResponse",e[e.TracingLevelChanged=27]="TracingLevelChanged",e[e.SaveNote=28]="SaveNote",e[e.NoteSaved=29]="NoteSaved",e[e.Trace=30]="Trace",e[e.ExecuteTfsCommand=31]="ExecuteTfsCommand",e[e.UploadInlineImage=32]="UploadInlineImage",e[e.ActivityErrorChanged=33]="ActivityErrorChanged",e[e.ExecutePerfectoCommand=34]="ExecutePerfectoCommand",e[e.TfsLoginFailed=35]="TfsLoginFailed",e[e.TfsLoginSucceeded=36]="TfsLoginSucceeded",e[e.StartAutoRefresh=37]="StartAutoRefresh",e[e.TfsReconnectSucceeded=38]="TfsReconnectSucceeded",e[e.TfsReconnectFailed=39]="TfsReconnectFailed",e[e.QueryTraceableWorkItems=40]="QueryTraceableWorkItems",e[e.QueryWorkItem=41]="QueryWorkItem",e[e.ClearTraceabilityData=42]="ClearTraceabilityData",e[e.QuerySimilarBugs=43]="QuerySimilarBugs",e[e.QueryBug=44]="QueryBug",e[e.UpdateWorkItem=45]="UpdateWorkItem",e[e.ActionLogFeatureChanged=46]="ActionLogFeatureChanged",e[e.PublishTelemetryData=47]="PublishTelemetryData",e[e.CreateTestCase=48]="CreateTestCase",e[e.StartVideoCapture=49]="StartVideoCapture",e[e.StopVideoCapture=50]="StopVideoCapture",e[e.ScreenshotCaptureGetActiveWindow_V1=51]="ScreenshotCaptureGetActiveWindow_V1",e[e.CaptureScreenshot_V1=52]="CaptureScreenshot_V1",e[e.ScreenshotCaptureCancelled_V1=53]="ScreenshotCaptureCancelled_V1",e[e.ScreenshotCaptureCompleted_V1=54]="ScreenshotCaptureCompleted_V1",e[e.ScreenshotCaptureError_V1=55]="ScreenshotCaptureError_V1",e[e.StopTraceability=56]="StopTraceability",e[e.GetSystemInfomation_V1=57]="GetSystemInfomation_V1",e[e.StartVideoCapture_V1=58]="StartVideoCapture_V1",e[e.StopVideoCapture_V1=59]="StopVideoCapture_V1",e[e.VideoCaptureError_V1=60]="VideoCaptureError_V1",e[e.VideoCaptureCompleted_V1=61]="VideoCaptureCompleted_V1",e[e.VideoCaptureCancelled_V1=62]="VideoCaptureCancelled_V1",e[e.VideoCaptureStarted_V1=63]="VideoCaptureStarted_V1",e[e.PerfData=64]="PerfData",e[e.FeatureFlagStatus=65]="FeatureFlagStatus",e[e.StartActionLogCapture_V1=66]="StartActionLogCapture_V1",e[e.StopActionLogCapture_V1=67]="StopActionLogCapture_V1",e[e.GetActionLogReport_V1=68]="GetActionLogReport_V1",e[e.ActionLogContainerCreated_V1=69]="ActionLogContainerCreated_V1",e[e.ActionLogError_V1=70]="ActionLogError_V1",e[e.ActionLogUploadCompleted_V1=71]="ActionLogUploadCompleted_V1",e[e.PingTab=72]="PingTab",e[e.ShowNotification=73]="ShowNotification",e[e.CreateFeedbackResponse=74]="CreateFeedbackResponse",e[e.VerifyIfSessionIsRunning_V1=75]="VerifyIfSessionIsRunning_V1",e[e.ConfigureXtForFeedbackRequest_V1=76]="ConfigureXtForFeedbackRequest_V1",e[e.QueryFeedbackRequests=77]="QueryFeedbackRequests",e[e.QueryFeedbackRequestDetail=78]="QueryFeedbackRequestDetail",e[e.UpdateSessionState=79]="UpdateSessionState",e[e.CreateOrUpdateFeedbackSessionWithGivenState=80]="CreateOrUpdateFeedbackSessionWithGivenState",e[e.ProvideFeedback=81]="ProvideFeedback",e[e.EnableDefaultWorkItemInToolbar=82]="EnableDefaultWorkItemInToolbar",e[e.CaptureDesktopScreenshot_V1=83]="CaptureDesktopScreenshot_V1",e[e.LoadScreenshotContentFromBlob=84]="LoadScreenshotContentFromBlob",e[e.CaptureDesktopScreenshot=85]="CaptureDesktopScreenshot"}(t.NotificationType||(t.NotificationType={}));t.NotificationType}),define("../Common/Constants",["require","exports"],function(e,t){var o=function(){function e(){}return e.focusAreaWidth=300,e.focusAreaHeight=60,e.runnerActionLogThumbnailWidth=200,e.runnerActionLogThumbnailHeight=100,e.thumbnailFocusAreaWidth=100,e.thumbnailFocusAreaHeight=60,e.thumbnailScaleFactor=.5,e.imageTageClassName="action-log-image",e.linkTageClassName="action-log-link",e.canvasId="image-editor",e.inputTextActionLogPrefix="Update input field with value",e.videoThumbnailClassName="xt-video-attachment",e.actionLogFileNamePrefix="actionLog-",e.actionLogFileFormat="jpeg",e.clickEventType="click",e.keyboardEventType="keyboard",e.actionLogsFileName="actionLog",e.stepHeader="Steps",e.actionHeader="Actions",e.imageHeader="Image",e.screenshotHeader="Full screen image",e.maxRunnerActionLogs=100,e.defaultActionLogCount=15,e.defaultActionLogBufferLength=20,e}();t.ActionLogConstants=o;var n=function(){function e(){}return e.enterKeyCode=13,e.escKeyCode=27,e.sKeyCode=83,e.rightArrow=39,e.leftArrow=37,e.downArrow=40,e.upArrow=38,e.spaceBar=32,e}();t.KeyCodeConstants=n;var r=function(){function e(){}return e.minFrameRate=1,e.maxFrameRate=60,e.defaultFrameRate=30,e.defaultWindowHeight=1280,e.vgaWindowHeight=640,e.defaultWindowWidth=720,e.vgaWindowWidth=360,e.captureIntervalInSeconds=1,e.maxVideoLengthInMinutes=10,e.optimalFrameRate=5,e.maxVideoSizeInBytes=52428800,e}();t.VideoCaptureConstants=r;var i=function(){function e(){}return e.defaultWorkItemCategoryColorMap={"Microsoft.BugCategory":"FFCC293D","Microsoft.TaskCategory":"FFF2CB1D","Microsoft.EpicCategory":"FFFF7B00","Microsoft.FeatureCategory":"FF773B93","Microsoft.RequirementCategory":"FF009CCC","Microsoft.TestCaseCategory":"FFFF9D00","Microsoft.SharedStepCategory":"FFFF9D00","Microsoft.SharedParameterCategory":"FFFF9D00","Microsoft.CodeReviewResponseCategory":"FFFF9D00","Microsoft.FeedbackRequestCategory":"FFFF9D00","Microsoft.FeedbackResponseCategory":"FFFF9D00","Microsoft.TestPlanCategory":"FFFF9D00","Microsoft.TestSuiteCategory":"FFFF9D00"},e.defaultWorkItemColor="FFCC293D",e}();t.WorkItemConstants=i;var a=function(){function e(){}return e.XTSource="XT",e.WebRunnerSource="WebRunner",e}();t.TelemetryConstants=a;var s=function(){function e(){}return e.maxRecords=7,e}();t.PerfDataConstants=s;var c=function(){function e(){}return e.exploratoryTestingExtensionGalleryId="ms.vss-exploratorytesting-web",e.testManagerExtensionGalleryId="ms.vss-testmanager-web",e}();t.CommonExtensionContants=c;var u=function(){function e(){}return e.stakeholderMode="stakeholder",e.teamMode="tfs",e.offlineMode="offline",e.connectedMode="connected",e}();t.ConnectionOptionConstants=u;var d=function(){function e(){}return e.pendingState="Pending",e.completedState="Completed",e.declinedState="Declined",e}();t.FeedbackStateOptionConstants=d;var g=function(){function e(){}return e.feedbackDetailsPageUrl="#/FeedbackRequestDetail",e.feedbackListsPageUrl="#/FeedbackRequests",e}();t.StakeHolderTraceabiltyPageUrls=g;var p=function(){function e(){}return e.unAuthorized="UnauthorizedAccessException",e}();t.ExceptionConstants=p;var f=function(){function e(){}return e.chromeBrowserName="Google Chrome",e.firefoxBrowserName="Mozilla Firefox",e.edgeBrowserName="Microsoft Edge",e}();t.BrowserConstants=f;var l=function(){function e(){}return e.xtMinimizeId="minimize-page",e}();t.ElementIds=l;var S=function(){function e(){}return e.login="To capture screen or action logs, make sure Test & Feedback extension is connected to {0}.",e}();t.Messages=S}),define("../Model/BrowserHelper",["require","exports","../Common/Constants"],function(e,t,o){var n=function(){function e(){}return e.isChrome=function(){return chrome.extension.getURL("").split(this.hostSeparator)[0]===this.chromeExtensionHost},e.isFirefox=function(){return chrome.extension.getURL("").split(this.hostSeparator)[0]===this.firefoxExtensionHost},e.isEdge=function(){return chrome.extension.getURL("").split(this.hostSeparator)[0]===this.edgeExtensionHost},e.getBrowserInfo=function(){return e.isFirefox()?o.BrowserConstants.firefoxBrowserName:e.isEdge()?o.BrowserConstants.edgeBrowserName:o.BrowserConstants.chromeBrowserName},e.getOptionsPage=function(){return chrome.extension.getURL("options/options.html")},e.getSessionStorageDirectoryName=function(){return this.isChrome()?"Session":"Main"},e.chromeExtensionHost="chrome-extension:",e.firefoxExtensionHost="moz-extension:",e.edgeExtensionHost="ms-browser-extension:",e.hostSeparator="//",e}();t.BrowserHelper=n});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../Messaging/ChromeMessaging",["require","exports","../Messaging/Messaging","../Model/BrowserHelper"],function(e,t,o,n){function r(){try{return window.self!==window.top}catch(e){return!0}}var i=o.NotificationType,a=function(){function e(){}return e.prototype.sendMessage=function(e,t,o,n){var r={notificationType:t,data:o};chrome.tabs.sendMessage(e,r,n)},e.prototype.queryTabs=function(e,t,o){chrome.tabs.query(e,function(e){var n=[];e.forEach(function(e){e.id!==t&&n.push({windowId:e.windowId,url:e.url,title:e.title})}),o(n)})},e}(),s=function(){function e(){}return e.prototype.broadcast=function(e,t,o){var n={notificationType:e,data:t};this.sendMessage(n,o)},e.prototype.broadcastAsync=function(e,t){if(r())throw"async messaging not supported in sandbox";var o=Q.defer();return this.broadcast(e,t,function(e){o.resolve(e)}),o.promise},e.prototype.sendMessage=function(e,t){},e}(),c=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.sendMessage=function(e,t){!t&&n.BrowserHelper.isEdge()&&(t=function(e){}),chrome.runtime.sendMessage(e,t)},t}(s),u=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.sendMessage=function(e,t){window.parent.postMessage(e,"*")},t}(s),d=function(){function e(){this.subscriptions={}}return e.prototype.subscribe=function(e,t){var o=this.subscriptions[t];o?this.subscriptions[t].push(e):(o=[],o.push(e),this.subscriptions[t]=o)},e.prototype.clearAll=function(){this.subscriptions={}},e.prototype.clearAllForNotificationType=function(e){this.subscriptions&&this.subscriptions[e]&&(this.subscriptions[e]=[])},e.prototype.notifySubscribers=function(e,t,o,n){var r=this.subscriptions[e];if(r)for(var i=0;i<r.length;i++)r[i](t,o,n)},e}(),g=function(e){function t(){var t=this;e.call(this),this.listenToMessages(function(e,o,n,r){t.notifySubscribers(e,o,n,r)})}return __extends(t,e),t.prototype.listenToMessages=function(e){chrome.runtime.onMessage.addListener(function(t,o,n){return t?(e(t.notificationType,t.data,n,o),n?!0:!1):void 0})},t}(d),p=function(e){function t(){var t=this;e.call(this),this.listenToMessages(function(e,o){t.notifySubscribers(e,o,null,null)})}return __extends(t,e),t.prototype.listenToMessages=function(e){window.addEventListener("message",function(t){t.data&&e(t.data.notificationType,t.data.data)})},t}(d),f=function(){function e(){}return e.getSubscriptionService=function(){return r()?e.getSandboxSubscriptionService():this.getChromeSubscriptionService()},e.getBroadcastingService=function(){return r()?e.getSandboxBroadcastingService():this.getChromeBroadcastingService()},e.getChromeMessagingTabService=function(){return e.chromeTabMessagingService?e.chromeTabMessagingService:(e.chromeTabMessagingService=new a,e.chromeTabMessagingService)},e.getSandboxSubscriptionService=function(){return e.sandboxSubscriptionService?e.sandboxSubscriptionService:(e.sandboxSubscriptionService=new p,e.sandboxSubscriptionService)},e.getChromeSubscriptionService=function(){return e.chromeSubscriptionService?e.chromeSubscriptionService:(e.chromeSubscriptionService=new g,e.chromeSubscriptionService)},e.getSandboxBroadcastingService=function(){return e.sandboxBroadcastingService?e.sandboxBroadcastingService:(e.sandboxBroadcastingService=new u,e.sandboxBroadcastingService)},e.getChromeBroadcastingService=function(){return e.chromeBroadcastingService?e.chromeBroadcastingService:(e.chromeBroadcastingService=new c,e.chromeBroadcastingService)},e}();t.MessagingFactory=f;var l=function(){function e(e){this._iframe=e,this._sandbox=e.contentWindow,this.listenToChromeMessages(),this.listenToSandboxMessages()}return e.prototype.listenToSandboxMessages=function(){var e=this;window.addEventListener("message",function(t){t.data&&t.data.resize&&t.data.height?e._iframe.style.height=t.data.height:e.sendMessageToChrome(t.data)})},e.prototype.sendMessageToChrome=function(e){e.notificationType===i.AnnotationToolReady?chrome.windows.getCurrent(function(t){e.data.windowId=t.id,chrome.runtime.sendMessage(e)}):chrome.runtime.sendMessage(e)},e.prototype.listenToChromeMessages=function(){var e=this;chrome.runtime.onMessage.addListener(function(t,o,n){t&&void 0!=t.notificationType&&e.sendMessageToSandbox(t)})},e.prototype.sendMessageToSandbox=function(e){this._sandbox.postMessage(e,"*")},e}();t.SandboxMessagingRelay=l}),define("AnnotationToolHost",["require","exports","../Messaging/ChromeMessaging"],function(e,t,o){$("document").ready(function(){var e=document.getElementById("app");new o.SandboxMessagingRelay(e)})}),require(["AnnotationToolHost"]),define("main",function(){});