/*
* ---------------------------------------------------------
* Copyright(C) Microsoft Corporation. All rights reserved.
* ---------------------------------------------------------
*/

define("../../Messaging/Messaging",["require","exports"],function(e,t){!function(e){e[e.CustomizedWorkItemCreated=0]="CustomizedWorkItemCreated",e[e.PageEventCaptured=1]="PageEventCaptured",e[e.StartTraceability=2]="StartTraceability",e[e.VerifyIfOfflineSessionRunning=3]="VerifyIfOfflineSessionRunning",e[e.AnnotationToolReady=4]="AnnotationToolReady",e[e.AnnotateScreenshot=5]="AnnotateScreenshot",e[e.AnnotationDone=6]="AnnotationDone",e[e.AnnotationCancelled=7]="AnnotationCancelled",e[e.SessionLoad=8]="SessionLoad",e[e.SessionUpdate=9]="SessionUpdate",e[e.SessionStart=10]="SessionStart",e[e.SessionStop=11]="SessionStop",e[e.ExportSession=12]="ExportSession",e[e.CaptureScreenshot=13]="CaptureScreenshot",e[e.ScreenshotCaptureCompleted=14]="ScreenshotCaptureCompleted",e[e.ScreenshotCaptureCancelled=15]="ScreenshotCaptureCancelled",e[e.SaveSettings=16]="SaveSettings",e[e.CreateWorkItem=17]="CreateWorkItem",e[e.NewAttachmentCreated=18]="NewAttachmentCreated",e[e.NewBugCreated=19]="NewBugCreated",e[e.CloseWorkItemDialog=20]="CloseWorkItemDialog",e[e.AttachmentsAvailable=21]="AttachmentsAvailable",e[e.SaveAnnotationSettings=22]="SaveAnnotationSettings",e[e.FetchAnnotationSettings=23]="FetchAnnotationSettings",e[e.AnnotationSettingsFetchResponse=24]="AnnotationSettingsFetchResponse",e[e.FetchObjectFromLocalStorage=25]="FetchObjectFromLocalStorage",e[e.FetchObjectFromLocalStorageResponse=26]="FetchObjectFromLocalStorageResponse",e[e.TracingLevelChanged=27]="TracingLevelChanged",e[e.SaveNote=28]="SaveNote",e[e.NoteSaved=29]="NoteSaved",e[e.Trace=30]="Trace",e[e.ExecuteTfsCommand=31]="ExecuteTfsCommand",e[e.UploadInlineImage=32]="UploadInlineImage",e[e.ActivityErrorChanged=33]="ActivityErrorChanged",e[e.ExecutePerfectoCommand=34]="ExecutePerfectoCommand",e[e.TfsLoginFailed=35]="TfsLoginFailed",e[e.TfsLoginSucceeded=36]="TfsLoginSucceeded",e[e.StartAutoRefresh=37]="StartAutoRefresh",e[e.TfsReconnectSucceeded=38]="TfsReconnectSucceeded",e[e.TfsReconnectFailed=39]="TfsReconnectFailed",e[e.QueryTraceableWorkItems=40]="QueryTraceableWorkItems",e[e.QueryWorkItem=41]="QueryWorkItem",e[e.ClearTraceabilityData=42]="ClearTraceabilityData",e[e.QuerySimilarBugs=43]="QuerySimilarBugs",e[e.QueryBug=44]="QueryBug",e[e.UpdateWorkItem=45]="UpdateWorkItem",e[e.ActionLogFeatureChanged=46]="ActionLogFeatureChanged",e[e.PublishTelemetryData=47]="PublishTelemetryData",e[e.CreateTestCase=48]="CreateTestCase",e[e.StartVideoCapture=49]="StartVideoCapture",e[e.StopVideoCapture=50]="StopVideoCapture",e[e.ScreenshotCaptureGetActiveWindow_V1=51]="ScreenshotCaptureGetActiveWindow_V1",e[e.CaptureScreenshot_V1=52]="CaptureScreenshot_V1",e[e.ScreenshotCaptureCancelled_V1=53]="ScreenshotCaptureCancelled_V1",e[e.ScreenshotCaptureCompleted_V1=54]="ScreenshotCaptureCompleted_V1",e[e.ScreenshotCaptureError_V1=55]="ScreenshotCaptureError_V1",e[e.StopTraceability=56]="StopTraceability",e[e.GetSystemInfomation_V1=57]="GetSystemInfomation_V1",e[e.StartVideoCapture_V1=58]="StartVideoCapture_V1",e[e.StopVideoCapture_V1=59]="StopVideoCapture_V1",e[e.VideoCaptureError_V1=60]="VideoCaptureError_V1",e[e.VideoCaptureCompleted_V1=61]="VideoCaptureCompleted_V1",e[e.VideoCaptureCancelled_V1=62]="VideoCaptureCancelled_V1",e[e.VideoCaptureStarted_V1=63]="VideoCaptureStarted_V1",e[e.PerfData=64]="PerfData",e[e.FeatureFlagStatus=65]="FeatureFlagStatus",e[e.StartActionLogCapture_V1=66]="StartActionLogCapture_V1",e[e.StopActionLogCapture_V1=67]="StopActionLogCapture_V1",e[e.GetActionLogReport_V1=68]="GetActionLogReport_V1",e[e.ActionLogContainerCreated_V1=69]="ActionLogContainerCreated_V1",e[e.ActionLogError_V1=70]="ActionLogError_V1",e[e.ActionLogUploadCompleted_V1=71]="ActionLogUploadCompleted_V1",e[e.PingTab=72]="PingTab",e[e.ShowNotification=73]="ShowNotification",e[e.CreateFeedbackResponse=74]="CreateFeedbackResponse",e[e.VerifyIfSessionIsRunning_V1=75]="VerifyIfSessionIsRunning_V1",e[e.ConfigureXtForFeedbackRequest_V1=76]="ConfigureXtForFeedbackRequest_V1",e[e.QueryFeedbackRequests=77]="QueryFeedbackRequests",e[e.QueryFeedbackRequestDetail=78]="QueryFeedbackRequestDetail",e[e.UpdateSessionState=79]="UpdateSessionState",e[e.CreateOrUpdateFeedbackSessionWithGivenState=80]="CreateOrUpdateFeedbackSessionWithGivenState",e[e.ProvideFeedback=81]="ProvideFeedback",e[e.EnableDefaultWorkItemInToolbar=82]="EnableDefaultWorkItemInToolbar",e[e.CaptureDesktopScreenshot_V1=83]="CaptureDesktopScreenshot_V1",e[e.LoadScreenshotContentFromBlob=84]="LoadScreenshotContentFromBlob",e[e.CaptureDesktopScreenshot=85]="CaptureDesktopScreenshot"}(t.NotificationType||(t.NotificationType={}));t.NotificationType}),define("../../Common/Constants",["require","exports"],function(e,t){var o=function(){function e(){}return e.focusAreaWidth=300,e.focusAreaHeight=60,e.runnerActionLogThumbnailWidth=200,e.runnerActionLogThumbnailHeight=100,e.thumbnailFocusAreaWidth=100,e.thumbnailFocusAreaHeight=60,e.thumbnailScaleFactor=.5,e.imageTageClassName="action-log-image",e.linkTageClassName="action-log-link",e.canvasId="image-editor",e.inputTextActionLogPrefix="Update input field with value",e.videoThumbnailClassName="xt-video-attachment",e.actionLogFileNamePrefix="actionLog-",e.actionLogFileFormat="jpeg",e.clickEventType="click",e.keyboardEventType="keyboard",e.actionLogsFileName="actionLog",e.stepHeader="Steps",e.actionHeader="Actions",e.imageHeader="Image",e.screenshotHeader="Full screen image",e.maxRunnerActionLogs=100,e.defaultActionLogCount=15,e.defaultActionLogBufferLength=20,e}();t.ActionLogConstants=o;var n=function(){function e(){}return e.enterKeyCode=13,e.escKeyCode=27,e.sKeyCode=83,e.rightArrow=39,e.leftArrow=37,e.downArrow=40,e.upArrow=38,e.spaceBar=32,e}();t.KeyCodeConstants=n;var i=function(){function e(){}return e.minFrameRate=1,e.maxFrameRate=60,e.defaultFrameRate=30,e.defaultWindowHeight=1280,e.vgaWindowHeight=640,e.defaultWindowWidth=720,e.vgaWindowWidth=360,e.captureIntervalInSeconds=1,e.maxVideoLengthInMinutes=10,e.optimalFrameRate=5,e.maxVideoSizeInBytes=52428800,e}();t.VideoCaptureConstants=i;var r=function(){function e(){}return e.defaultWorkItemCategoryColorMap={"Microsoft.BugCategory":"FFCC293D","Microsoft.TaskCategory":"FFF2CB1D","Microsoft.EpicCategory":"FFFF7B00","Microsoft.FeatureCategory":"FF773B93","Microsoft.RequirementCategory":"FF009CCC","Microsoft.TestCaseCategory":"FFFF9D00","Microsoft.SharedStepCategory":"FFFF9D00","Microsoft.SharedParameterCategory":"FFFF9D00","Microsoft.CodeReviewResponseCategory":"FFFF9D00","Microsoft.FeedbackRequestCategory":"FFFF9D00","Microsoft.FeedbackResponseCategory":"FFFF9D00","Microsoft.TestPlanCategory":"FFFF9D00","Microsoft.TestSuiteCategory":"FFFF9D00"},e.defaultWorkItemColor="FFCC293D",e}();t.WorkItemConstants=r;var a=function(){function e(){}return e.XTSource="XT",e.WebRunnerSource="WebRunner",e}();t.TelemetryConstants=a;var s=function(){function e(){}return e.maxRecords=7,e}();t.PerfDataConstants=s;var l=function(){function e(){}return e.exploratoryTestingExtensionGalleryId="ms.vss-exploratorytesting-web",e.testManagerExtensionGalleryId="ms.vss-testmanager-web",e}();t.CommonExtensionContants=l;var c=function(){function e(){}return e.stakeholderMode="stakeholder",e.teamMode="tfs",e.offlineMode="offline",e.connectedMode="connected",e}();t.ConnectionOptionConstants=c;var d=function(){function e(){}return e.pendingState="Pending",e.completedState="Completed",e.declinedState="Declined",e}();t.FeedbackStateOptionConstants=d;var g=function(){function e(){}return e.feedbackDetailsPageUrl="#/FeedbackRequestDetail",e.feedbackListsPageUrl="#/FeedbackRequests",e}();t.StakeHolderTraceabiltyPageUrls=g;var u=function(){function e(){}return e.unAuthorized="UnauthorizedAccessException",e}();t.ExceptionConstants=u;var h=function(){function e(){}return e.chromeBrowserName="Google Chrome",e.firefoxBrowserName="Mozilla Firefox",e.edgeBrowserName="Microsoft Edge",e}();t.BrowserConstants=h;var p=function(){function e(){}return e.xtMinimizeId="minimize-page",e}();t.ElementIds=p;var f=function(){function e(){}return e.login="To capture screen or action logs, make sure Test & Feedback extension is connected to {0}.",e}();t.Messages=f}),define("../../Model/BrowserHelper",["require","exports","../Common/Constants"],function(e,t,o){var n=function(){function e(){}return e.isChrome=function(){return chrome.extension.getURL("").split(this.hostSeparator)[0]===this.chromeExtensionHost},e.isFirefox=function(){return chrome.extension.getURL("").split(this.hostSeparator)[0]===this.firefoxExtensionHost},e.isEdge=function(){return chrome.extension.getURL("").split(this.hostSeparator)[0]===this.edgeExtensionHost},e.getBrowserInfo=function(){return e.isFirefox()?o.BrowserConstants.firefoxBrowserName:e.isEdge()?o.BrowserConstants.edgeBrowserName:o.BrowserConstants.chromeBrowserName},e.getOptionsPage=function(){return chrome.extension.getURL("options/options.html")},e.getSessionStorageDirectoryName=function(){return this.isChrome()?"Session":"Main"},e.chromeExtensionHost="chrome-extension:",e.firefoxExtensionHost="moz-extension:",e.edgeExtensionHost="ms-browser-extension:",e.hostSeparator="//",e}();t.BrowserHelper=n});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../../Messaging/ChromeMessaging",["require","exports","../Messaging/Messaging","../Model/BrowserHelper"],function(e,t,o,n){function i(){try{return window.self!==window.top}catch(e){return!0}}var r=o.NotificationType,a=function(){function e(){}return e.prototype.sendMessage=function(e,t,o,n){var i={notificationType:t,data:o};chrome.tabs.sendMessage(e,i,n)},e.prototype.queryTabs=function(e,t,o){chrome.tabs.query(e,function(e){var n=[];e.forEach(function(e){e.id!==t&&n.push({windowId:e.windowId,url:e.url,title:e.title})}),o(n)})},e}(),s=function(){function e(){}return e.prototype.broadcast=function(e,t,o){var n={notificationType:e,data:t};this.sendMessage(n,o)},e.prototype.broadcastAsync=function(e,t){if(i())throw"async messaging not supported in sandbox";var o=Q.defer();return this.broadcast(e,t,function(e){o.resolve(e)}),o.promise},e.prototype.sendMessage=function(e,t){},e}(),l=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.sendMessage=function(e,t){!t&&n.BrowserHelper.isEdge()&&(t=function(e){}),chrome.runtime.sendMessage(e,t)},t}(s),c=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.sendMessage=function(e,t){window.parent.postMessage(e,"*")},t}(s),d=function(){function e(){this.subscriptions={}}return e.prototype.subscribe=function(e,t){var o=this.subscriptions[t];o?this.subscriptions[t].push(e):(o=[],o.push(e),this.subscriptions[t]=o)},e.prototype.clearAll=function(){this.subscriptions={}},e.prototype.clearAllForNotificationType=function(e){this.subscriptions&&this.subscriptions[e]&&(this.subscriptions[e]=[])},e.prototype.notifySubscribers=function(e,t,o,n){var i=this.subscriptions[e];if(i)for(var r=0;r<i.length;r++)i[r](t,o,n)},e}(),g=function(e){function t(){var t=this;e.call(this),this.listenToMessages(function(e,o,n,i){t.notifySubscribers(e,o,n,i)})}return __extends(t,e),t.prototype.listenToMessages=function(e){chrome.runtime.onMessage.addListener(function(t,o,n){return t?(e(t.notificationType,t.data,n,o),n?!0:!1):void 0})},t}(d),u=function(e){function t(){var t=this;e.call(this),this.listenToMessages(function(e,o){t.notifySubscribers(e,o,null,null)})}return __extends(t,e),t.prototype.listenToMessages=function(e){window.addEventListener("message",function(t){t.data&&e(t.data.notificationType,t.data.data)})},t}(d),h=function(){function e(){}return e.getSubscriptionService=function(){return i()?e.getSandboxSubscriptionService():this.getChromeSubscriptionService()},e.getBroadcastingService=function(){return i()?e.getSandboxBroadcastingService():this.getChromeBroadcastingService()},e.getChromeMessagingTabService=function(){return e.chromeTabMessagingService?e.chromeTabMessagingService:(e.chromeTabMessagingService=new a,e.chromeTabMessagingService)},e.getSandboxSubscriptionService=function(){return e.sandboxSubscriptionService?e.sandboxSubscriptionService:(e.sandboxSubscriptionService=new u,e.sandboxSubscriptionService)},e.getChromeSubscriptionService=function(){return e.chromeSubscriptionService?e.chromeSubscriptionService:(e.chromeSubscriptionService=new g,e.chromeSubscriptionService)},e.getSandboxBroadcastingService=function(){return e.sandboxBroadcastingService?e.sandboxBroadcastingService:(e.sandboxBroadcastingService=new c,e.sandboxBroadcastingService)},e.getChromeBroadcastingService=function(){return e.chromeBroadcastingService?e.chromeBroadcastingService:(e.chromeBroadcastingService=new l,e.chromeBroadcastingService)},e}();t.MessagingFactory=h;var p=function(){function e(e){this._iframe=e,this._sandbox=e.contentWindow,this.listenToChromeMessages(),this.listenToSandboxMessages()}return e.prototype.listenToSandboxMessages=function(){var e=this;window.addEventListener("message",function(t){t.data&&t.data.resize&&t.data.height?e._iframe.style.height=t.data.height:e.sendMessageToChrome(t.data)})},e.prototype.sendMessageToChrome=function(e){e.notificationType===r.AnnotationToolReady?chrome.windows.getCurrent(function(t){e.data.windowId=t.id,chrome.runtime.sendMessage(e)}):chrome.runtime.sendMessage(e)},e.prototype.listenToChromeMessages=function(){var e=this;chrome.runtime.onMessage.addListener(function(t,o,n){t&&void 0!=t.notificationType&&e.sendMessageToSandbox(t)})},e.prototype.sendMessageToSandbox=function(e){this._sandbox.postMessage(e,"*")},e}();t.SandboxMessagingRelay=p});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../../Common/ExtensionStorage",["require","exports","../Messaging/ChromeMessaging","../Messaging/Messaging","../Model/BrowserHelper"],function(e,t,o,n,i){function r(){try{return window.self!==window.top}catch(e){return!0}}var a=i.BrowserHelper,s=function(){function e(){}return e.initializeService=function(){var e=this;o.MessagingFactory.getSubscriptionService().subscribe(function(t){o.MessagingFactory.getBroadcastingService().broadcast(n.NotificationType.FetchObjectFromLocalStorageResponse,e.retrieve(t))},n.NotificationType.FetchObjectFromLocalStorage)},e.store=function(e,o){localStorage.setItem(t.ngStoragePrefix+e,JSON.stringify(o))},e.retrieve=function(e){return JSON.parse(localStorage.getItem(t.ngStoragePrefix+e))},e.retrieveAsync=function(e,i){if(r())o.MessagingFactory.getBroadcastingService().broadcast(n.NotificationType.FetchObjectFromLocalStorage,e),o.MessagingFactory.getSubscriptionService().subscribe(function(e){i(JSON.parse(e))},n.NotificationType.FetchObjectFromLocalStorageResponse);else{var a=localStorage.getItem(t.ngStoragePrefix+e);i(JSON.parse(a))}},e.remove=function(o){localStorage.removeItem(t.ngStoragePrefix+o),a.isEdge()&&e.store(o,null)},e}();t.LocalStorageService=s;var l=function(){function e(){}return e.getStorageService=function(){return this.storageService?this.storageService:(a.isChrome()?this.storageService=new g:this.storageService=new d,this.storageService)},e}();t.PersistentStorageFactory=l;var c=function(){function e(){}return e.prototype.getBlobContentAsync=function(e,t){void 0===t&&(t=!0);var o=Q.defer();return this.getBlob(e,function(e){if(e){var t=new FileReader;t.onloadend=function(e){o.resolve(t.result)},t.readAsText(e)}else o.resolve(null)},o.reject,t),o.promise},e}();t.BaseStorageService=c;var d=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.writeBlobInDir=function(e,t,o,n,i,r){var a=this;void 0===r&&(r=!1),r?this.openIndexDb(e,function(e){a.getFile(e,t,!1,function(r){var s=new Blob([r,o],{type:o.type});a.storeFile(e,t,s,n,i)},i)},i):this.openIndexDb(e,function(e){a.storeFile(e,t,o,n,i)},i)},t.prototype.writeBlob=function(e,t,o,n,i,r){var a=this;void 0===i&&(i=!1),void 0===r&&(r=!0);var s=this.getFileInfo(e,r);i?this.openIndexDb(s.dbName,function(e){a.getFile(e,s.fileName,!1,function(i){var r=new Blob([i,t],{type:t.type});a.storeFile(e,s.fileName,r,o,n)},n)},n):this.openIndexDb(s.dbName,function(e){a.storeFile(e,s.fileName,t,o,n)},n)},t.prototype.storeFile=function(e,t,o,n,i){e.blobs.put({name:t,data:o}).then(function(){e.close(),n(URL.createObjectURL(o))})["catch"](function(t){e.close(),i(t)})},t.prototype.getBlob=function(e,t,o,n){var i=this;void 0===n&&(n=!0);var r=this.getFileInfo(e,n);this.openIndexDb(r.dbName,function(e){i.getFile(e,r.fileName,!0,t,o)},o)},t.prototype.getFile=function(e,t,o,n,i){e.blobs.get(t).then(function(t){o&&e.close(),n(t?t.data:null)})["catch"](function(t){o&&e.close(),i(t)})},t.prototype.removeBlobInDir=function(e,t,o,n){this.openIndexDb(e,function(e){e.blobs.clear(t).then(function(){e.close(),o()})["catch"](function(t){e.close(),n(t)})},n)},t.prototype.removeBlob=function(e,t,o,n){void 0===n&&(n=!0);var i=this.getFileInfo(e,n);this.removeBlobInDir(i.dbName,i.fileName,t,o)},t.prototype.createDirectory=function(e,t,o,n){var i=new Dexie(e);i.version(1).stores({blobs:"name,data"}),o(e)},t.prototype.removeDirectory=function(e,t,o,n){this.openIndexDb(e,function(t){t.blobs.clear().then(function(){t.close(),o(e)})["catch"](function(e){t.close(),n(e)})},n)},t.prototype.openIndexDb=function(e,t,o){var n=new Dexie(e);n.version(1).stores({blobs:"name,data"}),n.open()["catch"](function(e){o(e)}),t(n)},t.prototype.getFileInfo=function(e,t){var o=e.split("/");if(1===o.length)var n=e.substr(0,4),i=t?a.getSessionStorageDirectoryName():n;else i=o[0],e=o[1];return{dbName:i,fileName:e}},t}(c);t.IndexDatabaseStorageService=d;var g=function(e){function o(){e.apply(this,arguments)}return __extends(o,e),o.prototype.writeBlobInDir=function(e,t,o,n,i,r){if(void 0===r&&(r=!1),!this.isUnitTest()){var a=e.concat("/").concat(t);PersistentStorageProxy.writeBlob(a,o,n,i,r)}},o.prototype.writeBlob=function(e,t,o,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0),this.isUnitTest()||PersistentStorageProxy.writeBlob(this.getFilePath(e,r),t,o,n,i)},o.prototype.getBlob=function(e,t,o,n){void 0===n&&(n=!0),this.isUnitTest()||PersistentStorageProxy.getBlob(this.getFilePath(e,n),t,o)},o.prototype.removeBlobInDir=function(e,t,o,n){if(!this.isUnitTest()){var i=e.concat("/").concat(t);PersistentStorageProxy.removeBlob(i,o,n)}},o.prototype.removeBlob=function(e,t,o,n){void 0===n&&(n=!0),this.isUnitTest()||PersistentStorageProxy.removeBlob(this.getFilePath(e,n),t,o)},o.prototype.createDirectory=function(e,t,o,n){this.isUnitTest()||PersistentStorageProxy.createDirectory(e,t,o,n)},o.prototype.removeDirectory=function(e,t,o,n){this.isUnitTest()||PersistentStorageProxy.removeDirectory(e,t,o,n)},o.prototype.getFilePath=function(e,o){if(void 0===o&&(o=!0),!o)return e;var n=s.retrieve(t.activeSessionKey);return n&&1===n.version?n.id.concat("/").concat(e):a.getSessionStorageDirectoryName().concat("/").concat(e)},o.prototype.isUnitTest=function(){return"true"===localStorage.getItem("isUnitTest")},o}(c);t.PersistentStorageService=g,t.activeSessionKey="activeSession",t.actionLogUrlKey="actionLogUrl",t.actionLogUrl_DataCollectorKey="actionLogUrl_DataCollector",t.activeScreenShotAndWindowIdMap="activeScreenShotAndWindowIdMap",t.activeScreenShotAndWindowIdMap_Datacollector="activeScreenShotAndWindowIdMap_DataCollector",t.toolbarErrorMap="toolbarErrorMap",t.activeSettingsKey="activeSettings",t.activeAnnotationSettingsKey="activeAnnotationSettings",t.notesCountKey="numberOfNotesInSession",t.videosCountKey="numberOfVideosInSession",t.enableAudio="enableAudio",t.currentVideoCaptureIdKey="currentVideoCaptureId",t.currentVideoCaptureId_DataCollectorKey="currentVideoCaptureId_DataCollector",t.activeVideoCaptureRequestPresent="videoCaptureRequestPresent",t.activeVideoCaptureRequestPresent_DataCollector="videoCaptureRequestPresent_DataCollector",t.videoFileFormatKey="videoFileFormat",t.videoFileFormat_DataCollectorKey="videoFileFormat_DataCollector",t.currentVideoCaptureTimeKey="elapsedVideoTime",t.currentVideoCaptureTime_DataCollectorKey="elapsedVideoTime_DataCollector",t.browserCloseEventsWhileVideoRecordingKey="browserCloseEventsWhileVideoRecording",t.browserCloseEventsWhileVideoRecording_DataCollectorKey="browserCloseEventsWhileVideoRecording_DataCollector",t.browserCloseEventsWhileVideoUploadingKey="browserCloseEventsWhileVideoUploading",t.screenshotsCountKey="numberOfScreenshotsInSession",t.ngStoragePrefix="ngStorage-",t.connectionSettingsKey="connectionSettings",t.basicConnectionSettingsKey="basicConnectionSettings",t.connectionOptionKey="connectionOption",t.connectedModeKey="connectedMode",t.changeTeamDetailsKey="changeTeamDetails",t.loginInProgressKey="loginInProgress",t.mostRecentlyUsedUrlsKey="mostRecentlyUsedUrls",t.initialBaseUrlKey="initialBaseUrl",t.refreshingKey="refreshing",t.loggedInKey="loggedIn",t.reconnectKey="reconnected",t.deviceListLocalStorageKey="perfectoMobileDeviceList",t.mobileXtUrlKey="perfectoCloudUrl",t.mobileXtUsernameKey="perfectoUserName",t.iconBlinkKey="iconBlink",t.lastUrlKey="lastUrl",t.useSoapApiForUpgradeKey="useSoapApiForUpgrade",t.useSoapApiFprUpgradeKey="useSoapApiFprUpgrade",t.perfAttachmentCountKey="perfAttachmentCount",t.perfDataMaxRecords="perfDataMaxRecords",t.perfDataNextIndex="perfDataNextIndex",t.lastUrlBeforeNotificationKey="lastUrlBeforeNotification",t.isNotificationDismissedKey="isNotificationDismissed",t.linkedWorkItemKey="linkedWorkItem",t.searchResultsForTraceabilityKey="searchResultsForTraceability",t.searchResultsForFeedbackRequestsKey="searchResultsForFeedbackRequests",t.traceabilityEnabledKey="traceabilityEnabled",t.workItemQueryPatternForTraceabilityKey="workItemQueryPatternForTraceability",t.lastSearchedQueryPatternKey="lastSearchedQueryPattern",t.workItemSearchInProgressKey="workItemSearchInProgress",t.notifyTimelineForTraceabilityKey="notifyTimelineForTraceability",t.similarBugsKey="searchResultsForSimilarBugs",t.selectedBugKey="selectedBugForUpdate",t.selectedBugDescriptionKey="selectedBugDescriptionKey",t.isBugSelectedForUpdateKey="isBugSelectedForUpdate",t.taskFormDirtyKey="taskFormDirty",t.taskTitleDirtyKey="taskTitleDirty",t.unsavedTaskDescriptionKey="unsavedTaskDescription",t.unsavedTaskTitleKey="unsavedTaskTitle",t.includeImageActionLogsInTaskKey="includeImageActionLogsInTask",t.selectedFeedbackRequestApplicationLaunchKey="selectedFeedbackRequestApplicationLaunch",t.selectedFeedbackRequestKey="selectedFeedback",t.isProvideFeedbackInitiatedFromWeb="isProvideFeedbackInitiatedFromWeb",t.bugFormDirtyKey="bugFormDirty",t.bugTitleDirtyKey="bugTitleDirty",t.unsavedBugTitleKey="unsavedBugTitle",t.searchResultsForSimilarBugsKey="searchResultsForSimilarBugs",t.selectedBugForUpdateKey="selectedBugForUpdate",t.includeImageActionLogsInBugKey="includeImageActionLogsInBug",t.testCaseFormDirtyKey="testCaseFormDirty",t.unsavedTestCaseStepsKey="unsavedTestCaseSteps",t.unsavedTestCaseTitleKey="unsavedTestCaseTitle",t.feedbackResponseFormDirtyKey="feedbackResponseFormDirty",t.feedbackResponseTitleDirtyKey="feedbackResponseTitleDirty",t.unsavedFeedbackResponseDescriptionKey="unsavedFeedbackResponseDescription",t.unsavedFeedbackResponseTitleKey="unsavedFeedbackResponseTitle",t.includeImageActionLogsInFeedbackResponseKey="includeImageActionLogsInFeedbackResponse",t.includePerfDataInFeedbackResponseKey="includePerfDataInFeedbackResponse",t.groupingDetails="groupingDetails",t.traceabilityRequestKey="traceabilityRequest",t.iconBeforeErrorKey="iconBeforeError",t.currentIconKey="currentIcon",t.offlineReport="offlineReport",t.reportDirectoryName="Reports",t.actionLogKey="ActionLog",t.newBranding="NewBranding",t.sessionActionLogMaxCountKey="sessionActionLogMaxCount",t.exportedSessionReportPath="Reports/SessionReport.html",t.extensionUniqueIdentifier="ExtensionID",t.actionLogFullImageSizeInBytes="actionLogFullImageSizeInKB",t.isImageActionLogTurnedOnDuringUpgrade="isImageActionLogTurnedOnDuringUpgrade",t.supportTfsSessionCompactKey="supportTfsSessionCompact",t.currentVersionKey="currentVersion",t.workItemTypeMetaDataCache="workItemTypeMetaDataCache",t.workItemCategoryMetaDataCache="workItemCategoryMetaDataCache",t.bugWorkItemTypeCache="bugWorkItemTypeCache",t.alertInformationKey="alertInformation",t.licenseUpdatedDateTimeKey="licenseUpdatedDateTime",t.licenseUpdateIntervalKey="licenseUpdateIntervalInHrs",t.selectedFeedbackRequestWorkitemObjectKey="selectedFeedbackRequestWorkitemObject",t.teamSettingsKey="teamSettings",t.forceStopSessionReason="forceStopSessionReason"}),define("../../Model/Model",["require","exports"],function(e,t){!function(e){e[e.Session=0]="Session",e[e.ScreenShot=1]="ScreenShot",e[e.Note=2]="Note",e[e.Bug=3]="Bug",e[e.Bug2=4]="Bug2",e[e.TimeLine=5]="TimeLine",e[e.Settings=6]="Settings",e[e.MobileXt=7]="MobileXt",e[e.Traceability=8]="Traceability",e[e.About=9]="About",e[e.Task=10]="Task",e[e.TestCase=11]="TestCase",e[e.Video=12]="Video",e[e.FeedbackResponse=13]="FeedbackResponse",e[e.FeedbackRequests=14]="FeedbackRequests",e[e.ScreenShotScreen=15]="ScreenShotScreen",e[e.ScreenShotApplication=16]="ScreenShotApplication"}(t.ToolbarType||(t.ToolbarType={}));t.ToolbarType;!function(e){e[e.BrowserTab=0]="BrowserTab",e[e.Screen=1]="Screen",e[e.Application=2]="Application"}(t.ScreenshotType||(t.ScreenshotType={}));t.ScreenshotType;!function(e){e[e.Off=0]="Off",e[e.AsRequirements=1]="AsRequirements",e[e.AsTasks=2]="AsTasks"}(t.BugsBehavior||(t.BugsBehavior={}));t.BugsBehavior;!function(e){e[e.Unknown=0]="Unknown",e[e.XTDesktop=1]="XTDesktop",e[e.FeedbackDesktop=2]="FeedbackDesktop",e[e.XTWeb=3]="XTWeb",e[e.FeedbackWeb=4]="FeedbackWeb"}(t.TestSessionSource||(t.TestSessionSource={}));var o=(t.TestSessionSource,function(){function e(){}return e.testPlanIdString="TestPlanId",e.feedbackRequestIdString="FeedbackRequestId",e}());t.TestSessionConstants=o;var n=function(){function e(){}return e.solicited="Solicited",e.unsolicited="UnSolicited",e.none="None",e}();t.FeedbackTypeConstants=n,function(e){e[e.None=0]="None",e[e.InProgress=1]="InProgress",e[e.Completed=2]="Completed",e[e.Paused=3]="Paused",e[e.Declined=4]="Declined"}(t.SessionState||(t.SessionState={}));t.SessionState;!function(e){e[e["0 - Not Rated"]=0]="0 - Not Rated",e[e["1 - Poor"]=1]="1 - Poor",e[e["2 - Fair"]=2]="2 - Fair",e[e["3 - Good"]=3]="3 - Good",e[e["4 - Very Good"]=4]="4 - Very Good",e[e["5 - Excellent"]=5]="5 - Excellent"}(t.FeedbackResponseRating||(t.FeedbackResponseRating={}));t.FeedbackResponseRating;!function(e){e[e.NotStarted=1]="NotStarted",e[e.InProgress=2]="InProgress",e[e.Completed=4]="Completed"}(t.ServerSessionState||(t.ServerSessionState={}));t.ServerSessionState;!function(e){e[e.Created=0]="Created",e[e.ContainerCreated=1]="ContainerCreated",e[e.Uploaded=2]="Uploaded",e[e.Failed=3]="Failed"}(t.AttachmentState||(t.AttachmentState={}));t.AttachmentState;!function(e){e[e.Screenshot=0]="Screenshot",e[e.SystemInformation=1]="SystemInformation",e[e.Note=2]="Note",e[e.Video=3]="Video",e[e.ActionLog=4]="ActionLog",e[e.PerfData=5]="PerfData"}(t.AttachmentType||(t.AttachmentType={}));var i=(t.AttachmentType,function(){function e(){}return e}());t.CaptureWindowPayload=i,function(e){e[e.Mouse=1]="Mouse",e[e.Keyboard=2]="Keyboard"}(t.ActionLogType||(t.ActionLogType={}));var r=(t.ActionLogType,function(){function e(){}return e}());t.IActionLogReportPayload=r,function(e){e[e.TFS_CONNECTION_FAILED=1]="TFS_CONNECTION_FAILED",e[e.TFS_AUTH_FAILED=2]="TFS_AUTH_FAILED",e[e.WINDOW_NOT_FOUND=3]="WINDOW_NOT_FOUND",e[e.SCREEN_RECORDING_DISABLED=4]="SCREEN_RECORDING_DISABLED",e[e.DATACOLLECTION_ALREADY_INPROGRESS=5]="DATACOLLECTION_ALREADY_INPROGRESS",e[e.TAB_NOT_REACHABLE=6]="TAB_NOT_REACHABLE",e[e.ACTIONLOG_FEATURE_DISABLED=7]="ACTIONLOG_FEATURE_DISABLED",e[e.MICROPHONE_NOTFOUND=8]="MICROPHONE_NOTFOUND"}(t.ErrorCode||(t.ErrorCode={}));var a=(t.ErrorCode,function(){function e(){}return e}());t.IConnectedUserDetails=a,function(e){e[e.AnnotationSettings=0]="AnnotationSettings",e[e.WorkItemFiling=1]="WorkItemFiling",e[e.VsoSessionSettings=2]="VsoSessionSettings",e[e.DeviceProvider=3]="DeviceProvider",e[e.Traceability=4]="Traceability",e[e.TestCaseForm=5]="TestCaseForm",e[e.VideoCapture=6]="VideoCapture",e[e.ActionLog=7]="ActionLog",e[e.QueryFeedbackRequestsData=8]="QueryFeedbackRequestsData",e[e.ProvideFeedback=9]="ProvideFeedback",e[e.FirefoxInstallEvent=10]="FirefoxInstallEvent"}(t.TelemetryEvent||(t.TelemetryEvent={}));t.TelemetryEvent;!function(e){e[e.ConnectedModeAvailable=0]="ConnectedModeAvailable",e[e.TrialModeOn=1]="TrialModeOn",e[e.TrialModeExpired=2]="TrialModeExpired"}(t.AlertType||(t.AlertType={}));t.AlertType;!function(e){e[e.Offline=0]="Offline",e[e.VSTS=1]="VSTS",e[e.TFS=2]="TFS"}(t.ServerType||(t.ServerType={}));var s=(t.ServerType,function(){function e(){}return e.epic="Epic",e.productBacklogItem="Product Backlog Item",e.testCase="Test Case",e.userStory="User Story",e.feature="Feature",e.scenario="Scenario",e.requirement="Requirement",e.bug="Bug",e.task="Task",e.feedbackResponse="Feedback Response",e}());t.WorkItemType=s;var l=function(){function e(){}return e.BugCategory="Microsoft.BugCategory",e.TaskCategory="Microsoft.TaskCategory",e.TestCaseCategory="Microsoft.TestCaseCategory",e.ScenarioCategory="Microsoft.ScenarioCategory",e.EpicCategory="Microsoft.EpicCategory",e.RequirementCategory="Microsoft.RequirementCategory",e.FeatureCategory="Microsoft.FeatureCategory",e.FeedbackResponseCategory="Microsoft.FeedbackResponseCategory",e.FeedbackRequestCategory="Microsoft.FeedbackRequestCategory",e.HiddenCategory="Microsoft.HiddenCategory",e}();t.WorkItemCategories=l;var c=function(){function e(){}return e.workItemType="System.WorkItemType",e.id="System.Id",e.title="System.Title",e.iterationPath="System.IterationPath",e.assignedTo="System.AssignedTo",e.workItemState="System.State",e.acceptanceCriteria="Microsoft.VSTS.Common.AcceptanceCriteria",e.description="System.Description",e.areaPath="System.AreaPath",e.reproSteps="Microsoft.VSTS.TCM.ReproSteps",e.systemInfo="Microsoft.VSTS.TCM.SystemInfo",e.applicationStartInfo="Microsoft.VSTS.Feedback.ApplicationStartInformation",e.applicationLaunchInstruction="Microsoft.VSTS.Feedback.ApplicationLaunchInstructions",e.createdBy="System.CreatedBy",e.createdDate="System.CreatedDate",e.url="url",e.startTime="startTime",e.relations="Relations",e}();t.WorkItemField=c;var d=function(){function e(){}return e.relatedLink="System.LinkTypes.Related",e.relatedLinkForward="System.LinkTypes.Related-Forward",e.parentLink="System.LinkTypes.Hierarchy-Reverse",e.testedByForward="Microsoft.VSTS.Common.TestedBy-Forward",e.testedByReverse="Microsoft.VSTS.Common.TestedBy-Reverse",e}();t.WorkItemRelations=d;var g=function(){function e(){}return e.filedWorkItemKey="AssociatedWorkItem",e.exploredWorkItemKey="ExploredWorkItem",e}();t.SessionKeys=g;var u=function(){function e(e,t,o,n){this.eventType=e,this.timing=t,this.requestURL=o,this.eventData=n}return e}();t.PerfData=u;var h=function(){function e(){}return e}();t.PerfResourceData=h;var p=function(){function e(e,t){this.serverUrl=e,this.lastAccessedTime=t}return e}();t.MostRecentlyUsedUrls=p});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../../Common/SessionData",["require","exports","../Common/ExtensionStorage"],function(e,t,o){!function(e){e[e.chromeScreenCapture=0]="chromeScreenCapture",e[e.chromeDesktopCapture=1]="chromeDesktopCapture"}(t.chromeApiType||(t.chromeApiType={}));var n=(t.chromeApiType,function(){function e(e,t,o,n,i,r){this._screenshotDefaultPrefix="Screenshot-",this.id=e,this.content=t,o&&(this.state=o),this.isXTSession=i,n?this.name=n:this.name=this._generateScreenshotName(),null!=r&&(this.chromeApiType=r)}return e.prototype.setPosition=function(e,t){this.top=e,this.left=t},e.prototype.setDimension=function(e,t){
this.width=e,this.height=t},e.prototype._generateScreenshotName=function(){return this._screenshotDefaultPrefix.concat(this._generateScreenshotSuffix())},e.prototype._generateScreenshotSuffix=function(){if(this.isXTSession)return this._getScreenshotCountAndUpdateInLocalStorage().toString();var e=new Date(Date.now());return e.toISOString().replace(/:/g,"-")},e.prototype._getScreenshotCountAndUpdateInLocalStorage=function(){var e=o.LocalStorageService.retrieve(o.screenshotsCountKey);return e?e+=1:e=1,o.LocalStorageService.store(o.screenshotsCountKey,e),e},e}());t.Screenshot=n;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(n);t.ScreenshotEx=i;var r=function(){function e(e,t){this.id=e,this.content=t}return e}();t.SystemInformation=r;var a=function(){function e(e,t){this.notesPrefix="Note-",this.content=e,this.size=t,this.id=this.getNoteId()}return e.prototype.getNoteId=function(){var e=o.LocalStorageService.retrieve(o.notesCountKey),t=parseInt(e)+1;return o.LocalStorageService.store(o.notesCountKey,t),this.notesPrefix.concat(t.toString())},e}();t.Note=a;var s=function(){function e(e,t){this.videoPrefix="ScreenRecording-",this.size=e,this.isXTSession=t,this.id=this.getVideoId()}return e.prototype.getVideoId=function(){if(this.isXTSession){var e=o.LocalStorageService.retrieve(o.videosCountKey),t=parseInt(e)+1;o.LocalStorageService.store(o.videosCountKey,t);var n=o.LocalStorageService.retrieve(o.videoFileFormatKey);return n=null===n?"webm":n,this.videoPrefix.concat(t.toString()).concat("."+n)}var n=o.LocalStorageService.retrieve(o.videoFileFormat_DataCollectorKey);n=null===n?"webm":n;var i=new Date(Date.now());return this.videoPrefix.concat(i.toISOString().replace(/:/g,"-")).concat("."+n)},e}();t.Video=s;var l=function(){function e(e){this.actionLogPrefix="ActionLog-",this.fileFormat=".html",this.size=e,this.id=this.getActionLogId()}return e.getActionLogSessionData=function(t,o,n){var i=new e(n);return i.id=t?t:i.id,i.content=o?o:i.content,i},e.prototype.getActionLogId=function(){var e=new Date(Date.now());return this.actionLogPrefix.concat(e.toISOString().replace(/:/g,"-")).concat(this.fileFormat)},e}();t.ActionLog=l;var c=function(){function e(e,t,o){this.content=e,this.size=t,this.id=o}return e}();t.PerfData=c}),define("../../Model/BrowserActionService",["require","exports","../Common/ExtensionStorage","../Model/Model"],function(e,t,o,n){function i(){s||(s=new c)}function r(){return s||i(),s}function a(){s=null}t.initializeService=i,t.getService=r,function(e){e[e.Default=0]="Default",e[e.InProgress=1]="InProgress",e[e.Error=2]="Error",e[e.Empty=3]="Empty"}(t.ExtensionIconType||(t.ExtensionIconType={}));var s,l=t.ExtensionIconType;t.deinitializeService=a;var c=function(){function e(){this.iconLookup={},this.iconWidth=19,this.iconHeight=19,this.iconLookup[l.Default]="../../Images/NormalState-",this.iconLookup[l.InProgress]="../../Images/SessionOnState-",this.iconLookup[l.Error]="../../Images/ErrorState-";var e=o.LocalStorageService.retrieve(o.activeSessionKey);e&&e.state===n.SessionState.InProgress?(o.LocalStorageService.store(o.iconBeforeErrorKey,l.InProgress),o.LocalStorageService.store(o.currentIconKey,l.InProgress)):(o.LocalStorageService.store(o.iconBeforeErrorKey,l.Default),o.LocalStorageService.store(o.currentIconKey,l.Default))}return e.prototype.setIcon=function(e){if(e===l.Empty){var t=document.createElement("canvas"),n=t.getContext("2d").createImageData(this.iconWidth,this.iconHeight);chrome.browserAction.setIcon({imageData:n})}else{var i=this.iconLookup[e];o.LocalStorageService.store(o.currentIconKey,e),e!==l.Error&&o.LocalStorageService.store(o.iconBeforeErrorKey,e),chrome.browserAction.setIcon({path:{19:i+"19.png",38:i+"38.png"}})}},e.prototype.clearError=function(){this.setIcon(o.LocalStorageService.retrieve(o.iconBeforeErrorKey))},e.prototype.getCurrentIconState=function(){return o.LocalStorageService.retrieve(o.currentIconKey)},e}()}),define("../../Common/ResourceStrings",["require","exports"],function(e,t){var o=function(){function e(){}return e.productNameShort="TF",e.productName="Test & Feedback",e.Tfs2015Name="TFS 2015",e.Tfs2017Name="TFS 2017",e.productNameWithExtension=e.productName+" extension",e.buyProductTitleString="Buy "+e.productName+" extension",e.trialExpiredTitleString="Your 30-day trial has expired",e.trialAboutToExpireTitleString="Your trial will expire in {0}",e.startTrialMessage="The preview of "+e.productName+" extension has ended. To continue using this extension in Connected mode, select an option below. We'll send a request to your admin.",e.trialExpiredMessage="To continue using "+e.productName+" in Connected mode, select Buy. We'll send a request to your admin.",e.trialAboutToExpireMessage="To continue using "+e.productName+" in Connected mode after trial ends, select Buy. We'll send a request to your admin.",e.trialNotificationContactAdminFooter="You can use Connected mode when your admin approves your request.",e.trialNotificationContinueFooter="For now, you can keep using "+e.productName+" in Standalone mode for free!",e.trialNotificationConitnueFooter2="And remember, you can use "+e.productName+" in Standalone mode for free!",e.stakeholderTfsNotSupportedMessage="TFS version you are connecting to is not supported. Use "+e.Tfs2017Name+" and above to respond to feedback requests.",e.teamModeTfsNotSupportedMessage="TFS version you are connecting to is not supported. Use "+e.Tfs2015Name+" and above to use in connected mode.",e}();t.ResourceStrings=o}),define("../../Common/ResourceHelper",["require","exports","../Common/ResourceStrings"],function(e,t,o){function n(){return o.ResourceStrings.productNameShort}function i(){return o.ResourceStrings.productName}function r(){return o.ResourceStrings.productNameWithExtension}function a(){return o.ResourceStrings.buyProductTitleString}function s(){return o.ResourceStrings.trialExpiredTitleString}function l(){return o.ResourceStrings.trialAboutToExpireTitleString}function c(){return o.ResourceStrings.startTrialMessage}function d(){return o.ResourceStrings.trialExpiredMessage}function g(){return o.ResourceStrings.trialAboutToExpireMessage}function u(){return o.ResourceStrings.trialNotificationContactAdminFooter}function h(){return o.ResourceStrings.trialNotificationContinueFooter}function p(){return o.ResourceStrings.trialNotificationConitnueFooter2}function f(){return o.ResourceStrings.stakeholderTfsNotSupportedMessage}function m(){return o.ResourceStrings.teamModeTfsNotSupportedMessage}t.getProductNameShortMessage=n,t.getProductNameMessage=i,t.getProductNameWithExtensionMessage=r,t.getBuyProductTitleMessage=a,t.getTrialExpiredTitleMessage=s,t.getTrialAboutToExpireTitleMessage=l,t.getStartTrialMessage=c,t.getTrialExpiredMessage=d,t.getTrialAboutToExpireMessage=g,t.getTrialNotificationContactAdminFooterMessage=u,t.getTrialNotificationContinueFooterMessage=h,t.getTrialNotificationConitnueFooter2Message=p,t.getTFSNotSupportedMessageForStakeholder=f,t.getTFSNotSupportedMessageForBasicUser=m}),define("../../Popup2/Common/ResourceUtility.Service",["require","exports","../../Common/ResourceHelper"],function(e,t,o){var n=function(){function e(){}return e.prototype.getProductNameMessage=function(){return o.getProductNameMessage()},e.prototype.getProductNameWithExtensionMessage=function(){return o.getProductNameWithExtensionMessage()},e.getProductNameShortMessage=function(){return o.getProductNameShortMessage()},e.GetProductNameMessage=function(){return o.getProductNameMessage()},e.GetProductNameWithExtensionMessage=function(){return o.getProductNameWithExtensionMessage()},e}();t.ResourceUtilityService=n}),define("../../Common/Types",["require","exports"],function(e,t){function o(){var e=(128+Math.floor(64*Math.random())).toString(16);return n(8)+"-"+n(4)+"-4"+n(3)+"-"+e+n(2)+"-"+n(12)}function n(e){if(!e)return Math.floor(16*Math.random()).toString(16);for(var t="",o=0;e>o;o++)t+=n();return t}function i(e){var t=!0;return e&&e.length>0&&(t=!1),t}function r(e,t){return i(e)?!1:e.lastIndexOf(t)+t.length===e.length?!0:!1}function a(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return s(!1,e,t)}function s(e,t,o){for(var n="",i=0;;){var r=t.indexOf("{",i),a=t.indexOf("}",i);if(0>r&&0>a){n+=t.slice(i);break}if(a>0&&(r>a||0>r)){if("}"!==t.charAt(a+1))throw new Error("The format string contains an unmatched opening or closing brace.");n+=t.slice(i,a+1),i=a+2}else if(n+=t.slice(i,r),i=r+1,"{"!==t.charAt(i)){if(0>a)throw new Error("The format string contains an unmatched opening or closing brace.");var s=t.substring(i,a),l=s.indexOf(":"),c=parseInt(0>l?s:s.substring(0,l),10);if(isNaN(c))throw new Error("The format string is invalid.");var d=0>l?"":s.substring(l+1),g=o[c];("undefined"==typeof g||null===g)&&(g=""),n+=g.toFormattedString?g.toFormattedString(d):g.format?g.format(d):g.toString(),i=a+1}else n+="{",i++}return n}t.newGuid=o,t.isStringNullOrEmpty=i,t.endsWith=r,t.stringFormat=a}),define("../../Common/FeatureAvailabiliy",["require","exports","../Common/ExtensionStorage","../Messaging/ChromeMessaging","../Messaging/Messaging"],function(e,t,o,n,i){var r=function(){function e(){}return e.initialize=function(){var e=this;this._subscriptionService=n.MessagingFactory.getSubscriptionService(),this._subscriptionService.subscribe(function(t,o){e.isFeatureEnabled(t.flagType)&&o()},i.NotificationType.FeatureFlagStatus),this.updateDefaultFeatureStatesInLocalStore()},e.updateDefaultFeatureStatesInLocalStore=function(){for(var e in this.defaultFeatureStates)if(!this.doesFeatureExists(e)&&this.defaultFeatureStates.hasOwnProperty(e)){var t=this.defaultFeatureStates[e];o.LocalStorageService.store(e,t),e===a[a.ActionLog]&&chrome.storage.local.set(this.getFeatureFlagJson(e,t))}},e.isFeatureEnabled=function(e){return o.LocalStorageService.retrieve(a[e])||!1},e.doesFeatureExists=function(e){return null!==o.LocalStorageService.retrieve(e)},e.setFeatureFlagState=function(e,t){var n=a[e];o.LocalStorageService.store(n,t),e===a.ActionLog&&chrome.storage.local.set(this.getFeatureFlagJson(n,t))},e.getFeatureFlagJson=function(e,t){var o={};return o[e]=t,o},e.defaultFeatureStates={ActionLog:!0,Task:!0,SearchSimilarBugs:!0,OfflineMode:!0,RestApiForSession:!0,PerfData:!0,RunnerActionLog:!0,XTTrialMode:!1,OngoingRecording:!0,StakeholderMode:!0},e}();t.FeatureAvailibilityService=r,function(e){e[e.ActionLog=0]="ActionLog",e[e.Task=1]="Task",e[e.SearchSimilarBugs=2]="SearchSimilarBugs",e[e.OfflineMode=3]="OfflineMode",e[e.RestApiForSession=4]="RestApiForSession",e[e.PerfData=5]="PerfData",e[e.RunnerActionLog=6]="RunnerActionLog",e[e.XTTrialMode=7]="XTTrialMode",e[e.OngoingRecording=8]="OngoingRecording",e[e.StakeholderMode=9]="StakeholderMode",e[e.NewBranding=10]="NewBranding"}(t.FeatureFlag||(t.FeatureFlag={}));var a=t.FeatureFlag}),define("../../Popup2/CommonControls/InputDropdown.Template",["require","exports"],function(e,t){t.inputDropdownControlTemplate='<div id="input-mrutfsurls">  <div class ="typeahead-dropdown-icon bowtie-triangle-down bowtie-icon dropdown-button" role="button" aria-label="Open drop down" tabIndex="0" aria-pressed="{{ isDropOpen }}" ng-click="onDropDownClick()" ng-mousedown="onMouseDown($event)" ng-keydown="onKeyDown($event)" ng-if="isDropButtonVisible()"> </div>  <input class="typeahead" type= "text" aria-labelledby="team-services-url" placeholder=" Enter Team Services / Team Foundation Server url" ng-model="url"></div>',t.inputDropdownControlTemplateNewBranding='<div id="input-mrutfsurls">  <div class ="typeahead-dropdown-icon bowtie-triangle-down bowtie-icon dropdown-button" role="button" aria-label="Open drop down" tabIndex="0" aria-pressed="{{ isDropOpen }}" ng-click="onDropDownClick()" ng-mousedown="onMouseDown($event)" ng-keydown="onKeyDown($event)" ng-if="isDropButtonVisible()"> </div>  <input class="typeahead" type= "text" aria-labelledby="team-services-url" placeholder=" Enter Azure DevOps Services / Team Foundation Server url" ng-model="url"></div>'}),define("../../Popup2/SignIn/SignIn.Template",["require","exports"],function(e,t){t.signInTemplate='<div class="sign-in-page" ng-controller="SignInFormController as controller" ng-escape="controller.utilityService.minimizeForm()">    <error-control></error-control>    <div class="form-container">        <div role="group" aria-labelledby="connection-settings">           <div id="connection-settings" class="sign-in-page-title">               <legend>Connection settings</legend>           </div>           <div class="sign-in-option">               <div class="{{ controller.$localStorage.activeSession.state | ChangeClassFilter: \'tfs-option\'}}">                   <input id="connected-radio-button" type="radio" aria-labelledby="connected" name="connection" value="connected" ng-disabled="controller.$localStorage.activeSession.state === 1" ng-change="controller.changeConnectionOption()" ng-model="controller.connectionOption">                   <span id="connected">{{ controller.getTeamRadioText() }}</span>               </div>               <div class="{{ controller.$localStorage.activeSession.state | ChangeClassFilter: \'offline-option\'}}">                   <input id="standalone-radio-button" type="radio" aria-labelledby="standalone" name="connection" value="offline" ng-disabled="controller.$localStorage.activeSession.state === 1" ng-change="controller.changeConnectionOption()" ng-model="controller.connectionOption">                   <span id="standalone">Standalone</span>               </div>           </div>        </div>        <div class="tfs-content" ng-if="controller.connectionOption === \'connected\'">           <div class="connected-mode-description" ng-if="!controller.isloggedIn">               {{ controller.getConnectedModeDescription() }}<a ng-click="controller.utilityService.openLink(\'https://aka.ms/xtmodes \')" ng-keydown="controller.utilityService.openLinkOnEnterPress($event, \'http://aka.ms/xtmodes \')" target="_blank" tabindex="0">Learn more</a>                <br>           </div>        <div class="connect-tfs-control">            <div class="tfs-header-section">                <div class="tfs-header">Server URL</div>            <button class="disconnect-button" ng-if="controller.connectionStatusPassed && controller.$localStorage.activeSession.state !== 1" ng-click="controller.disconnect()" tabindex="{{ controller.enableTabIndex(controller.isloggedIn) }}">                <div class="{{ controller.$localStorage.activeSession.state | ChangeClassFilter: \'disconnect\'}}" title="{{ controller.$localStorage.activeSession.state | TooltipFilter }}">                    Disconnect                </div>            </button>            <button class="disconnect-button" ng-if="(!controller.connectionStatusPassed && controller.$localStorage.initialBaseUrl  && $root.actionInProgress) || controller.$localStorage.activeSession.state === 1" ng-click="controller.repair()" tabindex="{{ controller.enableTabIndex(controller.isloggedIn) }}">                <div  class="disconnect" title="Repair">                    Repair                </div>            </button>                <!--                <div class="icon-info"></div>                -->            </div>            <div class="tfs-url" ng-style="{\'background-color\': !controller.isInputEditable ? \'#DDDDDD\' : \'white\' }">                  <span ng-if="!controller.isInputEditable"> <input ng-style="{\'background-color\': !controller.isInputEditable ? \'#DDDDDD\' : \'white\' }" type="text" ng-model="controller.baseUrl;" tabindex="{{ controller.enableTabIndex(!controller.isloggedIn) }}" aria-labelledby="team-services-url" ng-readonly="!controller.isInputEditable" ng-keydown="controller.keyDownOnNext($event)" enable="{{ controller.isloggedIn === false }}" placeholder=" Enter Team Services / Team Foundation Server url" /></span>                  <span id="team-services-url" class="hidden-aria-label">Team Foundation Server or Team Services URL</span>                  <span ng-if="controller.isInputEditable"> <input-dropdown tfsurl="controller.baseUrl" ng-style="{\'background-color\': !controller.isInputEditable ? \'#DDDDDD\' : \'white\' }" type="text"  tabindex="-1" ng-readonly="!controller.isInputEditable" ng-keydown="controller.keyDownOnNext($event)" enable="{{ controller.isloggedIn === false }}"></input-dropdown></span>                <div class="connection-status">                    <div class="passed"                         ng-class="controller.statusPassedItem.css"                         ng-bind-html="controller.statusPassedItem.unicode"                         ng-if="controller.connectionStatusPassed && controller.showConnectionStatusIcon"></div>                </div>            </div>            <div class="tfs-url-preview" ng-if="!controller.connectionStatusPassed && controller.baseUrl && controller.baseUrl.length != 0 " ng-if="!controller.isTeamSelected" >                <span>Preview:&nbsp;</span>                <input type="text" value="{{ controller.$localStorage.initialBaseUrl = controller.baseUrl; controller.baseUrl | tfsurlFilter }}" title="{{ controller.baseUrl | tfsurlFilter }}" readonly tabindex="-1" />            </div>            <div class="tfs-url-preview" ng-if="controller.isInputEditable && (!controller.baseUrl || controller.baseUrl.length === 0) ">            </div>            <div class="vso-sign-up" ng-if="!controller.isloggedIn">              Don\'t have a Visual Studio Team Services account? <a ng-href="" ng-click="controller.loadSignUpPage()" ng-keydown="controller.keyDownOnNewUser($event)" tabindex="0">Sign up </a>for free.            </div>        </div>        <div class="button-container" ng-if="!controller.isloggedIn" tabindex="-1">            <button ng-click="controller.validateTfsUrl()" ng-disabled="$root.actionInProgress || !controller.$localStorage.initialBaseUrl" tabindex="{{ controller.enableTabIndex(!controller.isloggedIn) }}">                <div class="submit-text">                    Next                </div>            </button>        </div>        <div ng-if="controller.$storage.changeTeamDetails !== false" >            <div ng-if="controller.isloggedIn" class="team-path">                <div class="project-team-header">                    <div class="select-team-text" tabindex="-1" ng-if="!controller.isTeamSelected"><label for="team-search-input" id="search-label-id">Select your team<label></div>                </div>                   <div class="refresh-button" title="Refresh" ng-click="controller.refresh()" role="button" tabindex="{{ controller.enableTabIndex(controller.isloggedIn) }}" ng-keydown="controller.keyDownOnRefresh($event)">Refresh</div>                <div class="select-team">                   <div class="filter">                        <div class="select-collection-header" title="{{controller.collectionFilter.name}}" ng-if="controller.data.length > 1" >                            <select class="select-collection" tabindex="{{ controller.enableTabIndex(controller.data.length > 1 && !controller.isloggedIn) }}" ng-disabled="controller.$storage.activeSession.state === 1" ng-options="collection.name for collection in controller.data" ng-model="controller.collectionFilter"> </select>                       </div>                       <div class="team-filter" >                            <input class="input-box" id="team-search-input" type="text" results="0"  ng-disabled="controller.$storage.activeSession.state === 1" ng-change="controller.teamFilterChanged()" ng-model="controller.teamFilter" aria-describedby="team-search-input" ng-model-options="{debounce: 300}" enable="controller.isloggedIn"  placeholder= " Search..." />                           <div class="team-search-button-container" title="Search">&#57492;</div>                       </div>                   </div>                 </div>             </div>            <!-- as a Dom element -->            <div class="team-selector" id="team-selector-container" ng-if="controller.isloggedIn">                <div ng-if="!controller.isRefreshing"                     data-angular-treeview="true"                     data-tree-id="tree"                     data-tree-model="controller.data"                     data-node-id="id"                     data-node-label="name"                     data-node-children="children"                     data-container-id="team-selector-container">                </div>                <div ng-if="controller.isRefreshing" class="refresh-icon">                </div>            </div>        </div>            <button class="change-button" ng-click="controller.changeConnectionSettings()" ng-disabled="controller.isChangeButtonDisabled()" ng-if="controller.$storage.changeTeamDetails === false">                   <div class="{{ controller.$localStorage.activeSession.state | ChangeClassFilter: \'change\' }}" > Change </div>            </button>            <div class="selected-team-title" ng-if="controller.isloggedIn && controller.$storage.changeTeamDetails === false">Selected Team: </div>            <div class="selected-team-text" ng-if="controller.$storage.changeTeamDetails === false && controller.isloggedIn" title="{{ controller.teamPath }} ">{{ controller.teamPath }} </div>            <div class="selected-team-text-without-title" ng-if="controller.$storage.changeTeamDetails !== false && controller.isloggedIn" title="{{ controller.teamPath }} ">{{ controller.teamPath }} </div>            <div class="button-container" ng-if="controller.isloggedIn && controller.$storage.changeTeamDetails !== false" tabindex=-1>                 <button ng-click="controller.save()" ng-disabled="controller.isSaveDisable() || controller.$storage.activeSession.state === 1 || $root.actionInProgress" tabindex="{{ controller.enableTabIndex(!controller.isSaveDisable()) }}">                    <div class="submit-text">                         Save                    </div>                 </button>             </div>        </div>        <div class="offline-content" ng-if="controller.connectionOption === \'offline\'">        Make notes, take screenshots, file bugs, and share your findings as a report. Open to everyone. No connection to Visual Studio Team Services or Team Foundation Server required. <a ng-click="controller.utilityService.openLink(\'https://aka.ms/xtmodes \')" target="_blank" ng-keydown="controller.utilityService.openLinkOnEnterPress($event, \'http://aka.ms/xtmodes \')" tabindex="0">Learn more</a><br><br>Don\'t have a Visual Studio Team Services account? <a ng-href="" ng-click="controller.loadSignUpPage()" ng-keydown="controller.keyDownOnNewUser($event)" tabindex="0">Sign up</a> for free.        <br>        <br>        <i> {{ controller.getOfflineFooterMessage() }} </i>        </div>        <xt-minimizepage></xt-minimizepage>    </div></div>',t.signInTemplateNewBranding='<div class="sign-in-page" ng-controller="SignInFormController as controller" ng-escape="controller.utilityService.minimizeForm()">    <error-control></error-control>    <div class="form-container">        <div role="group" aria-labelledby="connection-settings">           <div id="connection-settings" class="sign-in-page-title">               <legend>Connection settings</legend>           </div>           <div class="sign-in-option">               <div class="{{ controller.$localStorage.activeSession.state | ChangeClassFilter: \'tfs-option\'}}">                   <input id="connected-radio-button" type="radio" aria-labelledby="connected" name="connection" value="connected" ng-disabled="controller.$localStorage.activeSession.state === 1" ng-change="controller.changeConnectionOption()" ng-model="controller.connectionOption">                   <span id="connected">{{ controller.getTeamRadioText() }}</span>               </div>               <div class="{{ controller.$localStorage.activeSession.state | ChangeClassFilter: \'offline-option\'}}">                   <input id="standalone-radio-button" type="radio" aria-labelledby="standalone" name="connection" value="offline" ng-disabled="controller.$localStorage.activeSession.state === 1" ng-change="controller.changeConnectionOption()" ng-model="controller.connectionOption">                   <span id="standalone">Standalone</span>               </div>           </div>        </div>        <div class="tfs-content" ng-if="controller.connectionOption === \'connected\'">           <div class="connected-mode-description" ng-if="!controller.isloggedIn">               {{ controller.getConnectedModeDescription() }}<a ng-click="controller.utilityService.openLink(\'https://aka.ms/xtmodes \')" ng-keydown="controller.utilityService.openLinkOnEnterPress($event, \'http://aka.ms/xtmodes \')" target="_blank" tabindex="0">Learn more</a>                <br>           </div>        <div class="connect-tfs-control">            <div class="tfs-header-section">                <div class="tfs-header">Server URL</div>            <button class="disconnect-button" ng-if="controller.connectionStatusPassed && controller.$localStorage.activeSession.state !== 1" ng-click="controller.disconnect()" tabindex="{{ controller.enableTabIndex(controller.isloggedIn) }}">                <div class="{{ controller.$localStorage.activeSession.state | ChangeClassFilter: \'disconnect\'}}" title="{{ controller.$localStorage.activeSession.state | TooltipFilter }}">                    Disconnect                </div>            </button>            <button class="disconnect-button" ng-if="(!controller.connectionStatusPassed && controller.$localStorage.initialBaseUrl  && $root.actionInProgress) || controller.$localStorage.activeSession.state === 1" ng-click="controller.repair()" tabindex="{{ controller.enableTabIndex(controller.isloggedIn) }}">                <div  class="disconnect" title="Repair">                    Repair                </div>            </button>                <!--                <div class="icon-info"></div>                -->            </div>            <div class="tfs-url" ng-style="{\'background-color\': !controller.isInputEditable ? \'#DDDDDD\' : \'white\' }">                  <span ng-if="!controller.isInputEditable"> <input ng-style="{\'background-color\': !controller.isInputEditable ? \'#DDDDDD\' : \'white\' }" type="text" ng-model="controller.baseUrl;" tabindex="{{ controller.enableTabIndex(!controller.isloggedIn) }}" aria-labelledby="team-services-url" ng-readonly="!controller.isInputEditable" ng-keydown="controller.keyDownOnNext($event)" enable="{{ controller.isloggedIn === false }}" placeholder=" Enter Azure DevOps Services / Team Foundation Server url" /></span>                  <span id="team-services-url" class="hidden-aria-label">Team Foundation Server or Azure DevOps Services URL</span>                  <span ng-if="controller.isInputEditable"> <input-dropdown tfsurl="controller.baseUrl" ng-style="{\'background-color\': !controller.isInputEditable ? \'#DDDDDD\' : \'white\' }" type="text"  tabindex="-1" ng-readonly="!controller.isInputEditable" ng-keydown="controller.keyDownOnNext($event)" enable="{{ controller.isloggedIn === false }}"></input-dropdown></span>                <div class="connection-status">                    <div class="passed"                         ng-class="controller.statusPassedItem.css"                         ng-bind-html="controller.statusPassedItem.unicode"                         ng-if="controller.connectionStatusPassed && controller.showConnectionStatusIcon"></div>                </div>            </div>            <div class="tfs-url-preview" ng-if="!controller.connectionStatusPassed && controller.baseUrl && controller.baseUrl.length != 0 " ng-if="!controller.isTeamSelected" >                <span>Preview:&nbsp;</span>                <input type="text" value="{{ controller.$localStorage.initialBaseUrl = controller.baseUrl; controller.baseUrl | tfsurlFilter }}" title="{{ controller.baseUrl | tfsurlFilter }}" readonly tabindex="-1" />            </div>            <div class="tfs-url-preview" ng-if="controller.isInputEditable && (!controller.baseUrl || controller.baseUrl.length === 0) ">            </div>            <div class="vso-sign-up" ng-if="!controller.isloggedIn">              Don\'t have a Azure DevOps organization? <a ng-href="" ng-click="controller.loadSignUpPage()" ng-keydown="controller.keyDownOnNewUser($event)" tabindex="0">Sign up </a>for free.            </div>        </div>        <div class="button-container" ng-if="!controller.isloggedIn" tabindex="-1">            <button ng-click="controller.validateTfsUrl()" ng-disabled="$root.actionInProgress || !controller.$localStorage.initialBaseUrl" tabindex="{{ controller.enableTabIndex(!controller.isloggedIn) }}">                <div class="submit-text">                    Next                </div>            </button>        </div>        <div ng-if="controller.$storage.changeTeamDetails !== false" >            <div ng-if="controller.isloggedIn" class="team-path">                <div class="project-team-header">                    <div class="select-team-text" tabindex="-1" ng-if="!controller.isTeamSelected"><label for="team-search-input" id="search-label-id">Select your team<label></div>                </div>                   <div class="refresh-button" title="Refresh" ng-click="controller.refresh()" role="button" tabindex="{{ controller.enableTabIndex(controller.isloggedIn) }}" ng-keydown="controller.keyDownOnRefresh($event)">Refresh</div>                <div class="select-team">                   <div class="filter">                        <div class="select-collection-header" title="{{controller.collectionFilter.name}}" ng-if="controller.data.length > 1" >                            <select class="select-collection" tabindex="{{ controller.enableTabIndex(controller.data.length > 1 && !controller.isloggedIn) }}" ng-disabled="controller.$storage.activeSession.state === 1" ng-options="collection.name for collection in controller.data" ng-model="controller.collectionFilter"> </select>                       </div>                       <div class="team-filter" >                            <input class="input-box" id="team-search-input" type="text" results="0"  ng-disabled="controller.$storage.activeSession.state === 1" ng-change="controller.teamFilterChanged()" ng-model="controller.teamFilter" aria-describedby="team-search-input" ng-model-options="{debounce: 300}" enable="controller.isloggedIn"  placeholder= " Search..." />                           <div class="team-search-button-container" title="Search">&#57492;</div>                       </div>                   </div>                 </div>             </div>            <!-- as a Dom element -->            <div class="team-selector" id="team-selector-container" ng-if="controller.isloggedIn">                <div ng-if="!controller.isRefreshing"                     data-angular-treeview="true"                     data-tree-id="tree"                     data-tree-model="controller.data"                     data-node-id="id"                     data-node-label="name"                     data-node-children="children"                     data-container-id="team-selector-container">                </div>                <div ng-if="controller.isRefreshing" class="refresh-icon">                </div>            </div>        </div>            <button class="change-button" ng-click="controller.changeConnectionSettings()" ng-disabled="controller.isChangeButtonDisabled()" ng-if="controller.$storage.changeTeamDetails === false">                   <div class="{{ controller.$localStorage.activeSession.state | ChangeClassFilter: \'change\' }}" > Change </div>            </button>            <div class="selected-team-title" ng-if="controller.isloggedIn && controller.$storage.changeTeamDetails === false">Selected Team: </div>            <div class="selected-team-text" ng-if="controller.$storage.changeTeamDetails === false && controller.isloggedIn" title="{{ controller.teamPath }} ">{{ controller.teamPath }} </div>            <div class="selected-team-text-without-title" ng-if="controller.$storage.changeTeamDetails !== false && controller.isloggedIn" title="{{ controller.teamPath }} ">{{ controller.teamPath }} </div>            <div class="button-container" ng-if="controller.isloggedIn && controller.$storage.changeTeamDetails !== false" tabindex=-1>                 <button ng-click="controller.save()" ng-disabled="controller.isSaveDisable() || controller.$storage.activeSession.state === 1 || $root.actionInProgress" tabindex="{{ controller.enableTabIndex(!controller.isSaveDisable()) }}">                    <div class="submit-text">                         Save                    </div>                 </button>             </div>        </div>        <div class="offline-content" ng-if="controller.connectionOption === \'offline\'">        Make notes, take screenshots, file bugs, and share your findings as a report. Open to everyone. No connection to Azure DevOps Services or Team Foundation Server required. <a ng-click="controller.utilityService.openLink(\'https://aka.ms/xtmodes \')" target="_blank" ng-keydown="controller.utilityService.openLinkOnEnterPress($event, \'http://aka.ms/xtmodes \')" tabindex="0">Learn more</a><br><br>Don\'t have a Azure DevOps organization? <a ng-href="" ng-click="controller.loadSignUpPage()" ng-keydown="controller.keyDownOnNewUser($event)" tabindex="0">Sign up</a> for free.        <br>        <br>        <i> {{ controller.getOfflineFooterMessage() }} </i>        </div>        <xt-minimizepage></xt-minimizepage>    </div></div>';
}),define("../../Common/Utility",["require","exports","../Common/Constants","../Common/ExtensionStorage","../Common/Types","../Common/FeatureAvailabiliy","../Popup2/CommonControls/InputDropdown.Template","../Popup2/SignIn/SignIn.Template"],function(e,t,o,n,i,r,a,s){function l(e){var t=!1;if(e){var o=(new Date).getTime()-e.getTime();400>o&&(t=!0)}return t}function c(){var e,t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|chromium|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(o[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE "+(e[1]||"")):"Chrome"===o[1]&&(e=t.match(/\b(OPR|Edge)\/(\d+)/),null!=e)?e.slice(1).join(" ").replace("OPR","Opera"):(o=o[2]?[d(o[1]),o[2]]:[navigator.appName,navigator.appVersion,"-?"],o.join(" "))}function d(e){switch(e.toLowerCase()){case"chrome":return o.BrowserConstants.chromeBrowserName;case"firefox":return o.BrowserConstants.firefoxBrowserName;case"edge":return o.BrowserConstants.edgeBrowserName;default:return e}}function g(e,t){var o="tfsallin.net",n=e;return e.search(o)<=0&&!u(e)&&(n+=t+"/"),n}function u(e){var t=h(e);return t.match(/.visualstudio.com$/)||t.match(/^dev.azure.com$/)||t.match(/^codeapp.ms$/)||t.match(/^codedev.ms$/)?!0:!1}function h(e){var t=document.createElement("a");return t.href=e,t.hostname?t.hostname:""}function p(e,t){var o="";return e&&t&&(o=e,u(e)||(o=e.replace(t+"/",""))),o}function f(e,t,r){chrome.tabs.get(e,function(e){if(e){var a=n.LocalStorageService.retrieve(n.basicConnectionSettingsKey),s=n.LocalStorageService.retrieve(n.activeSettingsKey),l=a?a:s.serverbaseUrl,c=n.LocalStorageService.retrieve(n.loggedInKey),d=document.createElement("a");if(d.href=e.url,c&&l){var g=document.createElement("a");if(g.href=l,d.protocol==g.protocol&&d.host===g.host)return void t()}r(i.stringFormat(o.Messages.login,d.hostname))}else r(i.stringFormat(o.Messages.login,"server"))})}t.ignoreEvent=l,t.getBrowserNameAndVersion=c,t.getFullyQualifiedBrowerName=d,t.getCollectionUrl=g,t.isHostedUrl=u,t.getTfsUrl=p,t.ValidateTabHost=f;var m=function(){function e(){this.items={},this.length=0}return e.prototype.add=function(e,t){this.items[e]=t,this.length++},e.prototype.has=function(e){return e in this.items},e.prototype.get=function(e){return this.items[e]},e}();t.Map=m;var v=function(){function e(){}return e.getFooterBrandingPerfPage=function(){var e="";return e=r.FeatureAvailibilityService.isFeatureEnabled(r.FeatureFlag.NewBranding)?"Azure DevOps </a>. ":"Visual Studio Team Services</a> / Team Foundation Server using the Connected mode. "},e.getConnectedServerTypeForHosted=function(){var e="";return e=r.FeatureAvailibilityService.isFeatureEnabled(r.FeatureFlag.NewBranding)?"Azure DevOps organization":"VSTS account"},e.getInputDropDownTemplate=function(){var e="";return e=r.FeatureAvailibilityService.isFeatureEnabled(r.FeatureFlag.NewBranding)?a.inputDropdownControlTemplateNewBranding:a.inputDropdownControlTemplate},e.getSignInTemplate=function(){var e="";return e=r.FeatureAvailibilityService.isFeatureEnabled(r.FeatureFlag.NewBranding)?s.signInTemplateNewBranding:s.signInTemplate},e.getHostedBrandingName=function(e){return r.FeatureAvailibilityService.isFeatureEnabled(r.FeatureFlag.NewBranding)?e?"Azure DevOps":"Azure DevOps Services":"Visual Studio Team Services"},e.getHostedBrandingShortName=function(e){return r.FeatureAvailibilityService.isFeatureEnabled(r.FeatureFlag.NewBranding)?"Azure DevOps":"Team Services"},e}();t.BrandingChangesHelper=v}),define("../../Model/PerfDataInsightViewService",["require","exports","../Popup2/Common/ResourceUtility.Service","../Common/Utility"],function(e,t,o,n){var i=function(){function e(){}return e.getInsightView=function(t,o,n){var i=t.url,r=t.data,a=r.items.start,s=r.items.end,l=r.items.count;delete r.start,delete r.end,delete r.count,e.barHeight=o?o:10,e.barWidth=n?n:1500,e.RSvgWidth=e.barWidth+e.hShift;var c="<html><head><title>Performance Insights</title>";return c+='<script>function showB(t) {var bStart = document.getElementById("bStart" + t.id);var bEnd = document.getElementById("bEnd" + t.id);var bTxtStart = document.getElementById("bTxtStart" + t.id);var bTxtEnd = document.getElementById("bTxtEnd" + t.id);bStart.setAttribute("visibility", "visible");bEnd.setAttribute("visibility", "visible");bTxtStart.setAttribute("visibility", "visible");bTxtEnd.setAttribute("visibility", "visible");}function hideB(t) {var bStart = document.getElementById("bStart" + t.id);var bEnd = document.getElementById("bEnd" + t.id);var bTxtStart = document.getElementById("bTxtStart" + t.id);var bTxtEnd = document.getElementById("bTxtEnd" + t.id);bStart.setAttribute("visibility", "hidden");bEnd.setAttribute("visibility", "hidden");bTxtStart.setAttribute("visibility", "hidden");bTxtEnd.setAttribute("visibility", "hidden");}var gTags = document.getElementsByTagName("g");var startYPos = 15;function translateBoundaries(gTag, diff){var rects = gTag.getElementsByTagName("rect"), bStart, bEnd, bTxtStart, bTxtEnd, id;for(var i=0;i<rects.length;i++){if(rects[i].getAttribute("id")){id = rects[i].getAttribute("id");bStart = document.getElementById("bStart"+id);bEnd = document.getElementById("bEnd"+id);bTxtStart = document.getElementById("bTxtStart"+id);bTxtEnd = document.getElementById("bTxtEnd"+id);bStart.setAttribute("y1", Number(bStart.getAttribute("original_y1"))+diff);bStart.setAttribute("y2", Number(bStart.getAttribute("original_y2"))+diff);bEnd.setAttribute("y1", Number(bEnd.getAttribute("original_y1"))+diff);bEnd.setAttribute("y2", Number(bEnd.getAttribute("original_y2"))+diff);bTxtStart.setAttribute("y", Number(bTxtStart.getAttribute("original_y"))+diff);bTxtEnd.setAttribute("y", Number(bTxtEnd.getAttribute("original_y"))+diff);}}}function translateTicks(y){var ticks = document.getElementsByClassName("resourceTick");for(var i=0;i<ticks.length;i++){ticks[i].setAttribute("y2", y+15);}}function showAll(){var currY = startYPos, original_y;for(var i=0;i<gTags.length;i++){if(gTags[i].getAttribute("type") === null){continue;}gTags[i].setAttribute("visibility", "visible");gTags[i].setAttribute("transform", "translate(0, "+currY+")");original_y = gTags[i].getAttribute("original_y");translateBoundaries(gTags[i], 0);currY += 15;}translateTicks(currY);document.getElementById("resourceSvg").setAttribute("height", currY+70);}function filter(filter){if(filter === "All"){showAll();return;};var currY = startYPos, original_y;for(var i=0;i<gTags.length;i++){if(gTags[i].getAttribute("type") === null){continue;console.log("NULL");}if(gTags[i].getAttribute("type") === filter){gTags[i].setAttribute("visibility", "visible");gTags[i].setAttribute("transform", "translate(0, "+currY+")");original_y = gTags[i].getAttribute("original_y");translateBoundaries(gTags[i], currY-original_y);currY += 15;} else{gTags[i].setAttribute("visibility", "hidden");}}translateTicks(currY);document.getElementById("resourceSvg").setAttribute("height", currY+70);}function setSvgHeight() {y = 15;for(var i=0;i<gTags.length;i++){if(gTags[i].getAttribute("type") === null){continue;}y += 15;}document.getElementById("resourceSvg").setAttribute("height", y+70);}window.onload = setSvgHeight;</script>',c+='</head><body style="min-width:'+e.RSvgWidth+'">',c+=e.addCSS(),c+=e.addReportTitle(i),c+='<div class="perfInsight" width= "100%" height= "100%" >\n',s=s>r.items.pageTimings.loadEventEnd-r.items.pageTimings.navigationStart?s:r.items.pageTimings.loadEventEnd-r.items.pageTimings.navigationStart,r.items.pageTimings.loadEventEnd<=0?c+"</div>\n</body></html>":(c+=e.generateNavigationWaterfall(r.items.pageTimings,r.items.pageTimings.navigationStart,r.items.pageTimings.loadEventEnd,12),c+=e.generateResourceWaterfall(r,a,s,l),c+="</div>\n",c+=e.addFooter(),c+"</body></html > ")},e.addCSS=function(){var e='<style>.perfInsight {font-family: "Segoe UI", Arial, Helvetica, sans-serif;font-size: 100%;text-align: left;color: #333;line-height: 120%;padding-bottom: 2px;padding-top: 1px;padding-left: 1px;position: relative;margin-bottom: 0;overflow: auto;}.line {position: relative;margin-bottom: 0;border-bottom: 2px solid #ccc;height: 2px;overflow: hidden;}#main p.inlineBlock {margin-bottom: 0;display: inline-block;}.ReportGenerationText {font-family: "Segoe UI", Arial, Helvetica, sans-serif;font-size: 140%;text-align: left;color: #999;line-height: 120%;padding-bottom: 2px;padding-top: 1px;position: relative;margin-bottom: 0;float: left;padding-top: 5px;margin-top: 20px;margin-bottom: 20px;width: 100%;}.PageLoaded {font-family: "Segoe UI", Arial, Helvetica, sans-serif;font-size: 200%;text-align: left;color: #999;line-height: 120%;padding-bottom: 2px;position: relative;margin-bottom: 10px;width: 100%;float: left;margin-top: 10px;}.ReportHeader {position: relative;width: 95%;height: 300px;margin-bottom: 10px;margin-bottom: 20px;padding-left: 1px;}.ReportTitle {font-family: "Segoe UI", Arial, Helvetica, sans-serif;font-size: 400%;text-align: left;color: #0079cc;line-height: 120%;padding-bottom: 2px;padding-top: 1px;position: relative;margin-bottom: 0;width: 100%;float: left;display: inline-block;}.ExploratoryTestingLabel {font-family: "Segoe UI", Arial, Helvetica, sans-serif;padding-left: 1px;font-size: 200%;text-align: left;color: #999;line-height: 120%;padding-bottom: 2px;position: relative;margin-top: 10px;width: 100%;float: left;display: inline-block;}.TocTitleDiv {position: relative;top: 0px;height: 60px;width: 100%;background: #eee;}.TocHeader {font-family: "Segoe UI Semibold", Arial, Helvetica, sans-serif;font-size: 200%;font-weight: bold;text-align: left;color: #0079cc;line-height: 120%;padding: 15px;position: relative;}.ReportEndText {font-family: "Segoe UI Semibold", Arial, Helvetica, sans-serif;font-size: 200%;font-weight: bold;text-align: left;color: #0079cc;position: relative;margin-bottom: 0;padding: 15px;}.GreyedTileFooterDiv {position: relative;margin-bottom: 0;margin-top: 20px;background-color: #eee;width: 100%;padding-top: 0px;height: 60px;}caption, h2{text-align: left}.appCache:hover, .blocked:hover, .connect:hover, .crossDomainRed:hover, .dns:hover, .dnsN:hover, .domContentLoadEvent:hover, .domProcessing:hover, .networkServer:hover, .onLoadEvent:hover, .redirect:hover, .request:hover, .response:hover, .responseN:hover, .tcp:hover, .total:hover, .ttfb:hover, .unload:hover {    opacity: .5}html, body, caption, h1, h2, h3, html, li, p, a, section, table, tbody, td, th, thead, tr, ul {margin: 0;padding: 0;border: none;font: inherit;vertical-align: baseline}h3 {font-weight: 700}body, html {height: 100%}html {font-size: 100.01%}body {padding: 0 32px;font-family: helvetica, arial, sans-serif;font-size: 75% ;}h1 {margin: 1em 0;font-size: 2em}caption, h2 {margin: .7em 0;font-size: 1.4em}h3 {display: inline}table {border-collapse: collapse;border: 1px solid #111}th{padding:.5em 1emfont-weight: 700}.background{background-color:#fff;fill: #fff}.background:hover {background-color: #999;fill:#999;opacity: .5}.blocked {fill: #FFE0D9;background-color: #FFE0D9;color: #000}.connect,.dns,.redirect,.request,.response{color: #fff}.redirect {fill: #DEEAF6;background-color: #DEEAF6}.dns {fill: #FEFCBA;background-color: #FEFCBA}.connect {fill: #CFC;background-color: #CFC}.request {fill: #D1A3FF;background-color: #D1A3FF}.response {fill: #ECD9FF;background-color: #ECD9FF}.unload {fill: #FB9FC6;background-color: #FB9FC6}.tick {stroke: #ccc}.resource-detail {position: absolute;visibility: hidden}.crossDomainRed {fill: #f3c;background-color: #f3c;color: #000}.total{fill:#3BCCFF;background-color: #3BCCFF;color:#000}.networkServer {fill: #C8FFFF;background-color: #C8FFFF;color: #fff}.tcp {fill: #FEFCBA;background-color: #FEFCBA;color: #fff}.appCache {fill: #F7CAAC;background-color: #F7CAAC;color: #fff}.ttfb {fill: #CFC;background-color: #CFC;color: #fff}.dnsN {fill: #FCF;background-color: #FCF;color: #fff}.domProcessing {fill: #FCDF74;background-color: #FCDF74;color: #fff}.domContentLoadEvent {fill: #FCCC74;background-color: #FCCC74;color: #fff}.onLoadEvent {fill: #A8D08D;background-color: #A8D08D;color: #fff}.responseN {fill: #9CF;background-color:#9CF;color: #fff}</style>';return e},e.generateResourceWaterfall=function(t,o,n,i){e.RSvgHeight=(i+1)*(e.barHeight+e.margin)+e.vShift,e.RBoundaries="",e.setScale(o?o:0,n,!1);for(var r in e.typesDict)e.typesDict[r].done=!1,e.typesDict[r].count=0;var a='<div>\n<div class="TocTitleDiv">\n<div class="TocHeader">Resource Chart</div>\n</div>\n<div class="line"></div><div style="float:right;">\n'+e.addRTable()+"</div>\n</div><br>\n";a+=e.addSelectMenu(t)+"<br><br>",a+='<div style="margin-bottom:10px" class="resourceTimingChart">\n<svg id="resourceSvg" width="100%" height="'+e.RSvgHeight+'px">\n<g transform="translate(950, 19)"><text style="font-weight: bold;">Time (ms) </text></g><g transform="translate(25, 19)"><text style="font-weight: bold;">Resources </text></g><g transform="translate(165, 19)"><text style="font-weight: bold;">Total Time (ms)</text></g><g transform="translate(250, 60)">',a+=e.addNavigationChart(t.items.pageTimings,0,e.barWidth,e.barHeight,"Navigations");var s=1;for(var l in t.items)if("pageTimings"!==l&&"timestamp"!==l&&t.items[l]&&t.items[l].intervals){var c=e.generateChart(t.items[l],s++,e.barWidth,e.barHeight,l);a+=c}return a+=e.getTicks(!1),a+='</g>\n</svg><hr style="width='+(e.barWidth+300)+'">\n</div>'},e.generateNavigationWaterfall=function(t,o,n,i){var r={total:["Total","0"],networkServer:["Network/Server","navigationStart"],crossDomainRedirect:["Cross-Domain-Redirect","navigationStart"],tcp:["tcp","connectStart"],appCache:["App-Cache","domainLookupStart"],dnsN:["Dns","domainLookupStart"],ttfb:["Time to first Byte","requestStart"],responseN:["Response","responseStart"],unload:["Unload","unloadEventStart"],domProcessing:["DomProcessing","domProcessingStart"],domContentLoadedEvent:["DomContentLoaded","domContentLoadedEventStart"],onLoadEvent:["Load Event","onLoadEventStart"]};e.NSvgWidth=e.barWidth+e.hShift,e.NSvgHeight=i*(e.barHeight+e.margin)+e.vShift,e.NBoundaries="",e.setScale(o?o:0,n,!0);var a='<div>\n\n<div class="TocTitleDiv">\n<div class="TocHeader">Navigation Chart</div>\n</div>\n<div class="line"></div></div>\n<div style="margin-bottom:10px;margin-top:20px" class="NavigationTimingChart">\n<svg width="100%" height="'+e.NSvgHeight+'px"><g transform="translate(950, 19)"><text style="font-weight: bold;">Time (ms) </text></g><g transform="translate(25, 19)"><text style="font-weight: bold;">Navigations </text></g><g transform="translate(165, 19)"><text style="font-weight: bold;">Total Time (ms)</text></g><g transform="translate(250, 60)">',s=0;for(var l in r)"0"===r[l][1]&&(a+=e.generateNavigationChart(t,s++,e.barWidth,e.barHeight,l,r[l])),t[l]>=0&&t[r[l][1]]>=0&&(a+=e.generateNavigationChart(t,s++,e.barWidth,e.barHeight,l,r[l]));return a+=e.getTicks(!0),a+='</g></svg><hr style="width='+(e.barWidth+300)+'">\n</div>\n<br>'},e.generateNavigationChart=function(t,o,n,i,r,a){var s,l=o*(i+5);s='<g transform="translate(0, '+l+')" style="opacity: 1">',s+='<rect x="-250" y="0" width="100%" height="'+i+'px" class="background"></rect>',0===o&&(s+=e.generateNRect(o,t.navigationStart,t[r],r,n,i,l)),t[a[1]]>=0&&(s+=e.generateNRect(o,t[a[1]],t[r],r,n,i,l)),s+='<text x="-250" y="10" class="resource-label">'+a[0]+"</text>";for(var c=new Array,d=0;d<e.totalTimeInLength;d++)c.push("&nbsp;");for(var g=t[r].toFixed(2),d=g.length-1,u=e.totalTimeInLength-1;d>=0;d--,u-=2)c[u]=g[d],c[u-1]="";return s+='<text x="-100" y="10" class="resource-label">'+c.join("")+" </text>",s+"</g>"},e.generateChart=function(t,o,n,i,r){var a,s=o*(i+5);if(a='<g visibility="visible" original_y="'+s+'" type="'+t.type+'" transform="translate(0, '+s+')" style="opacity: 1">',a+='<rect x="-250" y="0" width="100%" height="'+i+'px" class="background"><title>',t.intervals.requestStart>0)for(var l in t.intervals)a+=l+"- "+t.intervals[l]+" ; ";else a+="Total duration- "+(t.end-t.start).toString();a+="</title></rect>",t.intervals.requestStart>0?(a+=e.generateRect(o,t.start,t.intervals.requestStartDelay,"blocked",n,i,s),a+=e.generateRect(o,t.intervals.redirectStart,t.intervals.redirect,"redirect",n,i,s),a+=e.generateRect(o,t.intervals.dnsLookupStart,t.intervals.dnsLookupTime,"dns",n,i,s),a+=e.generateRect(o,t.intervals.connectStart,t.intervals.connectTime,"connect",n,i,s),a+=e.generateRect(o,t.intervals.requestStart,t.intervals.request,"request",n,i,s),a+=e.generateRect(o,t.intervals.reponseStart,t.intervals.response,"response",n,i,s)):a+=e.generateRect(o,t.start,t.end-t.start,"response",n,i,s);var c=t.name.length>20?t.name.substr(0,10)+"....."+t.name.substr(-5,t.name.length):t.name;a+='<text x="-250" y="10" class="resource-label">'+c+"<title>"+r+"</title></text>";for(var d=new Array,g=0;g<e.totalTimeInLength;g++)d.push("&nbsp;");for(var u=t.totalDuration.toFixed(2),g=u.length-1,h=e.totalTimeInLength-1;g>=0;g--,h-=2)d[h]=u[g],d[h-1]="";return a+='<text x="-100" y="10" class="resource-label">'+d.join("")+" </text>",a+"</g>"},e.addNavigationChart=function(t,o,n,i,r){var a,s={networkServer:["NW/Server","navigationStart"],crossDomainRedirect:["Cross-Domain-Redirect","navigationStart"],tcp:["TCP","connectStart"],appCache:["AppCache","domainLookupStart"],dnsN:["DNS","domainLookupStart"],ttfb:["Time to first Byte","requestStart"],responseN:["Response","responseStart"],unload:["Unload","unloadEventStart"],domProcessing:["DomProcessing","domProcessingStart"],domContentLoadedEvent:["DomContentLoaded","domContentLoadedEventStart"],onLoadEvent:["Load Event","onLoadEventStart"]},l=o*(i+e.margin);a='<g transform="translate(0, '+l+')" style="opacity: 1">',a+='<rect x="-250" y="0" width="100%" height="'+i+'px" class="background"><title>Total Time '+t.total+"</title></rect>";for(var c in s)"0"===s[c][1]&&(a+=e.generateRect(o,0,t[c],c,n,i,l)),t[c]>=0&&t[s[c][1]]>=0&&(a+=e.generateRect(o,t[s[c][1]]-t.navigationStart,t[c],c,n,i,l));a+='<text x="-250" y="10" class="resource-label">'+r+"<title>Page Navigation Timings</title></text>";for(var d=new Array,g=0;g<e.totalTimeInLength;g++)d.push("&nbsp;");for(var u=t.total.toFixed(2),g=u.length-1,h=e.totalTimeInLength-1;g>=0;g--,h-=2)d[h]=u[g],d[h-1]="";return a+='<text x="-100" y="10" class="resource-label">'+d.join("")+" </text>",a+"</g>"},e.generateRect=function(t,o,n,i,r,a,s){var l="";if(o>=0){var c=o*e.RScale,d=c+n*e.RScale,g=o+n,u=i;i="responseN"===i||"dnsN"===i?i.substr(0,i.length-1):i,l='<rect onmouseover="showB(this)" onmouseout="hideB(this)" id="'+u+t+'" x="'+c+'" y="0" width="'+n*e.RScale+'" height="'+a+'" class="resourceRect '+i+'"><title>'+i+"- "+n+"</title></rect>",e.RBoundaries+='<line class="boundaryStart" stroke="blue" visibility="hidden" id="bStart'+u+t+'" x1="'+c+'" x2="'+c+'" y1="'+(s+10)+'" y2="'+(s-8)+'" original_y1="'+(s+10)+'" original_y2="'+(s-8)+'"></line>',e.RBoundaries+='<text fill="blue" visibility="hidden" id="bTxtStart'+u+t+'" x="'+c+'" y="'+(s-10)+'" dy="-3" text-anchor="middle" original_y="'+(s-10)+'">'+o.toFixed(0)+"</text>",e.RBoundaries+='<line class="boundaryEnd" stroke="blue" visibility="hidden" id="bEnd'+u+t+'" x1="'+d+'" x2="'+d+'" y1="'+(s+10)+'" y2="'+(s+25)+'" original_y1="'+(s+10)+'" original_y2="'+(s+25)+'"></line>',e.RBoundaries+='<text fill="blue" visibility="hidden" id="bTxtEnd'+u+t+'" x="'+d+'" y="'+(s+30)+'" dy="+5" text-anchor="middle" original_y="'+(s+30)+'">'+g.toFixed(0)+"</text>",e.currX+=n*e.RScale}return l},e.generateNRect=function(t,o,n,i,r,a,s){var l="";if(o>0){var c=(o-e.NStartMs)*e.NScale,d=c+n*e.NScale,g=o-e.NStartMs+n,u=i;i="responseN"===i||"dnsN"===i?i.substr(0,i.length-1):i,l='<rect onmouseover="showB(this)" onmouseout="hideB(this)" id="'+u+t+'" x="'+c+'" y="0" width="'+n*e.NScale+'" height="'+a+'" class="navigationRect '+i+'"><title>'+i+"- "+n+"</title></rect>",e.NBoundaries+='<line class="boundaryStart" stroke="blue" visibility="hidden" id="bStart'+u+t+'" x1="'+c+'" x2="'+c+'" y1="'+(s+10)+'" y2="'+(s-8)+'"></line>',e.NBoundaries+='<text fill="blue" visibility="hidden" id="bTxtStart'+u+t+'" x="'+c+'" y="'+(s-10)+'" dy="-3" text-anchor="middle">'+(o-e.NStartMs).toFixed(0)+"</text>",e.NBoundaries+='<line class="boundaryEnd" stroke="blue" visibility="hidden" id="bEnd'+u+t+'" x1="'+d+'" x2="'+d+'" y1="'+(s+10)+'" y2="'+(s+25)+'"></line>',e.NBoundaries+='<text fill="blue" visibility="hidden" id="bTxtEnd'+u+t+'" x="'+d+'" y="'+(s+30)+'" dy="+5" text-anchor="middle">'+g.toFixed(0)+"</text>",e.currX+=n*e.RScale}return l},e.setScale=function(t,o,n){n?(e.NStartMs=t,e.NEndMs=o-o%10+100,e.NScale=e.barWidth/(e.NEndMs-e.NStartMs)):(e.RStartMs=0,e.REndMs=o-o%10+100,e.RScale=e.barWidth/(e.REndMs-e.RStartMs))},e.getTicks=function(t){var o,n,i,r,a;if(t){for(o='<g transform="translate(0, -6)">',r=Number((e.NEndMs-e.NStartMs)/10),a=0;a<=e.NEndMs-e.NStartMs;a+=r)n=a*e.NScale,i=e.NSvgHeight-30,o+='<line x1="'+n+'" x2="'+n+'" y1="0px" y2="'+i+'" class="tick"></line>',o+='<text x="'+n+'" y="0" dy="-3" text-anchor="middle">'+a.toFixed(0)+"</text>";return a-r<e.NEndMs-e.NStartMs&&(n=a*e.NScale,i=e.NSvgHeight-30,o+='<line x1="'+n+'" x2="'+n+'" y1="0px" y2="'+i+'" class="tick"></line>',o+='<text x="'+n+'" y="0" dy="-3" text-anchor="middle">'+a.toFixed(0)+"</text>"),o+e.NBoundaries+"</g>"}for(o='<g transform="translate(0, -6)">',r=Number((e.REndMs-e.RStartMs)/10),a=e.RStartMs;a<=e.REndMs;a+=r)n=(a-e.RStartMs)*e.RScale,i=e.RSvgHeight+30,o+='<line x1="'+n+'" x2="'+n+'" y1="0px" y2="'+i+'" class="tick resourceTick"></line>',o+='<text x="'+n+'" y="0" dy="-3" text-anchor="middle">'+a.toFixed(0)+"</text>";return a-r<e.REndMs&&(n=a*e.NScale,i=e.NSvgHeight-30,o+='<line x1="'+n+'" x2="'+n+'" y1="0px" y2="'+i+'" class="tick"></line>',o+='<text x="'+n+'" y="0" dy="-3" text-anchor="middle">'+a.toFixed(0)+"</text>"),o+e.RBoundaries+"</g>"},e.addRTable=function(){var e='<br><br>\n<table style="margin:0 auto;text-align:center;padding:0;margin-bottom:10px;">\n<thead><tr><td width="16.67%" style="padding:0;background-color:#FFE0D9">Blocked</td><td width="16.67%" style="padding:0;background-color:#DEEAF6">Redirect</td><td width="16.67%" style="padding:0;background-color:#FEFCBA">DNS</td><td width="16.67%" style="padding:0;background-color:#CCFFCC">Connect</td><td width="16.67%" style="padding:0;background-color:#D1A3FF">Request</td><td width="16.67%" style="padding:0;background-color:#ECD9FF">Response</td></tr></thead>\n</table>\n';return e},e.addNTable=function(){var e='<br><br><table style="margin:0 auto;text-align:center;padding:0;margin-bottom:10px;"><thead><tr><td width="9.09%" style="padding:0;background-color:#C8FFFF">NW/Server</td><td width="9.09%" style="padding:0;background-color:#ff33cc">Cross-Domain-Redirect</td><td width="9.09%" style="padding:0;background-color:#FEFCBA">TCP</td><td width="9.09%" style="padding:0;background-color:#F7CAAC">AppCache</td><td width="9.09%" style="padding:0;background-color:#FFCCFF">DNS</td><td width="9.09%" style="padding:0;background-color:#CCFFCC">Time to first Byte</td><td width="9.09%" style="padding:0;background-color:#99CCFF">Response</td><td width="9.09%" style="padding:0;background-color:#FB9FC6">Unload</td><td width="9.09%" style="padding:0;background-color:#FCDF74">DomProcessing</td><td width="9.09%" style="padding:0;background-color:#FCCC74">DomContentLoad</td><td width="9.09%" style="padding:0;background-color:#A8D08D">Load Event</td></tr></thead></table>';return e},e.addSelectMenu=function(t){var o=0;for(var n in t.items)"pageTimings"!==n&&"timestamp"!==n&&t.items[n]&&t.items[n].intervals&&t.items[n].intervals.requestStart>=0&&t.items[n].type&&(e.typesDict[t.items[n].type.split(" ")[0]].done=!0,e.typesDict[t.items[n].type.split(" ")[0]].count++,o++);var i='<br><select style="margin-top:10px" onchange="filter(this.value)">';i+='<option value="All" title="'+o+'">All</option>';for(var r in e.typesDict)e.typesDict[r].done&&(i+='<option value="'+e.typesDict[r].name+'" title="'+e.typesDict[r].count+'">'+e.typesDict[r].name+"</option>");return i+"</select>"},e.addFooter=function(){var e=n.BrandingChangesHelper.getFooterBrandingPerfPage(),t='<div class="ReportGenerationText"><p class="inlineBlock">This page load report was generated using <a style="color:0079cc" href="http://aka.ms/xtmarketplace">'+o.ResourceUtilityService.GetProductNameWithExtensionMessage()+'</a> for <a style="color:0079cc" href="https://visualstudio.com">'+e+'<a style="color:0079cc" href="http://aka.ms/xtlearn">Learn more</a></p>';return t+='<div class="GreyedTileFooterDiv"><div class="ReportEndText"><p>End of report.</p></div></div><div class="line"></div>',t+"</div>"},e.addReportTitle=function(e){var t='<div class="ReportTitle">\n<p class="inlineBlock">Page Load Report</p></div>\n',n=e.length>123?e.substr(0,123)+"...":e,i='<div class="ExploratoryTestingLabel">\n<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAkCAYAAAAKNyObAAAIYUlEQVRYR+1YfXBU1RW/977dLKkhbULTFgTKRJSY/Yg2rSNFnEw7Tlu1DnaMlewmxMLASCC7RP/oOLYsjBVGxWQ3JANBJU12ozYw004/xtoPY6dTi5ha9iMIYUaQqh1pCQ0Bk82+d/s7b/dmN58kzMhfvpk7++59997zO+f8zj3nLmczPpLT55qSlkLDqu/D6wo0iWaOp9/VDmrMHEdn1OB8dzhSf8jP/ALNmFnW5K/ZG076WlHht/T0+JPVzmCtZPLgXDfH/JOhqBcKEVZOSs3pmRFcSuPtsqas5UbD0A9h8vWQMB8SNDQdNvyfKY2b1pyHdl1a+kX8DgNPMBTxPfWpWC5bzUq7PyfXkl9kGNoRjF9PVhGj2jdljqYN658kbZplPZPy6TTWBp3ltHdFNw/MyVQTJs9oOTVXaU6/p5wF72F8KVofXGZXczzO4Ca4j3gJjHx9OFb/4sby/da23k2jVwtwVuBSnGGsdlm7TZ9/8ST4twTd46FovX1jeZulrXcj8XIzfLvXBMfkxnDU+3xFxQ6NOHsNwHG5dXnQdiGX9WfAeUtV0LhdTZu55C0ZcL4D6ttn4D6zXBYH5hAQXNYuOzhvfEBMzTlsuqkz6m27ppwjYYvPF5xCOH5VHSVTBgRntUhbHdckWscyhT24xBAsCmCUJfopNWVSXKBOHSWc8z2dkfrHKit/oXV3P6h/qtGqhHicgVcg6MG0sDDAedRBW2VvvEUI8Ta+EVWGpSErwnHfUQKvwFX0MIPSIfXJquavOTZ1UXBFzilgbmfz9zgzfof9qLoYMpKaq+v4ljNk1XhlKScLIUs04wjekgIj94+ULKqbjeVSMiqx7/ji4ArgJPezHfzD8oXzLidGjkHgDWQZyfk2cKop47ZUBqksb8u3jQwfZYJ1WQbzd7effnh4bfmzX9QSOd/B2jthsmLOZS44O4L397Hkb7rUX3059uhZc/0EGswIbsydjuDPAOlx2gALes8uGLi9qKhUTqVtlbO1gBK+Gdl5g08A9gYs+/IMvLuAPTsZz3myM/LIx9kApwWnkv26sufsuqH1YnOr6SzOV8Fqf5+K7GOR62x2ggJhTHdOAPUR+gPQ8DpYbzHeTd6llOZndUOu64p7X1d7TwsuEwTB1wGpIkUj1hqKeeumAqaUqXYFHFLKP0Hcl9JyLyB6XwChDklpOSHYaCMU3ActL2HD+1EKopphi9JzR1DR3IeK5jWSMSU4JXx8BSw/tlqEYyhx3iwwzxWZgcGUe4mb8fKF822JEUSsXJ4W9gbT9Q2hvoZTykJuZ1OV1bD+uT1e928aqynZu8Cw6HthuofQpT0HLZpxa/s/fWcmgSML0KIztxYuGE0aMVigCN0kirR7QjHfHya4yexmlGlqlIz7FDDLxfzvUlDQcbOo9yM9dYykIlJRgLh5aeEAz7mk7ceX6rSHDsNDD0wCN+ZOV+B5uHE9aYNJF2CNvXCFZnBpbg4NDKgpOBP/Ql23/yHHniUWbjmOT7loA0mLcL38ztYPx6cwySvtO6zdcX+C9nA7mn7IOF8rmfXhvBxt6HJiGMZgN5JMwYzV48ApYFXOpjsF4z1pM5Mlp49qyTtCsfp1HkfgMcx6hoTCetvD0fqdE4Epq1WVBW/TpPwJ1LwXfLwP2eTXtM7jaqqBAX5O7wiQA1lCoVVlt2B9fZpNFNBJT5FGHDDdjGdiRUt9C8i9lq5/yB6/Qf9utIQw2E0dce/7mYtN6vblublxIbNorYC/xtyRsxdCEe8GpUTlyudybUPitBlMkvWPgctkgsCPMbgLSyknjoV6GmD2j3l/BbiVdLQAHA5p5kI7KYT2/aQhznVFHwEdiJPd4ty5Pr74vwV/hdD3AOobGP4CLkgrit/9j3kJituLPpfLkoXgUBjf78DQsAlOJfZ1juZinUsSQryhb9O5U12spc5E6UvRre8CHEXkDSD1W7DTaXDpl6FI/Ut0ayOOgV+PwoXPGhq7ietwHTdC4YivVeXmmrLAHYbO6iAxP+0B4nom2tKuuWcWVqNlKYDcKA9Ftv0Da+Pol4Jv8Q8WnL+FLjYqZ1bd3LJUWHQiex7aIBbuwgVod/Z9Vr1jn9cw5y60BHiWKmvcruADCMTuWQIjcKbbQcg1HVHvr7DpH9H/NtqQEHpJx7GGD7KqmTcwvhqgWmVSe0YVDJlqJMVJOlaS8wdPYO5SyhhI7H7Rv7wwT+SyGG5VlFLIIioICMR0jxkQOOF3our1u52BndjwiZRJ6WroO0DJrtoR+JHkwiMEa+g4Vv9OtqfUxsrCbkfzXSgMfp/GcNh0K7Teg5+GOVhtzHJ4OYK67naUVJRPSbgAulMFw9w58nmb8clIoqwztpWi3zysKTB6erbD6qo8klxVzMDxF0yjYIDO/F5e42xcaTBBZqfInCkIprIgWdkA724j3uHuehjh+wNzYvqYoFci/UBxgTG+tksfXfhu0soZ/CkQ7UhZnr+ZKPnKal7tDLwNCeWmkNm5Mxtk6riRzEw3OERXQOOjGKM/dASYtM86mL+NUhgtIgqdLCv8OjMs/dn/o2QBI6pocO3KzojvCIcpL2PALIeu8kkpJfkaZIrfepyNOGDFobQXiLvHwMGnE4bxane84bzbFegQhrGLiSSKTdu3kCVAJ7PqMRWF67aAwy1mVYIq4SCIXHuVwLKXjeLesIruDW5H4H7OGaUhugipB7Ucp0jEIwn0MjT6Q0g9SQDzKWDkam6Gb97gFvDza1RJcoFt5/hISTUAt4LiJ7Sh/CfJjW57sBSOfQqbUUq7gmd4j2D64x3RbW/OqhKeI76s6SmiK/J7HI0VyBao1fgqTCpGs6HR32J0h3gLhekr4ZiP8vKkO8T/AUdXecW4X2hcAAAAAElFTkSuQmCC" style="vertical-align: sub"> '+o.ResourceUtilityService.GetProductNameMessage()+'</img></p><p style="margin-top:50px"> \nPage loaded: <a target="_blank" href="'+e+'" style="color:#0079cc" title="'+e+'">'+n+"</a></p\n><br></div>\n";return t+i},e.hShift=300,e.vShift=75,e.margin=5,e.totalTimeInLength=20,e.typesDict={Image:{name:"Image",done:!1,count:0},JavaScript:{name:"JavaScript",done:!1,count:0},Php:{name:"Php",done:!1,count:0},Style:{name:"Style Sheet",done:!1,count:0},Flash:{name:"Flash",done:!1,count:0},Font:{name:"Font",done:!1,count:0},Video:{name:"Video",done:!1,count:0},Source:{name:"Source Map",done:!1,count:0},XHR:{name:"XHR",done:!1,count:0},Object:{name:"Object resource",done:!1,count:0},SVG:{name:"SVG",done:!1,count:0},Link:{name:"Link",done:!1,count:0},Html:{name:"Html",done:!1,count:0},Script:{name:"Script resource",done:!1,count:0},CSS:{name:"CSS resource",done:!1,count:0},Embed:{name:"Embed resource",done:!1,count:0},Doc:{name:"Doc",done:!1,count:0},Manifest:{name:"Manifest",done:!1,count:0},Other:{name:"Other Request",done:!1,count:0}},e}();t.PerfInsightView=i}),define("../../Model/ModelHelper",["require","exports","../Model/Model","../Common/SessionData","../Common/ExtensionStorage","../Messaging/ChromeMessaging","../Messaging/Messaging","../Model/BrowserActionService","../Model/PerfDataInsightViewService","../Common/Constants","../Common/ResourceHelper"],function(e,t,o,n,i,r,a,s,l,c,d){function g(e,t,o){o?o.$emit(e.toString(),t):r.MessagingFactory.getBroadcastingService().broadcast(e,t)}function u(e){var t=Q.defer(),o={windowId:e};return chrome.tabs.query(o,function(e){t.resolve(e[0].id)}),t.promise}function h(e,t,o){var n=new Image;n.onload=function(){var e=document.createElement("CANVAS"),n=e.getContext("2d");e.height=this.height,e.width=this.width,n.drawImage(this,0,0);var i=e.toDataURL(o);t(i)},n.src=e}var p=n.SystemInformation,f=n.Screenshot,m=n.Note,v=n.Video,y=n.PerfData,T=n.ActionLog,b=i.LocalStorageService,S=function(){function e(){}return e.getAttachment=function(e){var t;if(e instanceof f)t={url:e.id,name:e.name,length:e.size,state:o.AttachmentState.Created,getContent:this.getContentFunction(e.id,e.isXTSession?!0:!1),type:o.AttachmentType.Screenshot,source:e.source,timeStamp:new Date};else if(e instanceof p)t={url:e.id,name:e.id,length:e.size,state:o.AttachmentState.Created,getContent:this.getContentFunction(e.id),type:o.AttachmentType.SystemInformation,timeStamp:new Date};else if(e instanceof m)t={url:e.id,name:e.id,length:e.size,timeStamp:new Date,state:o.AttachmentState.Created,getContent:this.getContentFunction(e.id),type:o.AttachmentType.Note};else if(e instanceof v)t={url:e.id,name:e.id,length:e.size,timeStamp:new Date,state:o.AttachmentState.Created,getContent:this.getContentFunction(e.id,e.isXTSession?!0:!1),type:o.AttachmentType.Video};else if(e instanceof y){var n=JSON.parse(e.content),r=l.PerfInsightView.getInsightView(n),a=new Blob([r],{type:"application/json"});i.PersistentStorageFactory.getStorageService().writeBlob(e.id,a,function(){},function(){}),t={url:e.id,name:e.id,length:e.size,timeStamp:new Date,state:o.AttachmentState.Created,getContent:this.getPerfDataContentFunction(e.id,r),type:o.AttachmentType.PerfData}}else e instanceof T&&(t={url:e.id,name:e.id,length:e.size,timeStamp:new Date,state:o.AttachmentState.Created,getContent:this.getActionLogContentFunction(e.id,e.content,e.isXTSession?!0:!1),type:o.AttachmentType.ActionLog});return t},e.getContentFunction=function(e,t){return void 0===t&&(t=!0),function(o){i.PersistentStorageFactory.getStorageService().getBlob(e,function(e){o(e)},function(e){console.log(e)},t)}},e.getActionLogContentFunction=function(e,t,o){return void 0===o&&(o=!0),function(o){var n=new Blob([t],{type:"text/plain"}),i=new File([n],e);o(i)}},e.getPerfDataContentFunction=function(e,t){return function(e){var o=new Blob([t],{type:"application/json"}),n=o;e(n)}},e}();t.AttachmentConverter=S,t.sendMessage=g,t.getTabId=u,t.convertToDataUrl=h;var w=function(){function e(){}return e.getError=function(e){var t=i.LocalStorageService.retrieve(i.toolbarErrorMap);if(!t)return null;var o=t[e];return o&&0!==o.length?o.pop():null},e.saveError=function(t,o,n,r,l,c){if(void 0===n&&(n=0),void 0===r&&(r=!0),void 0===l&&(l=!0),t){var d=i.LocalStorageService.retrieve(i.toolbarErrorMap);d||(d=new Object);var u=d[o];
u||(u=[]);var h=this.getErrorMessage(t);if(h){h=h.trim(),0===h.indexOf("404")&&(h=e.GetNotSupportedTfsErrorMessage());var p=t.status;u.push({errorCode:p,errorMessage:h,errorLevel:n,sticky:r,showNotification:l}),d[o]=u,b.store(i.toolbarErrorMap,d),g(a.NotificationType.ActivityErrorChanged,{toolbarType:o,errorMessage:h,errorLevel:n,showNotification:l},c),0===n&&s.getService().setIcon(s.ExtensionIconType.Error)}}},e.clearLastError=function(e,t){var o=i.LocalStorageService.retrieve(i.toolbarErrorMap);if(o){var n=o[e];if(n&&0!==n.length){n.pop(),o[e]=n,b.remove(i.toolbarErrorMap),b.store(i.toolbarErrorMap,o);var r,l,c=null;if(n.length>0){var d=n.pop();c=d.errorMessage,r=d.errorLevel,l=d.showNotification}else s.getService().clearError();g(a.NotificationType.ActivityErrorChanged,{toolbarType:e,errorMessage:c,errorLevel:r,showNotification:l},t)}}},e.clearNonStickyErrors=function(e,t){var o=i.LocalStorageService.retrieve(i.toolbarErrorMap);if(o){var n=o[e];if(n&&0!==n.length){var r=[];for(var l in n){var c=n[l];c.sticky&&r.push(c)}o[e]=r,b.store(i.toolbarErrorMap,o);var d,u,h=null;if(r.length>0){var p=r.pop();h=p.errorMessage,d=p.errorLevel,u=p.showNotification}else s.getService().clearError();g(a.NotificationType.ActivityErrorChanged,{toolbarType:e,errorMessage:h,errorLevel:d,showNotification:u},t)}}},e.clearAllErrors=function(e,t){var o=i.LocalStorageService.retrieve(i.toolbarErrorMap);if(o){var n=o[e];n&&0!==n.length&&(o[e]=[],b.store(i.toolbarErrorMap,o),g(a.NotificationType.ActivityErrorChanged,{toolbarType:e},t),s.getService().clearError())}},e.getErrorMessage=function(e,t){void 0===t&&(t=!0);var o=null;return"string"==typeof e||e instanceof String?o=e:(e.statusText?o=e.statusText:e.message?o=e.message:e.errorMessage&&(o=e.errorMessage),t&&(o&&o.match("parsererror$")||e.status&&401===e.status)&&(o="Unable to connect to server. Click on repair in connection settings page. Details:"+o)),o},e.GetNotSupportedTfsErrorMessage=function(){var e=d.getTFSNotSupportedMessageForBasicUser(),t=i.LocalStorageService.retrieve(i.connectedModeKey);return t===c.ConnectionOptionConstants.stakeholderMode&&(e=d.getTFSNotSupportedMessageForStakeholder()),e},e}();t.ErrorHelper=w}),define("../../Tracing/Tracing",["require","exports","../Common/ExtensionStorage","../Messaging/ChromeMessaging","../Messaging/Messaging","../Model/ModelHelper"],function(e,t,o,n,i,r){var a=r.ErrorHelper;!function(e){e[e.Error=0]="Error",e[e.Perf=1]="Perf",e[e.Warning=2]="Warning",e[e.Info=3]="Info",e[e.Verbose=4]="Verbose"}(t.TraceLevel||(t.TraceLevel={}));var s=t.TraceLevel;!function(e){e[e.Background=0]="Background",e[e.Popup=1]="Popup",e[e.AnnotationTool=2]="AnnotationTool"}(t.Component||(t.Component={}));var l=t.Component,c=function(){function e(){}return e.initializeService=function(e){var t=this;this.component=e,this.setTracingLevel(),n.MessagingFactory.getSubscriptionService().subscribe(function(e){t.setTracingLevelFromString(e)},i.NotificationType.TracingLevelChanged),this.component===l.Background&&(o.PersistentStorageFactory.getStorageService().createDirectory(this.tracingDirectoryName,this.tracingDirectorySize,function(){},function(){}),n.MessagingFactory.getSubscriptionService().subscribe(function(e,o){t.flushTraceQueue()},i.NotificationType.SessionStop),n.MessagingFactory.getSubscriptionService().subscribe(function(e){t.traceInternal(e.traceLevel,e.formattedMessage,e.optionalParams)},i.NotificationType.Trace))},e.traceEnter=function(e,t,o,n){for(var i=[],r=4;r<arguments.length;r++)i[r-4]=arguments[r];this.tracingLevel>=s.Perf&&console.time(e),this.trace(t,o,s.Verbose,n,i)},e.traceLeave=function(e,t,o,n){for(var i=[],r=4;r<arguments.length;r++)i[r-4]=arguments[r];this.tracingLevel>=s.Perf&&console.timeEnd(e),this.trace(t,o,s.Verbose,n,i)},e.traceError=function(e,t,o){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];this.trace(e,t,s.Error,a.getErrorMessage(o),n)},e.traceWarning=function(e,t,o){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];this.trace(e,t,s.Warning,o,n)},e.traceInfo=function(e,t,o){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];this.trace(e,t,s.Info,o,n)},e.traceVerbose=function(e,t,o){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];this.trace(e,t,s.Verbose,o,n)},e.trace=function(e,t,o,r){for(var a=[],c=4;c<arguments.length;c++)a[c-4]=arguments[c];if(!(this.tracingLevel<o)){var d=new Date(Date.now()),g="("+d.toISOString()+")",u="["+l[this.component]+"-"+s[o]+" @"+g+"];XTModule:"+e+";XTModuleTracepoint:"+t+";"+r;this.component!==l.Background?n.MessagingFactory.getBroadcastingService().broadcast(i.NotificationType.Trace,{traceLevel:o,formattedMessage:u,optionalParams:a}):this.traceInternal(o,u,a)}},e.traceInternal=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];switch(e){case s.Verbose:console.log(t,o),this.persistTrace(10,t,o);break;case s.Info:console.info(t,o),this.persistTrace(5,t,o);break;case s.Warning:console.warn(t,o),this.persistTrace(0,t,o);break;case s.Error:console.error(t,o),this.persistTrace(0,t,o)}},e.setTracingLevel=function(){var e=this;o.LocalStorageService.retrieveAsync(this.tracingLevelKey,function(t){e.setTracingLevelFromString(t)})},e.setTracingLevelFromString=function(e){if(void 0!=e){var t=Number(e);this.tracingLevel=t}},e.persistTrace=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];var i=this.getFormattedTrace(t,o);this.traceQueue.push(i),this.traceQueue.length>e&&this.flushTraceQueue()},e.getFormattedTrace=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];for(var n in t)e="\n"+e.replace("{"+n+"}",arguments[n]);return e},e.flushTraceQueue=function(){if(this.traceQueue.length>0){var e=this.traceQueue;this.traceQueue=new Array;var t=new Blob([e],{type:"text/plain"});o.PersistentStorageFactory.getStorageService().writeBlobInDir(this.tracingDirectoryName,this.getTraceFileName(),t,function(){},function(){},!0)}},e.getDayOfWeek=function(){var e=new Date;return e.getDay()},e.getTraceFileName=function(){var e=this.getDayOfWeek(),t=o.LocalStorageService.retrieve(this.lastTraceDate),n=this.traceFileNamePrefix+e;return t!==e&&(o.LocalStorageService.store(this.lastTraceDate,e),o.PersistentStorageFactory.getStorageService().removeBlobInDir(this.tracingDirectoryName,n,function(){},function(){})),n},e.tracingLevelKey="TracingLevel",e.component=l.Background,e.tracingDirectoryName="Logs",e.tracingLevel=s.Error,e.traceFileNamePrefix="xt-console-traces-",e.traceQueue=new Array,e.tracingDirectorySize=104857600,e.lastTraceDate="LastTraceDate",e}();t.TracingService=c}),define("../ViewModel/AnnotationSettings",["require","exports","../../Messaging/ChromeMessaging","../../Messaging/Messaging","../../Tracing/Tracing"],function(e,t,o,n,i){function r(e){if(!e)throw"invalid tool name";var t=u.toolSettingsDictionary[g+e];return t}function a(e,t){u.toolSettingsDictionary[g+e]=t,c.traceVerbose(d,5,"Updated settings locally",g+e,t.color)}function s(){c.traceEnter("SetSettings",d,1,"Begin"),o.MessagingFactory.getBroadcastingService().broadcast(n.NotificationType.SaveAnnotationSettings,u),c.traceLeave("SetSettings",d,2,"End")}function l(e){c.traceEnter("LoadSettings",d,3,"Begin"),o.MessagingFactory.getSubscriptionService().subscribe(function(t){t&&(u=t),e&&e()},n.NotificationType.AnnotationSettingsFetchResponse),o.MessagingFactory.getBroadcastingService().broadcast(n.NotificationType.FetchAnnotationSettings,{}),c.traceLeave("LoadSettings",d,4,"End")}var c=i.TracingService,d="AnnotationSettings";t.getSettings=r,t.setSettings=a,t.saveSettings=s,t.loadSettings=l;var g="annotation-tool-settings-",u={toolSettingsDictionary:{}}}),define("../ViewModel/AnnotationToolCommon",["require","exports"],function(e,t){function o(){t.annotationToolbarToolTitleDictionary[i.Rectangle]="Draw rectangle",t.annotationToolbarToolTitleDictionary[i.Ellipse]="Draw ellipse",t.annotationToolbarToolTitleDictionary[i.Crop]="Crop area",t.annotationToolbarToolTitleDictionary[i.Arrow]="Draw arrow",t.annotationToolbarToolTitleDictionary[i.Blur]="Blur area",t.annotationToolbarToolTitleDictionary[i.Text]="Add text",t.annotationToolbarToolTitleDictionary[i.Delete]="Delete selected shape",t.annotationToolbarToolTitleDictionary[i.Save]="Save screenshot",t.annotationToolbarToolTitleDictionary[i.Cancel]="Exit without saving"}!function(e){e[e.NotStarted=0]="NotStarted",e[e.Started=1]="Started",e[e.InProgress=2]="InProgress",e[e.Completed=3]="Completed"}(t.DrawingToolState||(t.DrawingToolState={}));t.DrawingToolState;!function(e){e[e.DisplayOnTopFloat=0]="DisplayOnTopFloat",e[e.DisplayOnBottomFloat=1]="DisplayOnBottomFloat",e[e.DisplayOnTopFixed=2]="DisplayOnTopFixed"}(t.AnnnotationToolDisplayLocation||(t.AnnnotationToolDisplayLocation={}));var n=(t.AnnnotationToolDisplayLocation,function(){function e(){}return e.rectangle="&#57347;",e.ellipse="&#59962",e.arrow="&#59565",e.text="&#59774",e["delete"]="&#57607;",e.save="&#57345;",e.cancel="&#59719;",e}());t.FontConstants=n,function(e){e[e.Rectangle=0]="Rectangle",e[e.Ellipse=1]="Ellipse",e[e.Crop=2]="Crop",e[e.Arrow=3]="Arrow",e[e.Blur=4]="Blur",e[e.Text=5]="Text",e[e.Delete=6]="Delete",e[e.Save=7]="Save",e[e.Cancel=8]="Cancel"}(t.AnnotationToolbarToolType||(t.AnnotationToolbarToolType={}));var i=t.AnnotationToolbarToolType;t.annotationToolbarToolTitleDictionary={},t.initializeToolbarTooltips=o;var r=function(){function e(){}return e.annotationToolBarId="annotation-toolbar",e.marginBetweenCropRegionAndToolBar=10,e.annotationToolBarWidth=615,e.annotationToolBarHeight=145,e.colorPalletHeight=100,e.textOffsetX=3,e.textOffsetY=18,e.rectangleType="rect",e.textType="text",e.editedTextType="editedText",e.arrowType="path",e.ellipseType="ellipse",e.imageType="image",e.longPressTimout=200,e}();t.AnnotationToolBarConstants=r;var a=function(){function e(){}return e.originalCanvasId="original-canvas",e.annotatedCanvasId="annotated-canvas",e.drawingCanvasId="drawing-canvas",e}();t.AnnotationCanvasId=a;var s=function(){function e(){}return e.blurStyle="rgba(0, 0, 0, 0.7)",e.cropStyle="#fff",e}();t.CropConstants=s;var l=function(){function e(){}return e.tools=["rectangle","ellipse","crop","arrow","blur","text","delete","save","cancel"],e.cssClassSelectedToolSuffix="-selected",e}();t.CssConstants=l;var c=function(){function e(){}return e.textAreaId="text-area",e.textAreaClass="text-area",e.textAreaVisibleClass="text-area visible",e}();t.TextAreaAttributes=c;var d=function(){function e(){}return e.annotationAreaId="annotation-area",e.annotationAreaClass="annotation-area",e}();t.AnnotationAreaAttributes=d;var g=function(){function e(){}return e.pageX=200,e.pagey=200,e}();t.CrossHairsDefaultPointer=g;var u=function(){function e(){}return e.width=5,e.size=66,e.offset=42,e.color="#ffffff",e}();t.CrossHairsSolidLines=u;var h=function(){function e(){}return e.width=1,e.size=42,e.color="#cccccc",e}();t.CrossHairsCrossLines=h;var p=function(){function e(){}return e.width=1,e.offset=108,e.color="#cccccc",e.dashType="--..",e}();t.CrossHairsDashedLines=p;var f=function(){function e(){}return e.deleteKeyStroke=46,e.enterKeyStroke=13,e.escapeKeyStroke=27,e}();t.KeyStrokes=f,t.svgTextRegex1=/[\n\r]/g,t.svgTextRegex2=/\n/g,t.svgTextRegex3=/&nbsp;/g,t.imageNameRegex=/[<>?|*":\\\/&]/g,t.invalidImageNameTooltip="A screenshot name can't contain any of following characters:\n                \\ / : * ? \" < > | &"}),define("../ViewModel/Region",["require","exports"],function(e,t){var o=function(){function e(e,t,o,n){this.offsetX=e,this.offsetY=t,this.width=o,this.height=n}return e}();t.Region=o}),define("../ViewModel/DrawingTool",["require","exports","../ViewModel/AnnotationToolCommon","../ViewModel/Region"],function(e,t,o,n){var i=function(){function e(e,t,n,i,r){this.originalCanvasViewModel=t,this.annotatedCanvasViewModel=n,this.drawingCanvasViewModel=i,this.paper=r,this.annotatedCanvas=$("#"+this.annotatedCanvasViewModel.id)[0],this.annotatedContext=this.annotatedCanvas.getContext("2d"),this.drawingCanvas=$("#"+this.drawingCanvasViewModel.id)[0],this.drawingContext=this.drawingCanvas.getContext("2d"),this.drawingToolState=ko.observable(o.DrawingToolState.NotStarted),this.drawingAreaViewModel=e}return e.prototype.isMouseClickedOutisdeCroppedRegion=function(e,t){if(!this.drawingAreaViewModel.easelViewModel.isCropped)return!1;var o=this.drawingAreaViewModel.getCropDrawingTool(),n=o.getEnclosedRegion();return n.offsetX<e&&e<n.offsetX+n.width&&n.offsetY<t&&t<n.offsetY+n.height?!1:!0},e.prototype.mouseDown=function(e){},e.prototype.mouseMove=function(e){},e.prototype.mouseUp=function(e){},e.prototype.focusOut=function(){},e.prototype.getEnclosedArea=function(){return new n.Region(0,0,0,0)},e}();t.DrawingTool=i});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/CropDrawingTool",["require","exports","../ViewModel/DrawingTool","../ViewModel/AnnotationToolCommon","../ViewModel/Region","../../Tracing/Tracing"],function(e,t,o,n,i,r){var a=r.TracingService,s="CropDrawingTool",l=function(e){function t(t,o,i,r,a){e.call(this,t,o,i,r,a),this._minCropSide=6,this._boundaryRectOffset=6,this.type=n.AnnotationToolbarToolType.Crop,this._globalComposition=this.drawingContext.globalCompositeOperation}return __extends(t,e),t.prototype.mouseDown=function(e){this.drawingToolState()!==n.DrawingToolState.InProgress&&(this.drawingToolState(n.DrawingToolState.Started),this._fromX=e.pageX,this._fromY=e.pageY)},t.prototype.mouseMove=function(e){(this.drawingToolState()===n.DrawingToolState.Started||this.drawingToolState()===n.DrawingToolState.InProgress)&&(this.drawingToolState(n.DrawingToolState.InProgress),this.calculateCropDimensions(e),this.restoreDrawingCanvasSettings(),this.blurDrawingCanvas(),this.highlightCroppedRegion()),this.drawingAreaViewModel.crossHairs&&this.drawingAreaViewModel.crossHairs.moveCrossHairs(e.pageX,e.pageY)},t.prototype.mouseUp=function(e){a.traceEnter("DrawCropRegion",s,1,"Begin"),this.drawingToolState()===n.DrawingToolState.Started||this.isCropedRegionBelowThresholdSize()?this.drawingToolState(n.DrawingToolState.NotStarted):this.drawingToolState()===n.DrawingToolState.InProgress&&(this.drawingToolState(n.DrawingToolState.Completed),this.annotatedContext.drawImage(this.drawingCanvasViewModel.canvas,0,0),this.drawingAreaViewModel.deleteCrossHairs(),this.drawBoundaryRectanglesOnCroppedRegion(),this.restoreDrawingCanvasSettings()),a.traceLeave("DrawCropRegion",s,2,"End","(Left, Top, Width, Height)("+this._cropRegion.offsetY+", "+this._cropRegion.offsetX+", "+this._cropRegion.width+", "+this._cropRegion.height+")"),$("#annotation-area").focus()},t.prototype.getEnclosedRegion=function(){return this._cropRegion},t.prototype.clear=function(){this.annotatedContext.clearRect(0,0,this.annotatedCanvasViewModel.canvas.width,this.annotatedCanvasViewModel.canvas.height),this.drawingContext.clearRect(0,0,this.drawingCanvasViewModel.canvas.width,this.drawingCanvasViewModel.canvas.height)},t.prototype.blurDrawingCanvas=function(){this.drawingContext.lineWidth=0,this.drawingContext.fillStyle=n.CropConstants.blurStyle,this.drawingContext.shadowBlur=this.drawingContext.shadowOffsetX=this.drawingContext.shadowOffsetY=0,this.drawingContext.fillRect(0,0,this.drawingCanvasViewModel.canvas.width,this.drawingCanvasViewModel.canvas.height)},t.prototype.isCropedRegionBelowThresholdSize=function(){return this._cropRegion.width<this._minCropSide||this._cropRegion.height<this._minCropSide},t.prototype.restoreDrawingCanvasSettings=function(){this.drawingContext.globalCompositeOperation=this._globalComposition,this.drawingContext.clearRect(0,0,this.drawingCanvasViewModel.canvas.width,this.drawingCanvasViewModel.canvas.height)},t.prototype.calculateCropDimensions=function(e){this._cropRegion=new i.Region(Math.min(e.pageX,this._fromX),Math.min(e.pageY,this._fromY),Math.abs(e.pageX-this._fromX),Math.abs(e.pageY-this._fromY))},t.prototype.highlightCroppedRegion=function(){this.drawingContext.globalCompositeOperation="destination-out",this.drawingContext.fillStyle=n.CropConstants.cropStyle,this.drawingContext.fillRect(this._cropRegion.offsetX,this._cropRegion.offsetY,this._cropRegion.width,this._cropRegion.height)},t.prototype.drawBoundaryRectanglesOnCroppedRegion=function(){this.paper.rect(this._cropRegion.offsetX-this._boundaryRectOffset,this._cropRegion.offsetY-this._boundaryRectOffset,this._boundaryRectOffset,this._boundaryRectOffset).attr("fill","white").data("tempElement",!0),this.paper.rect(this._cropRegion.offsetX+(this._cropRegion.width-this._boundaryRectOffset)/2,this._cropRegion.offsetY-this._boundaryRectOffset,this._boundaryRectOffset,this._boundaryRectOffset).attr("fill","white").data("tempElement",!0),this.paper.rect(this._cropRegion.offsetX+this._cropRegion.width,this._cropRegion.offsetY-this._boundaryRectOffset,this._boundaryRectOffset,this._boundaryRectOffset).attr("fill","white").data("tempElement",!0),this.paper.rect(this._cropRegion.offsetX+this._cropRegion.width,this._cropRegion.offsetY+(this._cropRegion.height-this._boundaryRectOffset)/2,this._boundaryRectOffset,this._boundaryRectOffset).attr("fill","white").data("tempElement",!0),this.paper.rect(this._cropRegion.offsetX+this._cropRegion.width,this._cropRegion.offsetY+this._cropRegion.height,this._boundaryRectOffset,this._boundaryRectOffset).attr("fill","white").data("tempElement",!0),this.paper.rect(this._cropRegion.offsetX+(this._cropRegion.width-this._boundaryRectOffset)/2,this._cropRegion.offsetY+this._cropRegion.height,this._boundaryRectOffset,this._boundaryRectOffset).attr("fill","white").data("tempElement",!0),this.paper.rect(this._cropRegion.offsetX-this._boundaryRectOffset,this._cropRegion.offsetY+this._cropRegion.height,this._boundaryRectOffset,this._boundaryRectOffset).attr("fill","white").data("tempElement",!0),this.paper.rect(this._cropRegion.offsetX-this._boundaryRectOffset,this._cropRegion.offsetY+(this._cropRegion.height-this._boundaryRectOffset)/2,this._boundaryRectOffset,this._boundaryRectOffset).attr("fill","white").data("tempElement",!0)},t}(o.DrawingTool);t.CropDrawingTool=l}),define("../ViewModel/CanvasViewModel",["require","exports"],function(e,t){var o=function(){function e(e,t){this.id=e,this.canvas=t}return e}();t.CanvasViewModel=o}),define("../../AnnotationTool/ViewModel/AnnotationToolCommon",["require","exports"],function(e,t){function o(){t.annotationToolbarToolTitleDictionary[i.Rectangle]="Draw rectangle",t.annotationToolbarToolTitleDictionary[i.Ellipse]="Draw ellipse",t.annotationToolbarToolTitleDictionary[i.Crop]="Crop area",t.annotationToolbarToolTitleDictionary[i.Arrow]="Draw arrow",t.annotationToolbarToolTitleDictionary[i.Blur]="Blur area",t.annotationToolbarToolTitleDictionary[i.Text]="Add text",t.annotationToolbarToolTitleDictionary[i.Delete]="Delete selected shape",t.annotationToolbarToolTitleDictionary[i.Save]="Save screenshot",t.annotationToolbarToolTitleDictionary[i.Cancel]="Exit without saving"}!function(e){e[e.NotStarted=0]="NotStarted",e[e.Started=1]="Started",e[e.InProgress=2]="InProgress",e[e.Completed=3]="Completed"}(t.DrawingToolState||(t.DrawingToolState={}));t.DrawingToolState;!function(e){e[e.DisplayOnTopFloat=0]="DisplayOnTopFloat",e[e.DisplayOnBottomFloat=1]="DisplayOnBottomFloat",e[e.DisplayOnTopFixed=2]="DisplayOnTopFixed"}(t.AnnnotationToolDisplayLocation||(t.AnnnotationToolDisplayLocation={}));var n=(t.AnnnotationToolDisplayLocation,function(){function e(){}return e.rectangle="&#57347;",e.ellipse="&#59962",e.arrow="&#59565",e.text="&#59774",e["delete"]="&#57607;",e.save="&#57345;",e.cancel="&#59719;",e}());t.FontConstants=n,function(e){e[e.Rectangle=0]="Rectangle",e[e.Ellipse=1]="Ellipse",e[e.Crop=2]="Crop",e[e.Arrow=3]="Arrow",e[e.Blur=4]="Blur",e[e.Text=5]="Text",e[e.Delete=6]="Delete",e[e.Save=7]="Save",e[e.Cancel=8]="Cancel"}(t.AnnotationToolbarToolType||(t.AnnotationToolbarToolType={}));var i=t.AnnotationToolbarToolType;t.annotationToolbarToolTitleDictionary={},t.initializeToolbarTooltips=o;var r=function(){function e(){}return e.annotationToolBarId="annotation-toolbar",e.marginBetweenCropRegionAndToolBar=10,e.annotationToolBarWidth=615,e.annotationToolBarHeight=145,e.colorPalletHeight=100,e.textOffsetX=3,e.textOffsetY=18,e.rectangleType="rect",e.textType="text",e.editedTextType="editedText",e.arrowType="path",e.ellipseType="ellipse",e.imageType="image",e.longPressTimout=200,e}();t.AnnotationToolBarConstants=r;var a=function(){function e(){}return e.originalCanvasId="original-canvas",e.annotatedCanvasId="annotated-canvas",e.drawingCanvasId="drawing-canvas",e}();t.AnnotationCanvasId=a;var s=function(){function e(){}return e.blurStyle="rgba(0, 0, 0, 0.7)",e.cropStyle="#fff",e}();t.CropConstants=s;var l=function(){function e(){}return e.tools=["rectangle","ellipse","crop","arrow","blur","text","delete","save","cancel"],e.cssClassSelectedToolSuffix="-selected",e}();t.CssConstants=l;var c=function(){function e(){}return e.textAreaId="text-area",e.textAreaClass="text-area",e.textAreaVisibleClass="text-area visible",e}();t.TextAreaAttributes=c;var d=function(){function e(){}return e.annotationAreaId="annotation-area",e.annotationAreaClass="annotation-area",e}();t.AnnotationAreaAttributes=d;var g=function(){function e(){}return e.pageX=200,e.pagey=200,e}();t.CrossHairsDefaultPointer=g;var u=function(){function e(){}return e.width=5,e.size=66,e.offset=42,e.color="#ffffff",e}();t.CrossHairsSolidLines=u;var h=function(){function e(){}return e.width=1,e.size=42,e.color="#cccccc",e}();t.CrossHairsCrossLines=h;var p=function(){function e(){}return e.width=1,e.offset=108,e.color="#cccccc",e.dashType="--..",e}();t.CrossHairsDashedLines=p;var f=function(){function e(){}return e.deleteKeyStroke=46,e.enterKeyStroke=13,e.escapeKeyStroke=27,e}();t.KeyStrokes=f,t.svgTextRegex1=/[\n\r]/g,t.svgTextRegex2=/\n/g,t.svgTextRegex3=/&nbsp;/g,t.imageNameRegex=/[<>?|*":\\\/&]/g,t.invalidImageNameTooltip="A screenshot name can't contain any of following characters:\n                \\ / : * ? \" < > | &"}),define("../AnnotationToolTelemetry",["require","exports","../AnnotationTool/ViewModel/AnnotationToolCommon","../Common/Constants"],function(e,t,o,n){var i=o.AnnotationToolBarConstants,r=function(){function e(){}return e.initialize=function(){this.data={createShapeDictionary:{},deleteShapeDictionary:{},isFullScreen:!1,textEditedCount:0,beepCount:0,errorCode:0,source:n.TelemetryConstants.XTSource},this.setDefaultCreateAndDeleteShapeCount(i.arrowType),this.setDefaultCreateAndDeleteShapeCount(i.ellipseType),this.setDefaultCreateAndDeleteShapeCount(i.imageType),this.setDefaultCreateAndDeleteShapeCount(i.rectangleType),this.setDefaultCreateAndDeleteShapeCount(i.textType)},e.getData=function(){return this.data},e.shapeCreated=function(e){this.initializeIfDataIsNull(),this.data.createShapeDictionary[e]++},e.shapeRemoved=function(e){this.initializeIfDataIsNull(),this.data.deleteShapeDictionary[e]++},e.setFullScreenMode=function(){this.initializeIfDataIsNull(),this.data.isFullScreen=!0},e.textOverflow=function(){this.initializeIfDataIsNull(),this.data.beepCount++},e.existingTextEdited=function(){this.initializeIfDataIsNull(),this.data.textEditedCount++},e.setDefaultCreateAndDeleteShapeCount=function(e){this.data.createShapeDictionary[e]=0,this.data.deleteShapeDictionary[e]=0},e.initializeIfDataIsNull=function(){this.data||this.initialize()},e}();t.AnnotationTelemetry=r});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/RectangleDrawingTool",["require","exports","../ViewModel/DrawingTool","../ViewModel/AnnotationToolCommon","../ViewModel/Region","../ViewModel/AnnotationSettings","../AnnotationToolTelemetry"],function(e,t,o,n,i,r,a){var s=function(e){function t(t,o,i,r,a){e.call(this,t,o,i,r,a),this.type=n.AnnotationToolbarToolType.Rectangle}return __extends(t,e),t.prototype.mouseDown=function(e){this.isMouseClickedOutisdeCroppedRegion(e.pageX,e.pageY)||this._activeTool||(this._settings=r.getSettings(n.AnnotationToolbarToolType[this.type]),this._activeTool=!0,this._fromX=e.pageX,this._fromY=e.pageY,this._rectRegion=new i.Region(this._fromX,this._fromY,0,0),this._item=null)},t.prototype.mouseMove=function(e){if(this._activeTool){this._item||(this._item=this.paper.rect(this._fromX,this._fromY,0,0)),this._rectRegion=new i.Region(Math.min(e.pageX,this._fromX),Math.min(e.pageY,this._fromY),Math.abs(e.pageX-this._fromX),Math.abs(e.pageY-this._fromY));var t={cursor:"pointer","stroke-width":6,stroke:this._settings.color,width:this._rectRegion.width,height:this._rectRegion.height,x:this._rectRegion.offsetX,y:this._rectRegion.offsetY};this._item.attr(t)}},t.prototype.mouseUp=function(e){this._activeTool&&(null!=this._item&&a.AnnotationTelemetry.shapeCreated(n.AnnotationToolBarConstants.rectangleType),this._activeTool=!1)},t.prototype.getEnclosedRegion=function(){return this._rectRegion},t}(o.DrawingTool);t.RectangleDrawingTool=s});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/EllipseDrawingTool",["require","exports","../ViewModel/DrawingTool","../ViewModel/AnnotationToolCommon","../ViewModel/AnnotationSettings","../AnnotationToolTelemetry"],function(e,t,o,n,i,r){var a=function(e){function t(t,o,i,r,a){e.call(this,t,o,i,r,a),this.type=n.AnnotationToolbarToolType.Ellipse}return __extends(t,e),t.prototype.mouseDown=function(e){this.isMouseClickedOutisdeCroppedRegion(e.pageX,e.pageY)||this._activeTool||(this._settings=i.getSettings(n.AnnotationToolbarToolType[this.type]),this._activeTool=!0,this._fromX=e.pageX,this._fromY=e.pageY,this._item=null,this._centerX=this._fromX,this._centerY=this._fromY,this._radiusX=0,this._radiusY=0)},t.prototype.mouseMove=function(e){if(this._activeTool){this._item||(this._item=this.paper.ellipse(this._fromX,this._fromY,0,0)),this._toX=e.pageX,this._toY=e.pageY,this._centerX=(this._fromX+this._toX)/2,this._centerY=(this._fromY+this._toY)/2,this._radiusX=Math.abs(this._toX-this._fromX)/2,this._radiusY=Math.abs(this._toY-this._fromY)/2;var t={cursor:"pointer","stroke-width":6,stroke:this._settings.color,cx:this._centerX,cy:this._centerY,rx:this._radiusX,ry:this._radiusY};this._item.attr(t)}},t.prototype.mouseUp=function(e){this._activeTool&&(null!=this._item&&r.AnnotationTelemetry.shapeCreated(n.AnnotationToolBarConstants.ellipseType),this._activeTool=!1)},t}(o.DrawingTool);t.EllipseDrawingTool=a});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/TextDrawingTool",["require","exports","../ViewModel/DrawingTool","../ViewModel/AnnotationToolCommon","../ViewModel/AnnotationSettings","../AnnotationToolTelemetry"],function(e,t,o,n,i,r){var a=function(e){function t(t,o,i,r,a,s){e.call(this,t,o,i,r,a),this._textAreaInitialWidth=20,this._textAreaInitialHeight=29,this._offsetX=n.AnnotationToolBarConstants.textOffsetX,this._offsetY=n.AnnotationToolBarConstants.textOffsetY,this._paddingX=9,this._paddingY=6,this._tspanPaddingY=19,this._textFontSize=14,this._textStrokeWidth=2,this._textFontWeight="bold",this._textAnchor="start",this._textFontFamily="Arial Black",this.type=n.AnnotationToolbarToolType.Text,this.textArea=s}return __extends(t,e),t.prototype.mouseDown=function(e){$(this.textArea).css("-webkit-text-fill-color",this._getColor()),$(this.textArea).css("color",this._getColor()),$(this.textArea).css("border-color",this._getColor()),this.drawText(this.textArea.value,this._paperElement),this.isMouseClickedOutisdeCroppedRegion(e.pageX,e.pageY)||(this._paperElement=this.paper.getElementByPoint(e.pageX,e.pageY),this._paperElement&&"text"===this._paperElement.type?this.reinitializeTextArea(e):(this._paperElement=null,this.initializeTextArea(e)),this.textArea.focus())},t.prototype.focusOut=function(){this.drawText(this.textArea.value,this._paperElement)},t.prototype.reinitializeTextArea=function(e){this._paperElement.hide(),r.AnnotationTelemetry.existingTextEdited(),this._textX=this._paperElement.attrs.x,this._textY=this._paperElement.attrs.y,this.textArea.style.left=this._paperElement.attrs.x-this._offsetX+"px",this.textArea.style.top=this._paperElement.attrs.y-this._offsetY+"px",this.textArea.style.width=this._paperElement.data("textWidth"),this.textArea.style.height=this._paperElement.data("textHeight"),this.textArea.value=this._paperElement.attrs.text,this.textArea.className=n.TextAreaAttributes.textAreaVisibleClass},t.prototype.initializeTextArea=function(e){this._minWidth=Math.min(this._textAreaInitialWidth,this.paper.width-e.pageX),this._minHeight=Math.min(this._textAreaInitialHeight,this.paper.height-e.pageY),this._minWidth>this._paddingX&&this._minHeight>this._paddingY+this._textFontSize&&(this._textX=e.pageX+this._offsetX,this._textY=e.pageY+this._offsetY,this.textArea.style.left=e.pageX+"px",this.textArea.style.top=e.pageY+"px",this.textArea.style.width=this._minWidth-this._paddingX+"px",this.textArea.style.height=this._minHeight-this._paddingY+"px",this.textArea.className=n.TextAreaAttributes.textAreaVisibleClass)},t.prototype.drawText=function(e,t){if(this.textArea.className=n.TextAreaAttributes.textAreaClass,this.textArea.value="",""!==e){if(r.AnnotationTelemetry.shapeCreated(n.AnnotationToolBarConstants.textType),e=e.replace(n.svgTextRegex1,"\n").replace(n.svgTextRegex2,"\n"),t)t.attr({text:e,fill:this._getColor()}),t.show();else{t=this.paper.text(this._textX,this._textY,e).attr({"font-size":this._textFontSize+"px","font-weight":this._textFontWeight,"font-family":this._textFontFamily,"text-anchor":this._textAnchor,fill:this._getColor(),"stroke-width":this._textStrokeWidth+"px"}),t.node.setAttribute("xml:space","preserve");var o=this;t.dblclick(function(e){o.enterEditMode(o.drawingAreaViewModel,o,e)})}t.data("textWidth",this.textArea.style.width),t.data("textHeight",this.textArea.style.height),$("tspan",t.node).attr("dy",this._tspanPaddingY),t[0].childNodes[0].attributes[0].value=0}},t.prototype.enterEditMode=function(e,t,o){e.selectedDrawingTool===this&&(e.deselectSelectedTool(),t.mouseDown(o))},t.prototype._getColor=function(){return i.getSettings(n.AnnotationToolbarToolType[this.type]).color},t}(o.DrawingTool);t.TextDrawingTool=a});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/ArrowDrawingTool",["require","exports","../ViewModel/DrawingTool","../ViewModel/AnnotationToolCommon","../ViewModel/AnnotationSettings","../AnnotationToolTelemetry"],function(e,t,o,n,i,r){var a=function(e){function t(t,o,i,r,a){e.call(this,t,o,i,r,a),this._arrowWidth=6,this._arrowAttribute="block-midium-midium",this.type=n.AnnotationToolbarToolType.Arrow}return __extends(t,e),t.prototype.mouseDown=function(e){this.isMouseClickedOutisdeCroppedRegion(e.pageX,e.pageY)||this._activeTool||(this._settings=i.getSettings(n.AnnotationToolbarToolType[this.type]),this._activeTool=!0,this._fromX=e.pageX,this._fromY=e.pageY,this._item=null)},t.prototype.mouseMove=function(e){if(this._activeTool){this._item||(this._item=this.paper.path("M"+this._fromX+","+this._fromY+"L"+this._fromX+","+this._fromY).attr({cursor:"pointer","stroke-width":this._arrowWidth,stroke:this._settings.color,"arrow-end":this._arrowAttribute}));var t={path:"M"+this._fromX+","+this._fromY+"L"+e.pageX+","+e.pageY};this._item.attr(t)}},t.prototype.mouseUp=function(e){this._activeTool&&(null!=this._item&&r.AnnotationTelemetry.shapeCreated(n.AnnotationToolBarConstants.arrowType),
this._activeTool=!1)},t}(o.DrawingTool);t.ArrowDrawingTool=a}),define("../ViewModel/SelectTool",["require","exports"],function(e,t){var o=function(){function e(e,t){this.paper=e,this.selectedElement=t}return e.prototype.mouseDown=function(e){},e.prototype.mouseMove=function(e){},e.prototype.mouseUp=function(e){},e.prototype["delete"]=function(){},e.prototype.deselect=function(){},e}();t.SelectTool=o});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/SelectToolWithRectangleBoundary",["require","exports","../ViewModel/SelectTool","../AnnotationToolTelemetry"],function(e,t,o,n){var i=function(e){function t(t,o){e.call(this,t,o),this._boundaryRectOffset=3}return __extends(t,e),t.prototype.mouseDown=function(e){},t.prototype.mouseMove=function(e){},t.prototype.mouseUp=function(e){},t.prototype["delete"]=function(){n.AnnotationTelemetry.shapeRemoved(this.selectedElement.type),this.selectedElement.remove(),this._boundaryRectangle.remove(),this._boundaryTopLeftRectangle.remove(),this._boundaryTopRightRectangle.remove(),this._boundaryBottomLeftRectangle.remove(),this._boundaryBottomRightRectangle.remove()},t.prototype.deselect=function(){this._boundaryRectangle.remove(),this._boundaryTopLeftRectangle.remove(),this._boundaryTopRightRectangle.remove(),this._boundaryBottomLeftRectangle.remove(),this._boundaryBottomRightRectangle.remove()},t.prototype.drawBoundaryRectangles=function(){this.calculateBoundaryRectangleDimensions(),this.drawBoundaryRectangle(),this.drawCornerRectangles()},t.prototype.calculateBoundaryRectangleDimensions=function(){},t.prototype.drawBoundaryRectangle=function(){this._boundaryRectangle=this.paper.rect(this._boundaryRectX,this._boundaryRectY,this._boundaryWidth,this._boundaryHeight).attr({cursor:"pointer","fill-opacity":0,stroke:"#000","stroke-width":1,"stroke-dasharray":"- "})},t.prototype.drawCornerRectangles=function(){this._boundaryTopLeftRectangle=this.paper.rect(this._boundaryRectX-this._boundaryRectOffset,this._boundaryRectY-this._boundaryRectOffset,2*this._boundaryRectOffset,2*this._boundaryRectOffset).attr({cursor:"pointer",fill:"white"}),this._boundaryTopRightRectangle=this.paper.rect(this._boundaryRectX+this._boundaryWidth-this._boundaryRectOffset,this._boundaryRectY-this._boundaryRectOffset,2*this._boundaryRectOffset,2*this._boundaryRectOffset).attr({cursor:"pointer",fill:"white"}),this._boundaryBottomLeftRectangle=this.paper.rect(this._boundaryRectX-this._boundaryRectOffset,this._boundaryRectY+this._boundaryHeight-this._boundaryRectOffset,2*this._boundaryRectOffset,2*this._boundaryRectOffset).attr({cursor:"pointer",fill:"white"}),this._boundaryBottomRightRectangle=this.paper.rect(this._boundaryRectX+this._boundaryWidth-this._boundaryRectOffset,this._boundaryRectY+this._boundaryHeight-this._boundaryRectOffset,2*this._boundaryRectOffset,2*this._boundaryRectOffset).attr({cursor:"pointer",fill:"white"})},t}(o.SelectTool);t.SelectToolWithRectangleBoundary=i});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/RectangleSelectTool",["require","exports","../ViewModel/SelectToolWithRectangleBoundary"],function(e,t,o){var n=function(e){function t(t,o){e.call(this,t,o),this._widthOffset=4}return __extends(t,e),t.prototype.mouseDown=function(e){this.drawBoundaryRectangles()},t.prototype.mouseMove=function(e){},t.prototype.calculateBoundaryRectangleDimensions=function(){this._boundaryRectX=this.selectedElement.attrs.x-this._widthOffset,this._boundaryRectY=this.selectedElement.attrs.y-this._widthOffset,this._boundaryWidth=this.selectedElement.attrs.width+2*this._widthOffset,this._boundaryHeight=this.selectedElement.attrs.height+2*this._widthOffset},t}(o.SelectToolWithRectangleBoundary);t.RectangleSelectTool=n});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/EllipseSelectTool",["require","exports","../ViewModel/SelectToolWithRectangleBoundary"],function(e,t,o){var n=function(e){function t(t,o){e.call(this,t,o),this._widthOffset=3}return __extends(t,e),t.prototype.mouseDown=function(e){this.drawBoundaryRectangles()},t.prototype.mouseMove=function(e){},t.prototype.calculateBoundaryRectangleDimensions=function(){this._boundaryRectX=this.selectedElement.attrs.cx-this.selectedElement.attrs.rx-this._widthOffset,this._boundaryRectY=this.selectedElement.attrs.cy-this.selectedElement.attrs.ry-this._widthOffset,this._boundaryWidth=2*this.selectedElement.attrs.rx+2*this._widthOffset,this._boundaryHeight=2*this.selectedElement.attrs.ry+2*this._widthOffset},t}(o.SelectToolWithRectangleBoundary);t.EllipseSelectTool=n});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/ArrowSelectTool",["require","exports","../ViewModel/SelectTool","../AnnotationToolTelemetry"],function(e,t,o,n){var i=function(e){function t(t,o){e.call(this,t,o),this._boundaryRectOffset=3}return __extends(t,e),t.prototype.mouseDown=function(e){this.drawBoundaryRectangles()},t.prototype.mouseMove=function(e){},t.prototype.deselect=function(){this._boundaryrect1.remove(),this._boundaryrect2.remove()},t.prototype["delete"]=function(){n.AnnotationTelemetry.shapeRemoved(this.selectedElement.type),this.selectedElement.remove(),this._boundaryrect1.remove(),this._boundaryrect2.remove()},t.prototype.drawBoundaryRectangles=function(){this._boundaryrect1=this.paper.rect(this.selectedElement.attrs.path[0][1]-this._boundaryRectOffset,this.selectedElement.attrs.path[0][2]-this._boundaryRectOffset,2*this._boundaryRectOffset,2*this._boundaryRectOffset).attr("fill","white"),this._boundaryrect2=this.paper.rect(this.selectedElement.attrs.path[1][1]-this._boundaryRectOffset,this.selectedElement.attrs.path[1][2]-this._boundaryRectOffset,2*this._boundaryRectOffset,2*this._boundaryRectOffset).attr("fill","white")},t}(o.SelectTool);t.ArrowSelectTool=i});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/TextSelectTool",["require","exports","../ViewModel/SelectToolWithRectangleBoundary","../ViewModel/AnnotationToolCommon"],function(e,t,o,n){var i=function(e){function t(t,o){e.call(this,t,o),this._offsetX=n.AnnotationToolBarConstants.textOffsetX,this._offsetY=n.AnnotationToolBarConstants.textOffsetY}return __extends(t,e),t.prototype.mouseDown=function(e){this.drawBoundaryRectangles()},t.prototype.mouseMove=function(e){},t.prototype.calculateBoundaryRectangleDimensions=function(){this._boundaryRectX=this.selectedElement.attrs.x-this._offsetX,this._boundaryRectY=this.selectedElement.attrs.y-this._offsetY,this._boundaryWidth=parseInt(this.selectedElement.data("textWidth"))+4,this._boundaryHeight=parseInt(this.selectedElement.data("textHeight"))},t}(o.SelectToolWithRectangleBoundary);t.TextSelectTool=i});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/BlurDrawingTool",["require","exports","../ViewModel/DrawingTool","../ViewModel/AnnotationToolCommon","../ViewModel/AnnotationSettings","../ViewModel/Region","../../Tracing/Tracing","../AnnotationToolTelemetry"],function(e,t,o,n,i,r,a,s){var l=a.TracingService,c="BlurDrawingTool",d=function(e){function t(t,o,i,r,a){e.call(this,t,o,i,r,a),this._blurIntensity=5,this.type=n.AnnotationToolbarToolType.Blur}return __extends(t,e),t.prototype.mouseDown=function(e){this.isMouseClickedOutisdeCroppedRegion(e.pageX,e.pageY)||this._activeTool||(this._settings=i.getSettings(n.AnnotationToolbarToolType[this.type]),this._activeTool=!0,this._fromX=e.pageX,this._fromY=e.pageY,this._item=null)},t.prototype.mouseMove=function(e){if(this._activeTool){if(l.traceEnter("BlurAction",c,1,"Begin"),!this.validateAndSetBlurRegion(e))return;var t=this.originalCanvasViewModel.canvas.getContext("2d"),o=t.getImageData(this._blurRegion.offsetX,this._blurRegion.offsetY,this._blurRegion.width,this._blurRegion.height);o=this.blurImage(o),this.drawingContext.clearRect(0,0,this.drawingCanvas.width,this.drawingCanvas.width),this.drawingContext.putImageData(o,this._blurRegion.offsetX,this._blurRegion.offsetY),l.traceLeave("BlurAction",c,2,"End")}},t.prototype.mouseUp=function(e){if(this._activeTool){if(this._activeTool=!1,!this.validateAndSetBlurRegion(e))return;s.AnnotationTelemetry.shapeCreated(n.AnnotationToolBarConstants.imageType);var t=document.createElement("canvas");t.width=this._blurRegion.width,t.height=this._blurRegion.height;var o=t.getContext("2d");o.putImageData(this.drawingContext.getImageData(this._blurRegion.offsetX,this._blurRegion.offsetY,this._blurRegion.width,this._blurRegion.height),0,0),this._item=this.paper.image(t.toDataURL(),this._blurRegion.offsetX,this._blurRegion.offsetY,this._blurRegion.width,this._blurRegion.height);var i={cursor:"pointer"};this._item.attr(i),this.drawingContext.clearRect(0,0,this.drawingCanvas.width,this.drawingCanvas.width)}},t.prototype.getEnclosedRegion=function(){return this._blurRegion},t.prototype.validateAndSetBlurRegion=function(e){return this._blurRegion=new r.Region(Math.min(e.pageX,this._fromX),Math.min(e.pageY,this._fromY),Math.abs(e.pageX-this._fromX),Math.abs(e.pageY-this._fromY)),0===this._blurRegion.width||0===this._blurRegion.height?!1:!0},t.prototype.blurImage=function(e){l.traceEnter("ApplyBlur",c,3,"Begin","BlurIntensity: "+this._blurIntensity);var t,o,n,i,r=e.width,a=e.height,s=e.data,d=0,g=0,u=0,h=0,p=0,f=0;for(i=0;i<this._blurIntensity;i++)for(var m=0;2>m;m++)for(m?(p=r,h=a,g=4*r):(p=a,h=r,g=4),t=0;p>t;t++)for(u=0===m?t*r*4:4*t,n=0;3>n;n++){for(d=u+n,f=0,f=s[d]+s[d+g]+s[d+2*g],s[d]=Math.floor(f/3),f+=s[d+3*g],s[d+g]=Math.floor(f/4),f+=s[d+4*g],s[d+2*g]=Math.floor(f/5),o=3;h-2>o;o++)f=Math.max(0,f-s[d+(o-2)*g]+s[d+(o+2)*g]),s[d+o*g]=Math.floor(f/5);f-=s[d+(o-2)*g],s[d+o*g]=Math.floor(f/4),f-=s[d+(o-1)*g],s[d+(o+1)*g]=Math.floor(f/3)}return l.traceLeave("ApplyBlur",c,4,"End"),e},t}(o.DrawingTool);t.BlurDrawingTool=d}),define("../ViewModel/CrossHairs",["require","exports","../ViewModel/AnnotationToolCommon"],function(e,t,o){var n=function(){function e(e){this._solidLines=new Array,this._crossLines=new Array,this._dashedLines=new Array,this.paper=e}return e.prototype.initializeCrossHairs=function(e,t){this.createSolidLines(e,t),this.createCrossLines(e,t),this.createDashedLines(e,t)},e.prototype.moveCrossHairs=function(e,t){this.moveSolidLines(e,t),this.moveCrossLines(e,t),this.moveDashedLines(e,t)},e.prototype.deleteCrossHairs=function(){this.deleteSolidLines(),this.deleteCrossLines(),this.deleteDashedLines()},e.prototype.createSolidLines=function(e,t){this._solidLines.push(this.paper.path("M"+(e+o.CrossHairsSolidLines.offset)+","+t+"L"+(e+o.CrossHairsSolidLines.offset+o.CrossHairsSolidLines.size)+","+t).attr({"stroke-width":o.CrossHairsSolidLines.width,stroke:o.CrossHairsSolidLines.color})),this._solidLines.push(this.paper.path("M"+e+","+(t-o.CrossHairsSolidLines.offset)+"L"+e+","+(t-o.CrossHairsSolidLines.offset-o.CrossHairsSolidLines.size)).attr({"stroke-width":o.CrossHairsSolidLines.width,stroke:o.CrossHairsSolidLines.color})),this._solidLines.push(this.paper.path("M"+(e-o.CrossHairsSolidLines.offset)+","+t+"L"+(e-o.CrossHairsSolidLines.offset-o.CrossHairsSolidLines.size)+","+t).attr({"stroke-width":o.CrossHairsSolidLines.width,stroke:o.CrossHairsSolidLines.color})),this._solidLines.push(this.paper.path("M"+e+","+(t+o.CrossHairsSolidLines.offset)+"L"+e+","+(t+o.CrossHairsSolidLines.offset+o.CrossHairsSolidLines.size)).attr({"stroke-width":o.CrossHairsSolidLines.width,stroke:o.CrossHairsSolidLines.color}))},e.prototype.createCrossLines=function(e,t){this._crossLines.push(this.paper.path("M"+(e-o.CrossHairsCrossLines.size)+","+t+"L"+(e+o.CrossHairsCrossLines.size)+","+t).attr({"stroke-width":o.CrossHairsCrossLines.width,stroke:o.CrossHairsCrossLines.color})),this._crossLines.push(this.paper.path("M"+e+","+(t-o.CrossHairsCrossLines.size)+"L"+e+","+(t+o.CrossHairsCrossLines.size)).attr({"stroke-width":o.CrossHairsCrossLines.width,stroke:o.CrossHairsCrossLines.color}))},e.prototype.createDashedLines=function(e,t){this._dashedLines.push(this.paper.path("M"+(e+o.CrossHairsDashedLines.offset)+","+t+"L"+this.paper.width+","+t).attr({"stroke-width":o.CrossHairsDashedLines.width,stroke:o.CrossHairsDashedLines.color,"stroke-dasharray":o.CrossHairsDashedLines.dashType})),this._dashedLines.push(this.paper.path("M"+e+","+(t-o.CrossHairsDashedLines.offset)+"L"+e+",0").attr({"stroke-width":o.CrossHairsDashedLines.width,stroke:o.CrossHairsDashedLines.color,"stroke-dasharray":o.CrossHairsDashedLines.dashType})),this._dashedLines.push(this.paper.path("M"+(e-o.CrossHairsDashedLines.offset)+","+t+"L0,"+t).attr({"stroke-width":o.CrossHairsDashedLines.width,stroke:o.CrossHairsDashedLines.color,"stroke-dasharray":o.CrossHairsDashedLines.dashType})),this._dashedLines.push(this.paper.path("M"+e+","+(t+o.CrossHairsDashedLines.offset)+"L"+e+","+this.paper.height).attr({"stroke-width":o.CrossHairsDashedLines.width,stroke:o.CrossHairsDashedLines.color,"stroke-dasharray":o.CrossHairsDashedLines.dashType}))},e.prototype.moveSolidLines=function(e,t){var n={path:"M"+(e+o.CrossHairsSolidLines.offset)+","+t+"L"+(e+o.CrossHairsSolidLines.offset+o.CrossHairsSolidLines.size)+","+t};this._solidLines[0].attr(n),n={path:"M"+e+","+(t-o.CrossHairsSolidLines.offset)+"L"+e+","+(t-o.CrossHairsSolidLines.offset-o.CrossHairsSolidLines.size)},this._solidLines[1].attr(n),n={path:"M"+(e-o.CrossHairsSolidLines.offset)+","+t+"L"+(e-o.CrossHairsSolidLines.offset-o.CrossHairsSolidLines.size)+","+t},this._solidLines[2].attr(n),n={path:"M"+e+","+(t+o.CrossHairsSolidLines.offset)+"L"+e+","+(t+o.CrossHairsSolidLines.offset+o.CrossHairsSolidLines.size)},this._solidLines[3].attr(n)},e.prototype.moveCrossLines=function(e,t){var n={path:"M"+(e-o.CrossHairsCrossLines.size)+","+t+"L"+(e+o.CrossHairsCrossLines.size)+","+t};this._crossLines[0].attr(n),n={path:"M"+e+","+(t-o.CrossHairsCrossLines.size)+"L"+e+","+(t+o.CrossHairsCrossLines.size)},this._crossLines[1].attr(n)},e.prototype.moveDashedLines=function(e,t){var n={path:"M"+(e+o.CrossHairsDashedLines.offset)+","+t+"L"+this.paper.width+","+t};this._dashedLines[0].attr(n),n={path:"M"+e+","+(t-o.CrossHairsDashedLines.offset)+"L"+e+",0"},this._dashedLines[1].attr(n),n={path:"M"+(e-o.CrossHairsDashedLines.offset)+","+t+"L0,"+t},this._dashedLines[2].attr(n),n={path:"M"+e+","+(t+o.CrossHairsDashedLines.offset)+"L"+e+","+this.paper.height},this._dashedLines[3].attr(n)},e.prototype.deleteSolidLines=function(){this._solidLines[0].remove(),this._solidLines[1].remove(),this._solidLines[2].remove(),this._solidLines[3].remove()},e.prototype.deleteCrossLines=function(){this._crossLines[0].remove(),this._crossLines[1].remove()},e.prototype.deleteDashedLines=function(){this._dashedLines[0].remove(),this._dashedLines[1].remove(),this._dashedLines[2].remove(),this._dashedLines[3].remove()},e}();t.CrossHairs=n}),define("../ViewModel/DrawingAreaViewModel",["require","exports","../ViewModel/AnnotationToolCommon","../ViewModel/CropDrawingTool","../ViewModel/CanvasViewModel","../ViewModel/RectangleDrawingTool","../ViewModel/EllipseDrawingTool","../ViewModel/TextDrawingTool","../ViewModel/ArrowDrawingTool","../ViewModel/Region","../../Common/SessionData","../ViewModel/RectangleSelectTool","../ViewModel/EllipseSelectTool","../ViewModel/ArrowSelectTool","../ViewModel/TextSelectTool","../ViewModel/BlurDrawingTool","../ViewModel/CrossHairs","../AnnotationToolTelemetry"],function(e,t,o,n,i,r,a,s,l,c,d,g,u,h,p,f,m,v){var y=d.ScreenshotEx,T=function(){function e(e,t){this.drawingTools=ko.observableArray([]),this.crossHairsLinesModeOn=ko.observable(!0),this._beepAudioDataURI="data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=",this.easelViewModel=e,this._toolbarViewModel=t,this.init()}return e.prototype.initializeDrawingArea=function(e,t,n,i){this.paper.setSize(e,t);var r=document.getElementById(o.AnnotationCanvasId.originalCanvasId);this._originalCanvasViewModel.canvas=r;var a=document.getElementById(o.AnnotationCanvasId.annotatedCanvasId);a.width=e,a.height=t,this._annotatedCanvasViewModel.canvas=a;var s=this;document.addEventListener("keydown",function(e){s.keyboardEventHandler(s,e)},!0),this.imageId=i;var l=document.getElementById(o.AnnotationCanvasId.drawingCanvasId);l.width=e,l.height=t,this._drawingCanvasViewModel.canvas=l,this._toolbarViewModel.imageName(n),this.getCropDrawingTool().blurDrawingCanvas(),this.crossHairs=new m.CrossHairs(this.paper),this.crossHairs.initializeCrossHairs(o.CrossHairsDefaultPointer.pageX,o.CrossHairsDefaultPointer.pageX)},e.prototype.getCropDrawingTool=function(){for(var e=0;e<this.drawingTools().length;e++)if(this.drawingTools()[e].type===o.AnnotationToolbarToolType.Crop)return this.drawingTools()[e];return null},e.prototype.deselectSelectedTool=function(){this._selectedTool&&(this._selectedTool.deselect(),this._selectedTool=null)},e.prototype.mouseDown=function(e,t){this._active=!0,this.deselectSelectedTool();var o=this.getSelectedTool(t.pageX,t.pageY);return o&&!this.crossHairsLinesModeOn()?(this._selectedTool=o,this._selectedTool.mouseDown(t),void(this.selectedDrawingTool&&this.selectedDrawingTool.focusOut&&this.selectedDrawingTool.focusOut())):void(this.selectedDrawingTool&&this.selectedDrawingTool.mouseDown&&this.selectedDrawingTool.mouseDown(t))},e.prototype.mouseMove=function(e,t){return this._active&&this._selectedTool?void this._selectedTool.mouseMove(t):void(this.selectedDrawingTool&&this.selectedDrawingTool.mouseMove&&this.selectedDrawingTool.mouseMove(t))},e.prototype.mouseUp=function(e,t){this._active=!1,this._selectedTool||this.selectedDrawingTool&&this.selectedDrawingTool.mouseUp&&this.selectedDrawingTool.mouseUp(t)},e.prototype.keyboardEventHandler=function(e,t){return t.keyCode===o.KeyStrokes.deleteKeyStroke?e.tryDeleteSelectedElement():t.keyCode===o.KeyStrokes.escapeKeyStroke&&this._toolbarViewModel.tools()[7].execute(e.easelViewModel),!0},e.prototype.trySaveAnnotatedImage=function(e){!this._toolbarViewModel.isImageNameValid()||void 0!==this.selectedDrawingTool.textArea&&this.selectedDrawingTool.textArea.className===o.TextAreaAttributes.textAreaVisibleClass||this._toolbarViewModel.tools()[6].execute(e.easelViewModel)},e.prototype.tryDeleteSelectedElement=function(){this._selectedTool&&(this._selectedTool["delete"](),this._selectedTool=null)},e.prototype.clearSelectedDrawingTool=function(){this.selectedDrawingTool=null},e.prototype.focusOut=function(e,t){this.selectedDrawingTool&&this.selectedDrawingTool.focusOut&&this.selectedDrawingTool.focusOut()},e.prototype.keyDown=function(e,t){var o,n,i,r;if(this.easelViewModel.isCropped){var a=this.getCropDrawingTool().getEnclosedRegion();o=a.offsetX+a.width,n=a.offsetY+a.height,i=6,r=14}else o=this.paper.width,n=this.paper.height,i=26,r=26;var s=o-parseInt(this.textArea.style.left.replace("px","")),l=n-parseInt(this.textArea.style.top.replace("px",""));return void 0===t.which?this.textAreaResize(s,l):t.which<32||t.which>=37&&t.which<=40?13!==t.which?this.textAreaResize(s,l):this.textAreaWidthLimitReached(s-i)||this.textAreaHeightLimitReached(l-r)?(t.preventDefault(),this.alarm()):this.textAreaResize(s,l):this.textAreaWidthLimitReached(s-i)?(t.preventDefault(),this.alarm()):this.textAreaResize(s,l),!0},e.prototype.getImageOnCanvas=function(e,t){var o=this;if(e){t||(t=new c.Region(0,0,this._originalCanvasViewModel.canvas.width,this._originalCanvasViewModel.canvas.height));var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var i=n.getContext("2d");this.drawBackgroundImageOnCanvas(i,t),this.drawSvgElementsOnCanvas(i,t,function(){var t=new y(o.imageId,n.toDataURL(),null,o._toolbarViewModel.imageName());t.screenshotTelemetryInfo=v.AnnotationTelemetry.getData(),e(t)})}},e.prototype.deleteCrossHairs=function(){this.crossHairsLinesModeOn(!1),this.crossHairs.deleteCrossHairs()},e.prototype.getSelectedTool=function(e,t){var n=this.paper.getElementByPoint(e,t);if(n&&!n.data("tempElement")){if(n.type===o.AnnotationToolBarConstants.rectangleType)return new g.RectangleSelectTool(this.paper,n);if(n.type===o.AnnotationToolBarConstants.ellipseType)return new u.EllipseSelectTool(this.paper,n);if(n.type===o.AnnotationToolBarConstants.arrowType)return new h.ArrowSelectTool(this.paper,n);if(n.type===o.AnnotationToolBarConstants.textType)return new p.TextSelectTool(this.paper,n);if(n.type===o.AnnotationToolBarConstants.imageType)return new g.RectangleSelectTool(this.paper,n)}},e.prototype.textAreaWidthLimitReached=function(e){return this.textArea.scrollWidth<e?!1:!0},e.prototype.textAreaHeightLimitReached=function(e){return this.textArea.scrollHeight<e?!1:!0},e.prototype.textAreaResize=function(e,t){var o=9,n=6;this.textArea.style.width="0px";var i=Math.min(this.textArea.scrollWidth,e);i+o>e&&(i=e-o),this.textArea.style.width=i+"px",this.textArea.style.height="0px";var r=Math.min(this.textArea.scrollHeight,t);r+n>t&&(r=t-n),this.textArea.style.height=r+"px"},e.prototype.drawBackgroundImageOnCanvas=function(e,t){var n=document.getElementById(o.AnnotationCanvasId.originalCanvasId);e.drawImage(n,t.offsetX,t.offsetY,t.width,t.height,0,0,t.width,t.height)},e.prototype.drawSvgElementsOnCanvas=function(e,t,n){var i=this,r=$("#svg-area svg")[0],a=new Blob([r.outerHTML.replace(o.svgTextRegex3," ")],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(a),l=new Image;l.onload=function(){e.drawImage(l,t.offsetX,t.offsetY,t.width,t.height,0,0,t.width,t.height),URL.revokeObjectURL(s),n(i)},l.src=s},e.prototype.init=function(){var e=this;this.paper=Raphael($("#svg-area")[0],0,0),this.textArea=document.getElementById(o.TextAreaAttributes.textAreaId),this._originalCanvasViewModel=new i.CanvasViewModel(o.AnnotationCanvasId.originalCanvasId,null),this._annotatedCanvasViewModel=new i.CanvasViewModel(o.AnnotationCanvasId.annotatedCanvasId,null),this._drawingCanvasViewModel=new i.CanvasViewModel(o.AnnotationCanvasId.drawingCanvasId,null),this.drawingTools.push(new r.RectangleDrawingTool(this,this._originalCanvasViewModel,this._annotatedCanvasViewModel,this._drawingCanvasViewModel,this.paper)),this.drawingTools.push(new a.EllipseDrawingTool(this,this._originalCanvasViewModel,this._annotatedCanvasViewModel,this._drawingCanvasViewModel,this.paper)),this.drawingTools.push(new s.TextDrawingTool(this,this._originalCanvasViewModel,this._annotatedCanvasViewModel,this._drawingCanvasViewModel,this.paper,this.textArea)),this.drawingTools.push(new l.ArrowDrawingTool(this,this._originalCanvasViewModel,this._annotatedCanvasViewModel,this._drawingCanvasViewModel,this.paper));var t=new n.CropDrawingTool(this,this._originalCanvasViewModel,this._annotatedCanvasViewModel,this._drawingCanvasViewModel,this.paper);this.drawingTools.push(t),this.drawingTools.push(new f.BlurDrawingTool(this,this._originalCanvasViewModel,this._annotatedCanvasViewModel,this._drawingCanvasViewModel,this.paper)),this.selectedDrawingTool=t;var c=this;this._toolbarViewModel.selectedToolIndex.subscribe(function(t){c.selectedDrawingTool&&c.selectedDrawingTool.type===o.AnnotationToolbarToolType.Text&&(c.textArea.className=o.TextAreaAttributes.textAreaClass,c.selectedDrawingTool.focusOut());var n=c.getSelectedDrawingTool(e._toolbarViewModel,t);c.changeSelectedDrawingTool(n)})},e.prototype.changeSelectedDrawingTool=function(e){for(var t=0;t<this.drawingTools().length;t++)if(this.drawingTools()[t].type===e.type){this.selectedDrawingTool=this.drawingTools()[t],this.changeAnnotationAreaClass(e.type);break}},e.prototype.changeAnnotationAreaClass=function(e){$("#"+o.AnnotationAreaAttributes.annotationAreaId).removeAttr("class"),$("#"+o.AnnotationAreaAttributes.annotationAreaId).addClass(o.AnnotationAreaAttributes.annotationAreaClass),$("#"+o.AnnotationAreaAttributes.annotationAreaId).addClass(o.CssConstants.tools[e])},e.prototype.getSelectedDrawingTool=function(e,t){return e.tools()[t]},e.prototype.alarm=function(){var e=new Audio(this._beepAudioDataURI);e.play(),v.AnnotationTelemetry.textOverflow()},e}();t.DrawingAreaViewModel=T}),define("../ViewModel/ColorPalletViewModel",["require","exports","../ViewModel/AnnotationToolCommon"],function(e,t,o){function n(e){var t=ko.observableArray([new i("#525252","Grey",e),new i("#FBBC3D","Orange",e),new i("#245CAC","Blue",e),new i("#602F70","Dark purple",e),new i("#FF8000","Dark orange",e),new i("#2CBDD9","Teal",e),new i("#7A0002","Brown",e),new i("#00564B","Dark green",e),new i("#FF00FF","Purple",e),new i("#EC001D","Red",e),new i("#7ACE64","Green",e),new i("#000000","Black",e)]);return t}var i=function(){function e(e,t,o){this.colorHex=e,this.colorName=t,this.parent=o}return e.prototype.onSelectColor=function(){this.parent.onSelectColor(this)},e.prototype.keyDownOnRectangle=function(e,t){return t.which===o.KeyStrokes.enterKeyStroke&&this.onSelectColor(),!0},e}();t.GridColor=i;var r=function(){function e(){this.showColorPallet=ko.observable(!1),this.colors=n(this),this.selectedColor=ko.observable("#FBBC3D")}return e.prototype.onSelectColor=function(e){this.showColorPallet(!1),this.selectedColor(e.colorHex)},e}();t.ColorPalletViewModel=r}),define("../ViewModel/BaseColorfulTool",["require","exports","../ViewModel/AnnotationSettings","../ViewModel/AnnotationToolCommon","../ViewModel/ColorPalletViewModel"],function(e,t,o,n,i){var r=function(){function e(e,t,r){var a=this;this.colorPallet=new i.ColorPalletViewModel,this.type=e,this.typeName=n.AnnotationToolbarToolType[this.type],this.tooltip=n.annotationToolbarToolTitleDictionary[this.type],this.parentModel=t,this.showPallet=!0,this.setInitialColor(r),this.colorPallet.selectedColor.subscribe(function(e){var t={color:e};o.setSettings(a.typeName,t)})}return e.prototype.keyDown=function(e,t){return t.which===n.KeyStrokes.enterKeyStroke&&this.execute(),!0},e.prototype.execute=function(){this.parentModel.selectTool(this)},e.prototype.keyDownColorSelector=function(e,t){return t.which===n.KeyStrokes.enterKeyStroke&&this.openPallet(),!0},e.prototype.openPallet=function(){this.colorPallet.showColorPallet(!0)},e.prototype.setInitialColor=function(e){var t=o.getSettings(this.typeName);t&&t.color?e=t.color:(e||(e=this.colorPallet.colors()[0].colorHex),t={color:e},o.setSettings(this.typeName,t)),this.colorPallet.selectedColor(e)},e}();t.BaseColorfulTool=r});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/EllipseViewModel",["require","exports","../ViewModel/AnnotationToolCommon","../ViewModel/BaseColorfulTool"],function(e,t,o,n){var i=function(e){function t(t){e.call(this,o.AnnotationToolbarToolType.Ellipse,t,"#FBBC3D"),this.cssClass=ko.observable(o.CssConstants.tools[this.type])}return __extends(t,e),t}(n.BaseColorfulTool);t.EllipseViewModel=i});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/RectangleViewModel",["require","exports","../ViewModel/BaseColorfulTool","../ViewModel/AnnotationToolCommon"],function(e,t,o,n){var i=function(e){function t(t){e.call(this,n.AnnotationToolbarToolType.Rectangle,t,"#7ACE64"),
this.cssClass=ko.observable(n.CssConstants.tools[this.type])}return __extends(t,e),t}(o.BaseColorfulTool);t.RectangleViewModel=i});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/ArrowViewModel",["require","exports","../ViewModel/AnnotationToolCommon","../ViewModel/BaseColorfulTool"],function(e,t,o,n){var i=function(e){function t(t){e.call(this,o.AnnotationToolbarToolType.Arrow,t,"#EC001D"),this.cssClass=ko.observable(o.CssConstants.tools[this.type])}return __extends(t,e),t}(n.BaseColorfulTool);t.ArrowViewModel=i});var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)};define("../ViewModel/TextViewModel",["require","exports","../ViewModel/BaseColorfulTool","../ViewModel/AnnotationToolCommon"],function(e,t,o,n){var i=function(e){function t(t){e.call(this,n.AnnotationToolbarToolType.Text,t,"#EC001D"),this.cssClass=ko.observable(n.CssConstants.tools[this.type])}return __extends(t,e),t}(o.BaseColorfulTool);t.TextViewModel=i}),define("../ViewModel/BlurViewModel",["require","exports","../ViewModel/AnnotationToolCommon"],function(e,t,o){var n=function(){function e(e){this.type=o.AnnotationToolbarToolType.Blur,this.typeName=o.AnnotationToolbarToolType[this.type],this.tooltip=o.annotationToolbarToolTitleDictionary[this.type],this.cssClass=ko.observable(o.CssConstants.tools[this.type]),this.parentModel=e,this.showPallet=!1}return e.prototype.keyDown=function(e,t){return t.which===o.KeyStrokes.enterKeyStroke&&this.execute(),!0},e.prototype.execute=function(){this.parentModel.selectTool(this)},e}();t.BlurViewModel=n}),define("../ViewModel/DeleteViewModel",["require","exports","../ViewModel/AnnotationToolCommon"],function(e,t,o){var n=function(){function e(e){this.type=o.AnnotationToolbarToolType.Delete,this.typeName=o.AnnotationToolbarToolType[this.type],this.tooltip=o.annotationToolbarToolTitleDictionary[this.type],this.cssClass=ko.observable(o.CssConstants.tools[this.type]),this.parentModel=e,this.showPallet=!1}return e.prototype.keyDown=function(e,t){return t.which===o.KeyStrokes.enterKeyStroke&&this.execute(),!0},e.prototype.execute=function(){this.parentModel.easelViewModel.drawingAreaViewModel.tryDeleteSelectedElement()},e}();t.DeleteViewModel=n}),define("../ViewModel/SaveViewModel",["require","exports","../ViewModel/AnnotationToolCommon","../../Messaging/ChromeMessaging","../../Messaging/Messaging","../ViewModel/AnnotationSettings","../../Tracing/Tracing","../AnnotationToolTelemetry"],function(e,t,o,n,i,r,a,s){var l=a.TracingService,c="SaveScreenshot",d=function(){function e(e){var t=this;this.type=o.AnnotationToolbarToolType.Save,this.typeName=o.AnnotationToolbarToolType[this.type],this.tooltip=o.annotationToolbarToolTitleDictionary[this.type],this.cssClass=ko.observable(o.CssConstants.tools[this.type]),this.parentModel=e,this.showPallet=!1,this.parentModel.isImageNameValid.subscribe(function(e){e?t.cssClass(o.CssConstants.tools[t.type]):t.cssClass(o.CssConstants.tools[t.type]+" disable")})}return e.prototype.keyDown=function(e,t){return t.which===o.KeyStrokes.enterKeyStroke&&this.execute(),!0},e.prototype.execute=function(){if(l.traceEnter("Save",c,1,"Begin"),this.parentModel.isImageNameValid()){if(r.saveSettings(),this.parentModel.easelViewModel.isCropped){var e=this.parentModel.easelViewModel.drawingAreaViewModel.getCropDrawingTool().getEnclosedRegion();this.parentModel.easelViewModel.drawingAreaViewModel.getImageOnCanvas(function(e){n.MessagingFactory.getBroadcastingService().broadcast(i.NotificationType.AnnotationDone,e)},e)}else s.AnnotationTelemetry.setFullScreenMode(),this.parentModel.easelViewModel.drawingAreaViewModel.getImageOnCanvas(function(e){n.MessagingFactory.getBroadcastingService().broadcast(i.NotificationType.AnnotationDone,e)});l.traceLeave("Save",c,2,"End","IsCropped",this.parentModel.easelViewModel.isCropped)}},e}();t.SaveViewModel=d}),define("../ViewModel/CancelViewModel",["require","exports","../ViewModel/AnnotationToolCommon","../../Messaging/ChromeMessaging","../../Messaging/Messaging"],function(e,t,o,n,i){var r=function(){function e(e){this.type=o.AnnotationToolbarToolType.Cancel,this.typeName=o.AnnotationToolbarToolType[this.type],this.tooltip=o.annotationToolbarToolTitleDictionary[this.type],this.cssClass=ko.observable(o.CssConstants.tools[this.type]),this.parentModel=e,this.showPallet=!1}return e.prototype.keyDown=function(e,t){return t.which===o.KeyStrokes.enterKeyStroke&&this.execute(),!0},e.prototype.execute=function(){n.MessagingFactory.getBroadcastingService().broadcast(i.NotificationType.AnnotationCancelled,this.parentModel.easelViewModel.drawingAreaViewModel.imageId)},e}();t.CancelViewModel=r}),define("../ViewModel/AnnotationToolbarViewModel",["require","exports","../ViewModel/AnnotationToolCommon","../ViewModel/EllipseViewModel","../ViewModel/RectangleViewModel","../ViewModel/ArrowViewModel","../ViewModel/TextViewModel","../ViewModel/BlurViewModel","../ViewModel/DeleteViewModel","../ViewModel/SaveViewModel","../ViewModel/CancelViewModel","../../Tracing/Tracing"],function(e,t,o,n,i,r,a,s,l,c,d,g){var u=g.TracingService,h="AnnotationToolbarViewModel",p=function(){function e(e){this.tools=ko.observableArray([]),this.invalidImageNameTooltip=o.invalidImageNameTooltip,this.isImageNameValid=ko.observable(!0),this.imageToolTip=ko.observable("Screenshot name"),this.tools.push(new n.EllipseViewModel(this)),this.tools.push(new i.RectangleViewModel(this)),this.tools.push(new r.ArrowViewModel(this)),this.tools.push(new a.TextViewModel(this)),this.tools.push(new s.BlurViewModel(this)),this.tools.push(new l.DeleteViewModel(this)),this.tools.push(new c.SaveViewModel(this)),this.tools.push(new d.CancelViewModel(this)),this.easelViewModel=e,this.imageName=ko.observable("defaultName"),this.selectedToolIndex=ko.observable(-1),this._toolWidth=o.AnnotationToolBarConstants.annotationToolBarWidth,this._toolHeight=o.AnnotationToolBarConstants.annotationToolBarHeight,this._defaultToolType=o.AnnotationToolbarToolType.Ellipse,this.imageNameInput=document.getElementById("image-name-input")}return e.prototype.adjustToolbarLocation=function(e,t,n){u.traceEnter("AdjustToolbarLocation",h,1,"Begin");var i,r,a=this.getAnnotationToolElement(),s=this.findToolbarLocation(e,t,n);return s===o.AnnnotationToolDisplayLocation.DisplayOnTopFixed?void this.moveToolToDefaultLocation(t):(e.width<this._toolWidth?s===o.AnnnotationToolDisplayLocation.DisplayOnTopFloat?(i=e.offsetX-(this._toolWidth-e.width)/2,r=e.offsetY-(o.AnnotationToolBarConstants.marginBetweenCropRegionAndToolBar+this._toolHeight-o.AnnotationToolBarConstants.colorPalletHeight)):(i=e.offsetX-(this._toolWidth-e.width)/2,r=e.offsetY+e.height+o.AnnotationToolBarConstants.marginBetweenCropRegionAndToolBar):s===o.AnnnotationToolDisplayLocation.DisplayOnTopFloat?(i=e.offsetX+(e.width-this._toolWidth)/2,r=e.offsetY-(o.AnnotationToolBarConstants.marginBetweenCropRegionAndToolBar+this._toolHeight-o.AnnotationToolBarConstants.colorPalletHeight)):(i=e.offsetX+(e.width-this._toolWidth)/2,r=e.offsetY+e.height+o.AnnotationToolBarConstants.marginBetweenCropRegionAndToolBar),a.style.left=i+"px",a.style.top=r+"px",void u.traceLeave("AdjustToolbarLocation",h,2,"End","(Left,Top)("+a.style.left+", "+a.style.top+")"))},e.prototype.moveToolToDefaultLocation=function(e){var t=this.getAnnotationToolElement();t.style.left=(e-o.AnnotationToolBarConstants.annotationToolBarWidth)/2+"px",t.style.top="0px"},e.prototype.selectTool=function(e){u.traceEnter("SelectTool",h,3,"Begin");for(var t=0;t<this.tools().length;t++)if(this.tools()[t].type===e.type){if(this.selectedToolIndex()>=0){var n=this.tools()[this.selectedToolIndex()];n&&n.cssClass(o.CssConstants.tools[n.type])}e.cssClass(this.getSelectedToolCssClass(e)),this.selectedToolIndex(t);break}u.traceLeave("SelectTool",h,4,"End")},e.prototype.getSelectedToolCssClass=function(e){return e.cssClass()+" "+e.cssClass()+o.CssConstants.cssClassSelectedToolSuffix},e.prototype.selectDefaultTool=function(){for(var e=0;e<this.tools().length;e++)if(this.tools()[e].type===this._defaultToolType){this.tools()[e].cssClass(this.getSelectedToolCssClass(this.tools()[e])),this.selectedToolIndex(e);break}},e.prototype.keyUpOnImageNameInput=function(e,t){var n=this.imageNameInput.value;return""===n||n.match(o.imageNameRegex)?(document.getElementById("screenshot-name-error").innerHTML="&#59593;",this.isImageNameValid(!1),this.imageToolTip(this.invalidImageNameTooltip)):(document.getElementById("screenshot-name-error").innerHTML="",this.isImageNameValid(!0),this.imageToolTip("Screenshot name")),!0},e.prototype.getTool=function(e){for(var t=0;t<this.tools().length;t++)if(this.tools()[t].typeName===e)return this.tools()[t]},e.prototype.isEnoughSpaceAtLeft=function(e){return(this._toolWidth-e.width)/2>e.offsetX?!1:!0},e.prototype.isEnoughSpaceAtRight=function(e,t,o){return(this._toolWidth-e.width)/2>t-(e.offsetX+e.width)?!1:!0},e.prototype.isEnoughSpaceAtTop=function(e){return e.offsetY<this._toolHeight-o.AnnotationToolBarConstants.colorPalletHeight+o.AnnotationToolBarConstants.marginBetweenCropRegionAndToolBar?!1:!0},e.prototype.isEnoughSpaceAtBottom=function(e,t,n){return n-(e.offsetY+e.height)<this._toolHeight+o.AnnotationToolBarConstants.marginBetweenCropRegionAndToolBar?!1:!0},e.prototype.findToolbarLocation=function(e,t,n){if(e.width<this._toolWidth){if(!this.isEnoughSpaceAtLeft(e))return o.AnnnotationToolDisplayLocation.DisplayOnTopFixed;if(!this.isEnoughSpaceAtRight(e,t,n))return o.AnnnotationToolDisplayLocation.DisplayOnTopFixed}return this.isEnoughSpaceAtBottom(e,t,n)?o.AnnnotationToolDisplayLocation.DisplayOnBottomFloat:this.isEnoughSpaceAtTop(e)?o.AnnnotationToolDisplayLocation.DisplayOnTopFloat:o.AnnnotationToolDisplayLocation.DisplayOnTopFixed},e.prototype.getAnnotationToolElement=function(){return document.getElementById(o.AnnotationToolBarConstants.annotationToolBarId)},e}();t.AnnotationToolbarViewModel=p}),define("../ViewModel/EaselViewModel",["require","exports","../ViewModel/DrawingAreaViewModel","../ViewModel/AnnotationToolbarViewModel","../ViewModel/AnnotationToolCommon"],function(e,t,o,n,i){var r=function(){function e(){i.initializeToolbarTooltips(),this.toolbarViewModel=new n.AnnotationToolbarViewModel(this),this.drawingAreaViewModel=new o.DrawingAreaViewModel(this,this.toolbarViewModel),this.isCropped=!0,this.switchMode=ko.observable(!0),this.initializeSubscriptions()}return e.prototype.switchCropMode=function(){this.isCropped=!1,this.switchMode(!1),this.toolbarViewModel.selectDefaultTool(),this.toolbarViewModel.moveToolToDefaultLocation(this.drawingAreaViewModel.paper.width),this.drawingAreaViewModel.getCropDrawingTool().clear(),this.drawingAreaViewModel.deleteCrossHairs()},e.prototype.keyDown=function(e,t){return t.which===i.KeyStrokes.enterKeyStroke&&this.switchCropMode(),!0},e.prototype.initializeSubscriptions=function(){var e=this,t=this.drawingAreaViewModel.getCropDrawingTool();t.drawingToolState.subscribe(function(o){o===i.DrawingToolState.Completed?(e.switchMode(!1),e.toolbarViewModel.selectDefaultTool(),e.toolbarViewModel.adjustToolbarLocation(t.getEnclosedRegion(),e.drawingAreaViewModel.paper.width,e.drawingAreaViewModel.paper.height)):o===i.DrawingToolState.NotStarted&&e.switchMode(!0)})},e}();t.EaselViewModel=r}),define("../ViewModel/PalletVisibilityBinding",["require","exports"],function(e,t){function o(){ko.bindingHandlers.palletVisible={init:function(e,t,o,n,i){$(document).mousedown(function(t){var o=$(e);o.is(t.target)||0!==o.has(t.target).length||i.$data.showColorPallet(!1)})},update:function(e,t,o,n,i){var r=t();r&&r()?$(e).show():$(e).hide()}}}t.initializeBinding=o}),define("../ViewModel/FontBinding",["require","exports","../ViewModel/AnnotationToolCommon"],function(e,t,o){function n(){ko.bindingHandlers.font={init:function(e,t,n,i,r){var a=r.$data.typeName;a===o.AnnotationToolbarToolType[o.AnnotationToolbarToolType.Rectangle]?e.innerHTML=o.FontConstants.rectangle:a===o.AnnotationToolbarToolType[o.AnnotationToolbarToolType.Ellipse]?e.innerHTML=o.FontConstants.ellipse:a===o.AnnotationToolbarToolType[o.AnnotationToolbarToolType.Arrow]?e.innerHTML=o.FontConstants.arrow:a===o.AnnotationToolbarToolType[o.AnnotationToolbarToolType.Text]?e.innerHTML=o.FontConstants.text:a===o.AnnotationToolbarToolType[o.AnnotationToolbarToolType.Delete]?e.innerHTML=o.FontConstants["delete"]:a===o.AnnotationToolbarToolType[o.AnnotationToolbarToolType.Save]?e.innerHTML=o.FontConstants.save:a===o.AnnotationToolbarToolType[o.AnnotationToolbarToolType.Cancel]&&(e.innerHTML=o.FontConstants.cancel),$(e).mousedown(function(e){clearTimeout(this.downTimer),this.downTimer=setTimeout(function(){r.$data.colorPallet&&r.$data.openPallet()},o.AnnotationToolBarConstants.longPressTimout)}).mouseup(function(e){clearTimeout(this.downTimer)})},update:function(e,t,o,n,i){i.$data.colorPallet&&($(e).css("color",i.$data.colorPallet.selectedColor()),i.$data.colorPallet.showColorPallet()&&i.$parent.selectTool(i.$data))}}}t.initializeBinding=n}),define("../View/CanvasManager",["require","exports","../ViewModel/EaselViewModel","../ViewModel/AnnotationToolCommon","../../Common/SessionData","../ViewModel/PalletVisibilityBinding","../ViewModel/FontBinding","../../Model/BrowserHelper"],function(e,t,o,n,i,r,a,s){var l=s.BrowserHelper,c=function(){function e(){this.activityViewModel=new o.EaselViewModel,r.initializeBinding(),a.initializeBinding(),ko.bindingProvider.instance=new ko.secureBindingsProvider,ko.applyBindings(this.activityViewModel)}return e.prototype.drawImage=function(e){var t=this;if(!this.activityViewModel.drawingAreaViewModel.imageId){var o=new Image;o.onload=function(){if(e.chromeApiType==i.chromeApiType.chromeScreenCapture||t.versionCompatible())var r=t.getScaledDimensions(o);else var r={height:o.height,width:o.width};var a=document.getElementById(n.AnnotationCanvasId.originalCanvasId),s=r.width,l=r.height;a.width=s,a.height=l;var c=a.getContext("2d");c.drawImage(o,0,0,r.width,r.height);var d=navigator.platform.toUpperCase().indexOf("MAC")>=0;if(d&&window.parent.postMessage({resize:!0,height:r.height},"*"),"maximized"==e.state){var g=$(window).width(),u=$(window).height();s=g>s?g:s,l=u>l?u:l}t.activityViewModel.drawingAreaViewModel.initializeDrawingArea(s,l,e.name,e.id),$(".annotation-toolbar").draggable({containment:[0,0,s-n.AnnotationToolBarConstants.annotationToolBarWidth,l-n.AnnotationToolBarConstants.annotationToolBarHeight],handle:".gripper",scrollSensitivity:100,scrollSpeed:100})},o.src=e.content}},e.prototype.versionCompatible=function(){var e=navigator.userAgent,t=e.match(/(opera|chrome|safari|firefox|chromium|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return"Chrome"===t[1]&&t[2]<"72"?!0:!1},e.prototype.getScaledDimensions=function(e){var t=window.devicePixelRatio||1,o={height:e.height/t,width:e.width/t};try{return l.isFirefox()?{height:e.height,width:e.width}:o}catch(n){return o}},e}();t.CanvasManager=c}),define("AnnotationTool",["require","exports","../../Messaging/ChromeMessaging","../../Messaging/Messaging","../ViewModel/AnnotationSettings","../View/CanvasManager","../../Tracing/Tracing","../AnnotationToolTelemetry"],function(e,t,o,n,i,r,a,s){var l=n.NotificationType,c=a.Component,d=a.TracingService,g=s.AnnotationTelemetry,u="AnnotationTool",h=function(){function e(){this._subscriptionService=o.MessagingFactory.getSubscriptionService(),this._broadcastingService=o.MessagingFactory.getBroadcastingService()}return e.prototype.initialize=function(){var e=this;d.initializeService(c.AnnotationTool),d.traceVerbose(u,1,"Begin - Init annotation tool"),i.loadSettings(function(){e._canvasManager=new r.CanvasManager,g.initialize(),e._subscribeToMessages(),e._broadcastMessages()}),d.traceVerbose(u,2,"End - Init annotation tool")},e.prototype._subscribeToMessages=function(){var e=this;this._subscriptionService.subscribe(function(t){d.traceEnter("DrawScreenShot",u,3,"Received screen shot"),e._canvasManager.drawImage(t),d.traceLeave("DrawScreenShot",u,4,"Screen shot drawn on canvas")},n.NotificationType.AnnotateScreenshot)},e.prototype._broadcastMessages=function(){this._broadcastingService.broadcast(l.AnnotationToolReady,{windowId:null})},e}();t.AnnotationTool=h,$("document").ready(function(){(new h).initialize()})}),require(["AnnotationTool"]),define("main",function(){});